!function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=141)}([function(t,e){t.exports=require("core-js/modules/es.error.to-string.js")},function(t,e){t.exports=require("core-js/modules/es.object.define-property.js")},function(t,e){t.exports=require("core-js/modules/es.error.cause.js")},function(t,e){t.exports=require("core-js/modules/es.object.to-string.js")},function(t,e){t.exports=require("core-js/modules/es.array.iterator.js")},function(t,e){t.exports=require("core-js/modules/es.string.iterator.js")},function(t,e){t.exports=require("core-js/modules/web.dom-collections.iterator.js")},function(t,e){t.exports=require("core-js/modules/es.function.name.js")},function(t,e){t.exports=require("core-js/modules/es.symbol.js")},function(t,e){t.exports=require("core-js/modules/es.symbol.description.js")},function(t,e){t.exports=require("core-js/modules/es.symbol.iterator.js")},function(t,e){t.exports=require("core-js/modules/es.array.for-each.js")},function(t,e){t.exports=require("core-js/modules/es.array.slice.js")},function(t,e){t.exports=require("core-js/modules/es.array.push.js")},function(t,e){t.exports=require("core-js/modules/web.dom-collections.for-each.js")},function(t,e){t.exports=require("core-js/modules/es.object.create.js")},function(t,e){t.exports=require("core-js/modules/es.object.get-prototype-of.js")},function(t,e){t.exports=require("core-js/modules/es.object.set-prototype-of.js")},function(t,e){t.exports=require("core-js/modules/es.object.proto.js")},function(t,e){t.exports=require("core-js/modules/es.promise.js")},function(t,e){t.exports=require("path")},function(t,e){t.exports=require("core-js/modules/es.symbol.async-iterator.js")},function(t,e){t.exports=require("core-js/modules/es.symbol.to-string-tag.js")},function(t,e){t.exports=require("core-js/modules/es.json.to-string-tag.js")},function(t,e){t.exports=require("core-js/modules/es.math.to-string-tag.js")},function(t,e){t.exports=require("core-js/modules/es.array.reverse.js")},function(t,e){t.exports=require("core-js/modules/es.array.concat.js")},function(t,e){t.exports=require("core-js/modules/es.regexp.exec.js")},function(t,e){t.exports=require("core-js/modules/es.weak-set.js")},function(t,e){t.exports=require("core-js/modules/es.array.is-array.js")},function(t,e){t.exports=require("util")},function(t,e){t.exports=require("core-js/modules/es.array.from.js")},function(t,e){t.exports=require("core-js/modules/es.regexp.test.js")},function(t,e){t.exports=require("express")},function(t,e){t.exports=require("core-js/modules/es.object.keys.js")},function(t,e){t.exports=require("core-js/modules/es.object.assign.js")},function(t,e){t.exports=require("core-js/modules/es.date.to-string.js")},function(t,e){t.exports=require("core-js/modules/es.array.join.js")},function(t,e){t.exports=require("core-js/modules/es.array.includes.js")},function(t,e){t.exports=require("core-js/modules/es.string.match.js")},function(t,e){t.exports=require("core-js/modules/es.array.map.js")},function(t,e){t.exports=require("crypto")},function(t,e){t.exports=require("fs")},function(t,e){t.exports=require("core-js/modules/es.regexp.to-string.js")},function(t,e){t.exports=require("core-js/modules/es.json.stringify.js")},function(t,e){t.exports=require("core-js/modules/es.function.bind.js")},function(t,e){t.exports=require("core-js/modules/es.string.includes.js")},function(t,e){t.exports=require("winston")},function(t,e){t.exports=require("core-js/modules/es.string.replace.js")},function(t,e){t.exports=require("core-js/modules/es.array.filter.js")},function(t,e){t.exports=require("core-js/modules/es.object.get-own-property-descriptor.js")},function(t,e){t.exports=require("stream")},function(t,e){t.exports=require("uuid")},function(t,e){t.exports=require("firebase-admin")},function(t,e){t.exports=require("@sentry/node")},function(t,e){t.exports=require("core-js/modules/es.object.get-own-property-descriptors.js")},function(t,e){t.exports=require("core-js/modules/es.object.define-properties.js")},function(t,e){t.exports=require("morgan")},function(t,e){t.exports=require("core-js/modules/es.string.trim.js")},function(t,e){t.exports=require("core-js/modules/es.object.entries.js")},function(t,e){t.exports=require("core-js/modules/es.reflect.to-string-tag.js")},function(t,e){t.exports=require("core-js/modules/es.reflect.construct.js")},function(t,e){t.exports=require("hbs")},function(t,e){t.exports=require("axios")},function(t,e){t.exports=require("on-finished")},function(t,e){t.exports=require("file-type")},function(t,e){t.exports=require("newrelic")},function(t,e){t.exports=require("image-size")},function(t,e){t.exports=require("core-js/modules/es.parse-float.js")},function(t,e){t.exports=require("core-js/modules/web.timers.js")},function(t,e){t.exports=require("core-js/modules/es.array.sort.js")},function(t,e){t.exports=require("core-js/modules/es.number.to-fixed.js")},function(t,e){t.exports=require("core-js/modules/es.weak-map.js")},function(t,e){t.exports=require("formidable")},function(t,e){t.exports=require("roddeh-i18n")},function(t,e){t.exports=require("js-sha256")},function(t,e){t.exports=require("@google-cloud/storage")},function(t,e){t.exports=require("multer")},function(t,e){t.exports=require("ws")},function(t,e){t.exports=require("core-js/modules/es.string.starts-with.js")},function(t,e){t.exports=require("core-js/modules/es.object.values.js")},function(t,e){t.exports=require("cookie-parser")},function(t,e){t.exports=require("compression")},function(t,e){t.exports=require("helmet")},function(t,e){t.exports=require("staticify")},function(t,e){t.exports=require("connect-timeout")},function(t,e){t.exports=require("js-sha1")},function(t,e){t.exports=require("redis")},function(t,e){t.exports=require("node-cache")},function(t,e){t.exports=require("on-headers")},function(t,e){t.exports=require("@sentry/tracing")},function(t,e){t.exports=require("debug")},function(t,e){t.exports=require("http")},function(t,e){t.exports=require("@godaddy/terminus")},function(t,e){t.exports=require("url")},function(t,e){t.exports=require("http-errors")},function(t,e){t.exports=require("core-js/modules/es.string.split.js")},function(t,e){t.exports=require("core-js/modules/es.object.from-entries.js")},function(t,e){t.exports=require("core-js/modules/es.parse-int.js")},function(t,e){t.exports=require("core-js/modules/es.string.replace-all.js")},function(t,e){t.exports=require("core-js/modules/es.regexp.constructor.js")},function(t,e){t.exports=require("core-js/modules/es.regexp.dot-all.js")},function(t,e){t.exports=require("core-js/modules/es.regexp.sticky.js")},function(t,e){t.exports=require("core-js/modules/es.array-buffer.constructor.js")},function(t,e){t.exports=require("core-js/modules/es.array-buffer.slice.js")},function(t,e){t.exports=require("core-js/modules/es.typed-array.uint8-array.js")},function(t,e){t.exports=require("core-js/modules/es.typed-array.at.js")},function(t,e){t.exports=require("core-js/modules/es.typed-array.copy-within.js")},function(t,e){t.exports=require("core-js/modules/es.typed-array.every.js")},function(t,e){t.exports=require("core-js/modules/es.typed-array.fill.js")},function(t,e){t.exports=require("core-js/modules/es.typed-array.filter.js")},function(t,e){t.exports=require("core-js/modules/es.typed-array.find.js")},function(t,e){t.exports=require("core-js/modules/es.typed-array.find-index.js")},function(t,e){t.exports=require("core-js/modules/es.typed-array.find-last.js")},function(t,e){t.exports=require("core-js/modules/es.typed-array.find-last-index.js")},function(t,e){t.exports=require("core-js/modules/es.typed-array.for-each.js")},function(t,e){t.exports=require("core-js/modules/es.typed-array.includes.js")},function(t,e){t.exports=require("core-js/modules/es.typed-array.index-of.js")},function(t,e){t.exports=require("core-js/modules/es.typed-array.iterator.js")},function(t,e){t.exports=require("core-js/modules/es.typed-array.join.js")},function(t,e){t.exports=require("core-js/modules/es.typed-array.last-index-of.js")},function(t,e){t.exports=require("core-js/modules/es.typed-array.map.js")},function(t,e){t.exports=require("core-js/modules/es.typed-array.reduce.js")},function(t,e){t.exports=require("core-js/modules/es.typed-array.reduce-right.js")},function(t,e){t.exports=require("core-js/modules/es.typed-array.reverse.js")},function(t,e){t.exports=require("core-js/modules/es.typed-array.set.js")},function(t,e){t.exports=require("core-js/modules/es.typed-array.slice.js")},function(t,e){t.exports=require("core-js/modules/es.typed-array.some.js")},function(t,e){t.exports=require("core-js/modules/es.typed-array.sort.js")},function(t,e){t.exports=require("core-js/modules/es.typed-array.subarray.js")},function(t,e){t.exports=require("core-js/modules/es.typed-array.to-locale-string.js")},function(t,e){t.exports=require("core-js/modules/es.typed-array.to-string.js")},function(t,e){t.exports=require("core-js/modules/es.array.index-of.js")},function(t,e){t.exports=require("core-js/modules/es.map.js")},function(t,e){t.exports=require("buffer")},function(t,e){t.exports=require("core-js/modules/es.date.now.js")},function(t,e){t.exports=require("core-js/modules/es.array.flat-map.js")},function(t,e){t.exports=require("core-js/modules/es.array.unscopables.flat-map.js")},function(t,e){t.exports=require("core-js/modules/es.number.constructor.js")},function(t,e){t.exports=require("core-js/modules/es.array.reduce.js")},function(t,e){t.exports=require("core-js/modules/es.reflect.get.js")},function(t,e,r){"use strict";r.r(e);r(3),r(19),r(8),r(9),r(10),r(4),r(5),r(6),r(21),r(22),r(23),r(24),r(1),r(15),r(2),r(0),r(16),r(11),r(13),r(14),r(7),r(17),r(18),r(25),r(12),r(37),r(36),r(43),r(44),r(27),r(39),r(48),r(26),r(95);var n=r(33),o=r.n(n),i=r(20),a=r.n(i),c=r(81),u=r.n(c),s=r(82),l=r.n(s),f=r(83),h=r.n(f),p=r(84),d=r.n(p),y=r(62),v=r.n(y);function m(t){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function g(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */g=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var o=e&&e.prototype instanceof f?e:f,i=Object.create(o.prototype),a=new L(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return O()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=E(a,r);if(c){if(c===l)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=s(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(t,r,a),i}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var l={};function f(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(j([])));v&&v!==e&&r.call(v,o)&&(d=v);var w=p.prototype=f.prototype=Object.create(d);function b(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){var n;this._invoke=function(o,i){function a(){return new e((function(n,a){!function n(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==m(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,a,c)}),(function(t){n("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,c)}))}c(u.arg)}(o,i,n,a)}))}return n=n?n.then(a,a):a()}}function E(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,E(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=s(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function L(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function j(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:O}}function O(){return{value:void 0,done:!0}}return h.prototype=p,c(w,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(w),t},t.awrap=function(t){return{__await:t}},b(x.prototype),c(x.prototype,i,(function(){return this})),t.AsyncIterator=x,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new x(u(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},b(w),c(w,a,"Generator"),c(w,o,(function(){return this})),c(w,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=j,L.prototype={constructor:L,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),k(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;k(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:j(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function w(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function b(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){w(i,n,o,a,c,"next",t)}function c(t){w(i,n,o,a,c,"throw",t)}a(void 0)}))}}var x=o.a.Router();x.get("/",function(){var t=b(g().mark((function t(e,r){return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r.status(404).send("Not Found");case 1:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}()),x.get("/d25e4af/error",function(){var t=b(g().mark((function t(e,r){return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:throw"Fake Error";case 1:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}());var E=x,S=(r(35),r(29),r(31),r(32),r(51)),k=r.n(S),L=r(42),j=r.n(L),O=r(63),_=r.n(O),T=r(73),P=r.n(T),I=r(30),N=r.n(I),A=r(85),C=r.n(A),R=r(74),F=r.n(R);F.a.translator.add({values:{"errors:simulations-hourly-limit":"You have reached your simulations hourly limit, try again in 1 hour.","errors:simulations-minutely-limit":"You are sending too much simulations in sequence, please wait 1 minute before trying again.","errors:simulations-daily-limit":"You have reached your simulations daily limit, try again tomorrow.","errors:no-face":"We couldn't process this photo, please try again with another one.","errors:simulation-error":"An error happened with the simulation, please try again with another photo.","errors:unknown-processing-error":"An error has ocurred, try again later.","errors:timeout":"Our servers are busy, please try again in a few minutes.","errors:upload:image-size-limit":"Photo exceeds the %{maxSize}mb size limit","errors:upload:wrong-image-format":"Photo must be an jpg or png image","errors:upload:no-file":"Photo is mandatory","errors:invalid-recaptcha":"Invalid recaptcha","errors:simulations-limit":"You have reached the limit of simulations, try again in 24 hours.","errors:upload:generic":"Error on upload, try again later","progress:polling-fallback":"Trying to download image. (Retries: %{count}/%{max})","progress:stages:uploading":"Uploading","progress:stages:pre-processing":"Waiting processing start","progress:stages:processing-step":"Processing %{number}/%{maxNumber}","form:user:name":"Full Name","form:user:email":"Email","form:user:telephone-number":"Telephone Number","form:user:image":"Photo","form:label:error":"Error","form:submit":"Start Simulation"}});r(49);function G(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var D=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var r=e.match(/^(([^:]+):\/\/)?(([^@\/]+)@)?([^\/]+)(\/.*)?$/);this.protocol=r[2],this.user=r[4],this.domainAndPort=r[5],this.path=r[6]||"/",this.protocol=void 0===this.protocol?null:this.protocol,this.user=void 0===this.user?null:this.user,this.path=void 0===this.path?null:this.path}var e,r,n;return e=t,(r=[{key:"toString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{protocol:!0,user:!0,path:!0},e=t.protocol,r=void 0===e||e,n=t.user,o=void 0===n||n,i=t.path,a=void 0===i||i,c="";return r&&this.protocol&&(c+="".concat(this.protocol,"://")),o&&this.user&&(c+="".concat(this.user,"@")),c+=this.domainAndPort,a&&this.path&&(c+=this.path),c}}])&&G(e.prototype,r),n&&G(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function M(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function q(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var U=new(function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),q(this,"signatureHeaderName","Authorization"),q(this,"deviceIdHeaderName","X-DEVICE-ID"),q(this,"apiSecretToken",process.env.DENTRINO_API_SECRET_TOKEN||"test-api-secret"),q(this,"maxUploadSizeMb",process.env.DENTRINO_MAX_UPLOAD_SIZE_MB||15),q(this,"maxUploadSizeBytes",1024*this.maxUploadSizeMb*1024),q(this,"instSimSecretToken",process.env.DENTRINO_INSTSIM_SECRET_TOKEN||"test-instsim-secret"),q(this,"instSimRecaptchaClientKey",process.env.DENTRINO_INSTSIM_RECAPTCHA_CLIENT_KEY),q(this,"instSimFirebaseApiKey",process.env.DENTRINO_INSTSIM_FIREBASE_API_KEY),q(this,"instSimFirebaseAuthDomain",process.env.DENTRINO_INSTSIM_FIREBASE_AUTH_DOMAIN),q(this,"instSimFirebaseProjectId",process.env.DENTRINO_INSTSIM_FIREBASE_PROJECT_ID),q(this,"instSimFirebaseStorageBucket",process.env.DENTRINO_INSTSIM_FIREBASE_STORAGE_BUCKET),q(this,"instSimFirebaseMessagingSenderId",process.env.DENTRINO_INSTSIM_FIREBASE_MESSAGING_SENDER_ID),q(this,"instSimFirebaseAppId",process.env.DENTRINO_INSTSIM_FIREBASE_APP_ID),q(this,"instSimFirebaseMeasurementId",process.env.DENTRINO_INSTSIM_FIREBASE_MEASUREMENT_ID)},e&&M(t.prototype,e),r&&M(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r}()),W=r(86),B=r.n(W),z=r(75),Y=r.n(z),H=r(52),K=r(41),J=r.n(K);function Q(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==r)return;var n,o,i=[],a=!0,c=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(i.push(n.value),!e||i.length!==e);a=!0);}catch(t){c=!0,o=t}finally{try{a||null==r.return||r.return()}finally{if(c)throw o}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return $(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return $(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function V(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var X=new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r,n;return e=t,(r=[{key:"base64",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{padding:!0},r=Buffer.from(t).toString("base64");return e.padding?r:r.replace(/=+$/g,"")}},{key:"base64Decode",value:function(t){return Buffer.from(t,"base64").toString()}},{key:"urlSafeBase64",value:function(t){return encodeURIComponent(this.base64(t,{padding:!1}).replace(/\+/g,"-").replace(/\//g,"_"))}},{key:"urlSafeBase64Decode",value:function(t){return this.base64Decode(decodeURIComponent(t).replace(/-/g,"+").replace(/_/g,"/"))}},{key:"sha1",value:function(t){var e=B.a.create();return e.update(t),e.hex()}},{key:"sha256",value:function(t){var e=Y.a.create();return e.update(t),e.hex()}},{key:"hmac",value:function(t,e){var r=Y.a.hmac.create(e);return r.update(t),r.hex()}},{key:"encrypt",value:function(t,e){try{"string"==typeof t&&(t=Buffer.from(t,"utf8"));var r=J.a.randomBytes(16),n=J.a.randomBytes(32),o=J.a.scryptSync(e,n,32),i=J.a.createCipheriv("aes-256-cbc",o,r),a=Buffer.concat([i.update(t),i.final()]),c=r.toString("base64"),u=n.toString("base64");return[a.toString("base64"),c,u].join(":")}catch(t){return console.warn("Ignoring encryption error:",t),null}}},{key:"decrypt",value:function(t,e){var r=null;try{"string"!=typeof t&&(t=t.toString("utf8"));var n=Q(t.split(":"),3),o=n[0],i=n[1],a=n[2],c=Buffer.from(i,"base64"),u=Buffer.from(a,"base64"),s=Buffer.from(o,"base64"),l=J.a.scryptSync(e,u,32),f=J.a.createDecipheriv("aes-256-cbc",l,c);r=Buffer.concat([f.update(s),f.final()])}catch(t){console.warn("Ignoring decryption error:",t)}return r}},{key:"md5",value:function(t){var e=J.a.createHash("md5");return e.update(t),e.digest("hex")}},{key:"verifySignatureHmac",value:function(t,e,r){return this.hmac(e,r)==t}},{key:"genericUUID",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_-.,!@#$%&*()+=[]{}/\\<>;:".split(""),r="",n=0;n<t;n++)r+=e[Math.floor(Math.random()*e.length)];return r}},{key:"uuid",value:function(){return Object(H.v4)()}},{key:"newSecret",value:function(){var t=J.a.randomBytes(32).toString("hex"),e=Object(H.v4)();return this.hmac(t,e)}}])&&V(e.prototype,r),n&&V(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}());function Z(t){return(Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function tt(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */tt=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var o=e&&e.prototype instanceof f?e:f,i=Object.create(o.prototype),a=new S(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return L()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=b(a,r);if(c){if(c===l)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=s(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(t,r,a),i}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var l={};function f(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(k([])));v&&v!==e&&r.call(v,o)&&(d=v);var m=p.prototype=f.prototype=Object.create(d);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){var n;this._invoke=function(o,i){function a(){return new e((function(n,a){!function n(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==Z(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,a,c)}),(function(t){n("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,c)}))}c(u.arg)}(o,i,n,a)}))}return n=n?n.then(a,a):a()}}function b(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=s(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function k(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:L}}function L(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},g(w.prototype),c(w.prototype,i,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(u(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=k,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),E(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:k(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function et(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function rt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var nt=new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r,n,o,i;return e=t,(r=[{key:"getOrigin",value:function(t){return this.normalizeParamValue(t.get("Origin")||t.get("Referer"))}},{key:"getSignature",value:function(t){var e=this.normalizeParamValue(t.get(U.signatureHeaderName));if(!e)return null;var r=e.match(/^Bearer\s+(.*)\s*$/);if(!r)return null;var n=X.base64Decode(r[1]);return n||null}},{key:"respondError",value:function(t,e,r){return t.status(e).json({error:r})}},{key:"setAllowingCors",value:function(t,e){var r=nt.normalizedOriginForCors(t);if(r){var n=["authorization"].filter((function(e){return t.headers[e]}));return n.push("*"),nt.setCors(e,{hosts:r,methods:t.method,headers:n})}}},{key:"normalizedOriginForCors",value:function(t){var e=nt.getOrigin(t);if(e)return nt.normalizeOrigin(e,t.protocol)}},{key:"normalizeOrigin",value:function(t,e){if(t){var r=new D(t);return r.protocol||(r.protocol=e),r.toString({path:!1})}}},{key:"setCors",value:function(t,e){var r=e.hosts,n=e.methods,o=e.headers;Array.isArray(r)&&(r=r.join(", ")),Array.isArray(n)&&(n=n.join(", ")),Array.isArray(o)&&(o=o.join(", ")),t.set({"Access-Control-Allow-Origin":r,"Access-Control-Allow-Methods":n,"Access-Control-Allow-Headers":o})}},{key:"normalizeParamValue",value:function(t){return this.isSet(t)?t:null}},{key:"isSet",value:function(t){return"string"==typeof t&&""!==t&&void 0!==t}},{key:"parseForm",value:(o=tt().mark((function t(e,r){return tt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,n){e.parse(r,(function(e,r,o){e?n(e):t({fields:r,files:o})}))})));case 1:case"end":return t.stop()}}),t)})),i=function(){var t=this,e=arguments;return new Promise((function(r,n){var i=o.apply(t,e);function a(t){et(i,r,n,a,c,"next",t)}function c(t){et(i,r,n,a,c,"throw",t)}a(void 0)}))},function(t,e){return i.apply(this,arguments)})},{key:"toDataUrl",value:function(t,e){return"data:".concat(e,";base64,").concat(X.base64(t))}}])&&rt(e.prototype,r),n&&rt(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}()),ot=r(47),it=r.n(ot);r(68),r(40),r(96),r(97),r(98),r(58),r(38),r(99),r(100),r(101),r(102);function at(t,e){var r,n=(r=t)?Array.isArray(r)?r:r.split(/\s*[|]\s*/g):[];return n?n.map((function(t){var r=t.split(/\s*[;]\s*/),n={};return r.forEach((function(t,r){var o=e[r];n[o]=t})),n})):[]}var ct=["","false","undefined","null","0","no","-1"];function ut(t){return!!t&&!(!(t=String(t).trim().toLowerCase())||ct.includes(t))}function st(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function lt(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var ft=new(function(){return t=function t(){var e,r,n,o=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),lt(this,"name",process.env.NODE_ENV||"development"),lt(this,"isProduction",(function(){return"production"===o.name})),lt(this,"isStaging",(function(){return"staging"===o.name})),lt(this,"isTest",(function(){return"test"===o.name})),lt(this,"isDevelopment",(function(){return"development"===o.name})),lt(this,"isLocal",(function(){return o.isTest()||o.isDevelopment()})),lt(this,"isNonLocal",(function(){return!o.isLocal()})),lt(this,"gcloudBucket",process.env.DENTRINO_GCLOUD_BUCKET||"dentrino-test.appspot.com"),lt(this,"port",(e=process.env.PORT||"3000",r=parseInt(e,10),isNaN(r)?e:r>=0&&r)),lt(this,"host",process.env.HOST||"0.0.0.0"),lt(this,"masterHost",process.env.MASTER_HOST),lt(this,"googleProjects",function(t){var e=at(t,["projectKey","projectId","credentialPath"]);if(!e)return{};var r=e.map((function(t){return t.projectId||(projectId="dentrino-local"),t.credentialPath&&(a.a.isAbsolute(t.credentialPath)||(t.credentialPath=a.a.resolve(t.credentialPath)),t.credentialCfg=JSON.parse(j.a.readFileSync(t.credentialPath))),[t.projectKey,t]}));return Object.fromEntries(r)}(process.env.DENTRINO_GOOGLE_PROJECTS||"default;dentrino-local")),lt(this,"firestoreEmulatorHost",process.env.FIRESTORE_EMULATOR_HOST||(this.isTest()?"localhost:8080":void 0)),lt(this,"firestoreEmulatorDatabaseUrl",this.firestoreEmulatorHost?"http://".concat(this.firestoreEmulatorHost):void 0),lt(this,"rateLimitDisabled",ut(process.env.DENTRINO_RATE_LIMIT_DISABLED)),lt(this,"rateLimitIgnore",ut(process.env.DENTRINO_RATE_LIMIT_IGNORE)),lt(this,"recaptchaIgnore",ut(process.env.DENTRINO_RECAPTCHA_IGNORE)),lt(this,"sentryDsn",process.env.SENTRY_DSN),lt(this,"logLevel",process.env.DENTRINO_LOG_LEVEL),lt(this,"redis",{host:process.env.DENTRINO_REDIS_HOSTNAME,port:process.env.DENTRINO_REDIS_PORT,db:process.env.DENTRINO_REDIS_DB}),lt(this,"redisPubsub",{host:process.env.DENTRINO_REDIS_HOSTNAME,port:process.env.DENTRINO_REDIS_PORT,db:process.env.DENTRINO_REDIS_PUBSUB_DB}),lt(this,"userRateLimit",{amount:parseFloat(process.env.DENTRINO_USER_RATE_LIMIT_AMOUNT||5),timeWindow:parseFloat(process.env.DENTRINO_USER_RATE_LIMIT_TIME||6e4)}),lt(this,"ipRateLimit",{amount:parseFloat(process.env.DENTRINO_IP_RATE_LIMIT_AMOUNT||20),timeWindow:parseFloat(process.env.DENTRINO_IP_RATE_LIMIT_TIME||36e5)}),lt(this,"clientRateLimit",{amount:parseFloat(process.env.DENTRINO_CLIENT_RATE_LIMIT_AMOUNT||100),timeWindow:parseFloat(process.env.DENTRINO_CLIENT_RATE_LIMIT_TIME||6e4)}),lt(this,"workerContentEncryptionSecret",process.env.DENTRINO_SIMULATION_WORKER_CONTENT_ENCRYPTION_SECRET||"dev-worker-secret"),lt(this,"apiResponsesWithAllDebugData",ut(process.env.DENTRINO_API_RESPONSES_WITH_ALL_DEBUG_DATA)),lt(this,"quickApiRouteTimeout",parseFloat(process.env.DENTRINO_QAPI_ROUTE_TIMEOUT||60)),lt(this,"quickApiSimulationQueueTimeout",parseFloat(process.env.DENTRINO_QAPI_SIMULATION_QUEUE_TIMEOUT||15)),lt(this,"quickApiInputUploadTimeout",parseFloat(process.env.DENTRINO_QAPI_INPUT_UPLOAD_TIMEOUT||15)),lt(this,"quickApiSimulationTimeout",parseFloat(process.env.DENTRINO_QAPI_SIMULATION_TIMEOUT||15)),lt(this,"quickApiRecaptchaTimeout",parseFloat(process.env.DENTRINO_QAPI_RECAPTCHA_TIMEOUT||15)),lt(this,"quickApiResultsUploadTimeout",parseFloat(process.env.DENTRINO_QAPI_RESULTS_UPLOAD_TIMEOUT||15)),lt(this,"quickApiMaxUploadSizeMb",process.env.DENTRINO_QAPI_MAX_UPLOAD_SIZE_MB||15),lt(this,"quickApiMaxUploadSizeBytes",1024*this.quickApiMaxUploadSizeMb*1024),lt(this,"quickApiRateLimit_timeWindowSeconds",parseFloat(process.env.DENTRINO_QAPI_RLIMIT_TIME_WINDOW_SECONDS||10)),lt(this,"quickApiRateLimit_clientSimulationsPerSecond",parseFloat(process.env.DENTRINO_QAPI_RLIMIT_CLIENT_SIMULATIONS_PER_SECOND||6)),lt(this,"quickApiRateLimit_clientRequestsPerSecond",parseFloat(process.env.DENTRINO_QAPI_RLIMIT_CLIENT_REQUESTS_PER_SECOND||25)),lt(this,"quickApiRateLimit_ipSimulationsPerSecond",parseFloat(process.env.DENTRINO_QAPI_RLIMIT_IP_SIMULATIONS_PER_SECOND||1/3)),lt(this,"quickApiRateLimit_ipRequestsPerSecond",parseFloat(process.env.DENTRINO_QAPI_RLIMIT_IP_REQUESTS_PER_SECOND||1)),lt(this,"quickApiRateLimit_clientSimulationsPerTimeWindow",this.quickApiRateLimit_clientSimulationsPerSecond*this.quickApiRateLimit_timeWindowSeconds),lt(this,"quickApiRateLimit_clientRequestsPerTimeWindow",this.quickApiRateLimit_clientRequestsPerSecond*this.quickApiRateLimit_timeWindowSeconds),lt(this,"quickApiRateLimit_ipSimulationsPerTimeWindow",this.quickApiRateLimit_ipSimulationsPerSecond*this.quickApiRateLimit_timeWindowSeconds),lt(this,"quickApiRateLimit_ipRequestsPerTimeWindow",this.quickApiRateLimit_ipRequestsPerSecond*this.quickApiRateLimit_timeWindowSeconds),lt(this,"supportedImagesStr",process.env.DENTRINO_SUPPORTED_IMAGES||"jpg,jpeg,png,heic,heif,avif"),lt(this,"supportedImagesFilepathRegex","string"!=typeof(n=this.supportedImagesStr)?n:(n=n.replaceAll(/,/g,"|").replaceAll(/\s/g,""),new RegExp("^(.*\\.)?(?<ext>".concat(n,")$"),"i"))),lt(this,"instSimIpRateLimitMinutely",{amount:parseFloat(process.env.DENTRINO_INSTSIM_IP_RATE_LIMIT_MINUTELY_AMOUNT||3),timeWindow:parseFloat(6e4)}),lt(this,"instSimIpRateLimitHourly",{amount:parseFloat(process.env.DENTRINO_INSTSIM_IP_RATE_LIMIT_HOURLY_AMOUNT||5),timeWindow:parseFloat(36e5)}),lt(this,"instSimIpRateLimitDaily",{amount:parseFloat(process.env.DENTRINO_INSTSIM_IP_RATE_LIMIT_DAILY_AMOUNT||20),timeWindow:parseFloat(864e5)}),lt(this,"instSimUploadTimeout",parseFloat(process.env.DENTRINO_INSTSIM_UPLOAD_TIMEOUT||15)),lt(this,"instSimRouteTimeout",parseFloat(process.env.DENTRINO_INSTSIM_ROUTE_TIMEOUT||60)),lt(this,"instSimEstimatedDuration",parseFloat(process.env.DENTRINO_INSTSIM_ESTIMATED_DURATION||5)),lt(this,"instSimMixFactor",parseFloat(process.env.DENTRINO_INSTSIM_MIX_FACTOR||.1)),lt(this,"instSimBrightness",parseFloat(process.env.DENTRINO_INSTSIM_BRIGHTNESS||1)),lt(this,"instSimWhiten",parseFloat(process.env.DENTRINO_INSTSIM_WHITEN||.3)),lt(this,"instSimPoisson",ut(process.env.DENTRINO_INSTSIM_POISSON)),lt(this,"instSimGiveUpStartTimeout",this.instSimRouteTimeout-this.instSimEstimatedDuration),lt(this,"instSimRouter",ut(process.env.DENTRINO_INSTSIM_ROUTER)),lt(this,"instSimTokenDisabled",ut(process.env.DENTRINO_INSTSIM_TOKEN_DISABLED)),lt(this,"instSimRecaptchaSecretKey",process.env.DENTRINO_INSTSIM_RECAPTCHA_SECRET_KEY),lt(this,"disableXForwardedForCheck",ut(process.env.DENTRINO_INSTSIM_DISABLE_X_FORWARDED_FOR_CHECK))},e&&st(t.prototype,e),r&&st(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r}()),ht=it.a.createLogger({level:ft.logLevel||"info",levels:{error:0,warn:1,info:2,http:3,verbose:4,debug:5,debugverbose:6,silly:7},format:it.a.format.combine(it.a.format.errors({stack:!0}),it.a.format.timestamp(),it.a.format.printf((function(t){var e=t.level,r=t.message,n=(t.label,t.timestamp),o=t.stack,i="".concat(n," [").concat(e,"] ").concat(r);return o&&(i="".concat(i," - ").concat(o)),i}))),transports:[new it.a.transports.Console]});function pt(t){return(pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function dt(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */dt=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var o=e&&e.prototype instanceof f?e:f,i=Object.create(o.prototype),a=new S(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return L()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=b(a,r);if(c){if(c===l)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=s(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(t,r,a),i}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var l={};function f(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(k([])));v&&v!==e&&r.call(v,o)&&(d=v);var m=p.prototype=f.prototype=Object.create(d);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){var n;this._invoke=function(o,i){function a(){return new e((function(n,a){!function n(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==pt(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,a,c)}),(function(t){n("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,c)}))}c(u.arg)}(o,i,n,a)}))}return n=n?n.then(a,a):a()}}function b(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=s(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function k(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:L}}function L(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},g(w.prototype),c(w.prototype,i,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(u(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=k,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),E(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:k(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function yt(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function vt(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){yt(i,n,o,a,c,"next",t)}function c(t){yt(i,n,o,a,c,"throw",t)}a(void 0)}))}}function mt(t){return gt("route",t,{typename:"async",skipNextCallOnSuccess:!0})}function gt(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.typename,o=void 0===n?"asyncMiddleware":n,i=r.skipNextCallOnSuccess,a=void 0!==i&&i;return function(){var r=vt(dt().mark((function r(n,i,c){var u,s,l;return dt().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return ht.debugverbose("[".concat(o,":").concat(t,"] Starting")),u=!1,s=function(){if(u)ht.debugverbose("[asyncMiddleware:".concat(t,"] next was called already. skipping call"));else{u=!0;for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];a&&0===r.length?ht.debugverbose("[asyncMiddleware:".concat(t,"] skip next call on success is enabled. skipping call")):(ht.debugverbose("[".concat(o,":").concat(t,"] Calling Next: ").concat(r)),c.apply(void 0,r),ht.debugverbose("[".concat(o,":").concat(t,"] After Next")))}},l=St(vt(dt().mark((function t(){return dt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e(n,i,s));case 1:case"end":return t.stop()}}),t)})))),r.next=6,l.then((function(){return s()})).catch(s);case 6:return r.abrupt("return",r.sent);case 7:case"end":return r.stop()}}),r)})));return function(t,e,n){return r.apply(this,arguments)}}()}function wt(t,e,r){return bt.apply(this,arguments)}function bt(){return(bt=vt(dt().mark((function t(e,r,n){return dt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,o){var i=function(e){St(e).then(t).catch(o)};St(vt(dt().mark((function t(){return dt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e(r,n,i));case 1:case"end":return t.stop()}}),t)}))))})));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function xt(t,e,r){return Et.apply(this,arguments)}function Et(){return(Et=vt(dt().mark((function t(e,r,n){var o,i;return dt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:o=0;case 1:if(!(o<e.length)){t.next=8;break}return i=e[o],t.next=5,wt(i,r,n);case 5:o++,t.next=1;break;case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function St(t){return kt.apply(this,arguments)}function kt(){return(kt=vt(dt().mark((function t(e){var r;return dt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("function"==typeof e&&(r=function(){var t=vt(dt().mark((function t(){return dt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e());case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),e=r()),!(e instanceof Error)){t.next=5;break}return t.abrupt("return",Promise.reject(e));case 5:if(!e||!e.error){t.next=9;break}return t.abrupt("return",Promise.reject(e.error));case 9:return t.abrupt("return",Promise.resolve(e));case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}r(45),r(28),r(46),r(34);var Lt=r(87),jt=r.n(Lt);function Ot(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var _t=new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r,n;return e=t,(r=[{key:"newRedis",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e?t:Object.assign({},ft.redis,t),n=jt.a.createClient(r);return n.on("error",(function(t){ht.error("Error on Redis",t),n.isOnline=!1})),n.on("ready",(function(){n.isOnline=!0})),n}},{key:"newRedisPubsub",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.newRedis(Object.assign({},ft.redisPubsub,t),!0)}}])&&Ot(e.prototype,r),n&&Ot(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}()),Tt=_t.newRedis(),Pt=_t.newRedis({return_buffers:!0}),It=_t.newRedisPubsub(),Nt=(Object(I.promisify)(Tt.flushall).bind(Tt),{});function At(t){return Nt[t]||(Nt[t]=[]),new Promise((function(e,r){try{var n=It.duplicate();Nt[t].push(n),n.on("message",(function(t,r){ht.verbose("MESSAGE RECEIVED ".concat(r)),n.unsubscribe(),n.quit(),e(r)})),n.on("error",(function(t){r(t)})),n.subscribe(t)}catch(t){r(t)}}))}var Ct=Dt({oneSecond:1});Dt({oneSecond:1e3}),Dt({oneSecond:1e6}),Dt({oneSecond:1e9});function Rt(){return Ft()/1e3}function Ft(){return(new Date).getTime()}function Gt(){return(new Date).toLocaleString("en-US",{hour12:!1})}function Dt(t){var e=t.oneSecond,r={};return r.seconds=e,r.milliseconds=r.seconds/1e3,r.microseconds=r.milliseconds/1e3,r.nanoseconds=r.microseconds/1e3,r.minutes=60*r.seconds,r.hours=60*r.minutes,r.days=24*r.hours,r.secs=r.seconds,r.mins=r.minutes,r.millis=r.milliseconds,r.micros=r.microseconds,r.nanos=r.nanoseconds,r.MILLISECONDS=r.milliseconds,r.MICROSECONDS=r.microseconds,r.NANOSECONDS=r.nanoseconds,r.SECONDS=r.seconds,r.MINUTES=r.minutes,r.HOURS=r.hours,r.DAYS=r.days,r.SECS=r.secs,r.MINS=r.mins,r.MILLIS=r.millis,r.MICROS=r.micros,r.NANOS=r.nanos,r}function Mt(t){return(Mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function qt(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */qt=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var o=e&&e.prototype instanceof f?e:f,i=Object.create(o.prototype),a=new S(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return L()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=b(a,r);if(c){if(c===l)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=s(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(t,r,a),i}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var l={};function f(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(k([])));v&&v!==e&&r.call(v,o)&&(d=v);var m=p.prototype=f.prototype=Object.create(d);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){var n;this._invoke=function(o,i){function a(){return new e((function(n,a){!function n(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==Mt(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,a,c)}),(function(t){n("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,c)}))}c(u.arg)}(o,i,n,a)}))}return n=n?n.then(a,a):a()}}function b(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=s(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function k(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:L}}function L(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},g(w.prototype),c(w.prototype,i,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(u(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=k,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),E(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:k(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function Ut(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Wt(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Ut(i,n,o,a,c,"next",t)}function c(t){Ut(i,n,o,a,c,"throw",t)}a(void 0)}))}}function Bt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function zt(t,e){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}function Yt(t,e,r){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return r}var Ht=Object(I.promisify)(Tt.zcount).bind(Tt),Kt="dent-rl",Jt=new WeakSet,Qt=new WeakSet,$t=new WeakSet,Vt=new WeakSet,Xt=function(){function t(e){var r=e.limit,n=e.expiresIn;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),zt(this,Vt),zt(this,$t),zt(this,Qt),zt(this,Jt),this.limit=r,this.expiresIn=n}var e,r,n,o,i;return e=t,(r=[{key:"useSlotFrom",value:(i=Wt(qt().mark((function t(e){var r,n,o=this,i=arguments;return qt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=!(i.length>1&&void 0!==i[1])||i[1],!ft.rateLimitDisabled){t.next=3;break}return t.abrupt("return",!0);case 3:return"string"==typeof e&&(e=[e]),n=e.map((function(t){return Yt(o,Jt,Zt).call(o,t)})),t.abrupt("return",Yt(this,Qt,te).call(this,n,r));case 6:case"end":return t.stop()}}),t,this)}))),function(t){return i.apply(this,arguments)})},{key:"manualCountFor",value:(o=Wt(qt().mark((function t(e){var r=this;return qt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!ft.rateLimitDisabled){t.next=2;break}return t.abrupt("return",!0);case 2:"string"==typeof e&&(e=[e]),e.map((function(t){return Yt(r,Jt,Zt).call(r,t)})).forEach((function(t){return Yt(r,Vt,oe).call(r,t)}));case 5:case"end":return t.stop()}}),t)}))),function(t){return o.apply(this,arguments)})}])&&Bt(e.prototype,r),n&&Bt(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Zt(t){return[Kt,t].join(":")}function te(t){return ee.apply(this,arguments)}function ee(){return(ee=Wt(qt().mark((function t(e){var r,n,o,i=this,a=arguments;return qt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=!(a.length>1&&void 0!==a[1])||a[1],t.next=3,Promise.all(e.map((function(t){return Yt(i,$t,re).call(i,t)})));case 3:return n=t.sent,(o=!n.includes(!1))&&r&&e.forEach((function(t){return Yt(i,Vt,oe).call(i,t)})),t.abrupt("return",o);case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function re(t){return ne.apply(this,arguments)}function ne(){return(ne=Wt(qt().mark((function t(e){var r,n;return qt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Ht(e,Ft()-this.expiresIn,"+inf");case 2:return r=t.sent,n=r<this.limit,t.abrupt("return",!!ft.rateLimitIgnore||n);case 5:case"end":return t.stop()}}),t,this)})))).apply(this,arguments)}function oe(t){return ie.apply(this,arguments)}function ie(){return(ie=Wt(qt().mark((function t(e){return qt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:Tt.zadd(e,Ft(),Object(H.v4)()),Tt.pexpire(e,this.expiresIn);case 2:case"end":return t.stop()}}),t,this)})))).apply(this,arguments)}r(103),r(104),r(105),r(106),r(107),r(108),r(109),r(110),r(111),r(112),r(113),r(114),r(115),r(116),r(117),r(118),r(119),r(120),r(121),r(122),r(123),r(124),r(125),r(126),r(127),r(128),r(129),r(130),r(131),r(59),r(79),r(132),r(60),r(61),r(133),r(80);function ae(t){return(ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ce(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ue(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function se(t,e){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}function le(t,e,r){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return r}var fe=new WeakSet,he=new WeakSet,pe=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};ce(this,t),se(this,he),se(this,fe),this.tags={},this.add(e)}var e,r,n;return e=t,(r=[{key:"add",value:function(e,r){var n=this,o=e,i=r;try{if(void 0===r&&"string"!=typeof e){var a=void 0;if(e instanceof t?a=e.tags:"object"===ae(e)&&null!==e&&(a=e),a)return void Object.keys(a).forEach((function(t){return n.add(t,a[t])}))}if(e=le(this,fe,de).call(this,e),r=le(this,he,ye).call(this,r,e),!e)throw new Error("Invalid tag label: ".concat(o));this.tags[e]=r}catch(t){if(ht.error("(ignored on production) Couldn't Add tag pair ".concat(o,":").concat(i)),!ft.isProduction())throw t;ht.error(t)}}},{key:"labels",value:function(){return Object.keys(this.tags)}},{key:"values",value:function(){return Object.values(this.tags)}}])&&ue(e.prototype,r),n&&ue(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function de(t){return"string"!=typeof t?null:(t=(t=(t=(t=(t=t.trim()).replace(/[_\s]/g,"-")).replace(/[^a-zA-Z0-9.:-]/g,"")).replace(/^([A-Z][A-Z]+)/g,(function(t,e){return"".concat(e.toLowerCase())}))).replace(/(?!^)-*([A-Z]+)/g,(function(t,e){return"-".concat(e.toLowerCase())}))).toLowerCase()}function ye(t,e){var r=ae(t);if(["boolean","undefined"].includes(r)||null===t)return String(t);if("string"!==r)throw new Error("Invalid tag value: ".concat(e,":").concat(t," : Value should be string, boolean, undefined or null"));return t}r(134);function ve(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==r)return;var n,o,i=[],a=!0,c=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(i.push(n.value),!e||i.length!==e);a=!0);}catch(t){c=!0,o=t}finally{try{a||null==r.return||r.return()}finally{if(c)throw o}}return i}(t,e)||ge(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function me(t){return function(t){if(Array.isArray(t))return we(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||ge(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ge(t,e){if(t){if("string"==typeof t)return we(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?we(t,e):void 0}}function we(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function be(t){return(be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function xe(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ee(t,e){if(e&&("object"===be(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Se(t)}function Se(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ke(t){var e="function"==typeof Map?new Map:void 0;return(ke=function(t){if(null===t||(r=t,-1===Function.toString.call(r).indexOf("[native code]")))return t;var r;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return Le(t,arguments,_e(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),Oe(n,t)})(t)}function Le(t,e,r){return(Le=je()?Reflect.construct.bind():function(t,e,r){var n=[null];n.push.apply(n,e);var o=new(Function.bind.apply(t,n));return r&&Oe(o,r.prototype),o}).apply(null,arguments)}function je(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function Oe(t,e){return(Oe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _e(t){return(_e=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Te(t,e){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}function Pe(t,e,r){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return r}var Ie=new WeakSet,Ne=new WeakSet,Ae=new WeakSet,Ce=new WeakSet,Re=new WeakSet,Fe=new WeakSet,Ge=new WeakSet,De=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Oe(t,e)}(c,t);var e,r,n,o,i,a=(e=c,r=je(),function(){var t,n=_e(e);if(r){var o=_e(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return Ee(this,t)});function c(t){var e,r=t.id,n=void 0===r?"internal-error":r,o=t.subtype,i=t.httpCode,u=t.debugMessage,s=t.publicMessage,l=t.subtypeIsPublic,f=void 0!==l&&l,h=t.cause,p=t.debugDetails,d=void 0===p?{}:p,y=t.tags,v=void 0===y?{}:y,m=t.logLevel,g=void 0===m?"error":m;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),u=u||s,h?(Te(Se(e=a.call(this,u)),Ge),Te(Se(e),Fe),Te(Se(e),Re),Te(Se(e),Ce),Te(Se(e),Ae),Te(Se(e),Ne),Te(Se(e),Ie),e.originalCause=h,Object.assign(Se(e),h),e.stack=h.stack):(Te(Se(e=a.call(this,u)),Ge),Te(Se(e),Fe),Te(Se(e),Re),Te(Se(e),Ce),Te(Se(e),Ae),Te(Se(e),Ne),Te(Se(e),Ie)),e.debugMessage=u,e.id=n,e.subtype=o,e.subtypeIsPublic=f,e.debugId=e.id+(e.subtype?":".concat(e.subtype):""),e.httpCode=i||500,e.debugDetails={},e.addDebugDetails(d),e.publicMessage=s,e.logLevel=g,e.tags=new pe,e.tags.add("error:id",e.id),e.subtype&&e.tags.add("error:subtype",e.subtype),e.tags.add("error:is-rich",!0),e.tags.add(v),Ee(e)}return n=c,i=[{key:"fromError",value:function(t){if(t instanceof c)return t;var e={nonRichError:!0};if(t&&t.error){var r=t.error;delete t.error,Object.assign(e,t),t=r}return"string"==typeof t&&(t=new Error(t)),!t instanceof Error?null:new c({id:"nodejs-error",subtype:String(t.code),debugMessage:t.message,cause:t,httpCode:t.status||t.httpCode,tags:{"error:is-rich":!1,"error:non-rich:code":String(t.code)},debugDetails:e})}},{key:"logTextFor",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.logText?t.logText(e):"".concat(t.message,"\n").concat(t.stack)}}],(o=[{key:"addTag",value:function(t,e){this.tags.add(t,e)}},{key:"addTags",value:function(t){this.tags.add(t)}},{key:"addDebugDetails",value:function(t){Object.assign(this.debugDetails,Pe(this,Ie,Me).call(this,t))}},{key:"logText",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.details,r=void 0===e||e,n="[".concat(this.debugId,"]: ").concat(this.debugMessage);return n+="\n".concat(this.stack),this.cause&&(n+="\n[cause] ".concat(c.logTextFor(this.cause,{details:r}))),r&&(n+="\nDETAILS: ".concat(JSON.stringify(this.debugDetails||{}))),n}},{key:"data",value:function(t){var e=t.isDebug,r=void 0!==e&&e,n=t.allInfo,o=void 0!==n&&n,i={id:this.id||"internal-error",subtype:this.subtype,message:this.publicMessage||"Unexpected Internal Error"};return(r||o)&&(i.debug={__ALERT__:"THIS DEBUG OBJECT WILL NOT EXIST IN PRODUCTION",debugId:this.debugId,message:this.debugMessage}),o&&Object.assign(i.debug,{details:this.debugDetails,tags:this.tags,errorLog:this.logText({details:!1})}),i}}])&&xe(n.prototype,o),i&&xe(n,i),Object.defineProperty(n,"prototype",{writable:!1}),c}(ke(Error));function Me(t){var e=be(t);if(!t||"string"!==e&&"object"!==e)return t;var r=Pe(this,Ne,qe).call(this,t);return r?Pe(this,Re,We).call(this,t,r):"string"===e?Pe(this,Ge,Be).call(this,t):"object"===e?Pe(this,Ce,Ue).call(this,t):t}function qe(t){var e=void 0;return t.buffer instanceof ArrayBuffer?e=me(t):t instanceof ArrayBuffer?e=me(new Uint8Array(t)):Array.isArray(t)&&(e=t),e}function Ue(t){var e=this,r=Object.assign({},t);if(Object.entries(t).forEach((function(t){var n=ve(t,2),o=n[0],i=n[1];o.startsWith("_")?delete r[o]:r[o]=Pe(e,Ie,Me).call(e,i)})),t.constructor!==Object){var n=t.constructor?t.constructor.name:void 0;r["[!]CONSTRUCTOR"]=n}if(Object.keys(t).length>25){var o=null;try{o=JSON.stringify(r)}catch(t){o=String(r)}return"[!] ".concat(Pe(this,Ie,Me).call(this,o))}return r}function We(t,e){var r=this;if(t.constructor!==Array)return Pe(this,Ie,Me).call(this,{"[!] CONSTRUCTOR":t.constructor.name,"[!] values":e});var n={null:0,number:0,string:0,boolean:0,undefined:0,all:0};t.forEach((function(t){var e=null===t?"null":be(t);e in n&&(n[e]++,n.all++)}));var o=n.number===t.length,i=7;o&&(i=20);var a=t.slice(0,i).map((function(t){return Pe(r,Ie,Me).call(r,t)}));return a.length!=t.length&&a.push("[!]..."),o?"[!] ".concat(Pe(this,Ie,Me).call(this,JSON.stringify(a))):a}function Be(t){var e=t.slice(0,150);return e.length!==t.length&&(e+=" [!]..."),e}var ze=r(64),Ye=r.n(ze);function He(t){return(He="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ke(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Ke=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var o=e&&e.prototype instanceof f?e:f,i=Object.create(o.prototype),a=new S(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return L()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=b(a,r);if(c){if(c===l)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=s(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(t,r,a),i}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var l={};function f(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(k([])));v&&v!==e&&r.call(v,o)&&(d=v);var m=p.prototype=f.prototype=Object.create(d);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){var n;this._invoke=function(o,i){function a(){return new e((function(n,a){!function n(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==He(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,a,c)}),(function(t){n("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,c)}))}c(u.arg)}(o,i,n,a)}))}return n=n?n.then(a,a):a()}}function b(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=s(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function k(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:L}}function L(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},g(w.prototype),c(w.prototype,i,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(u(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=k,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),E(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:k(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function Je(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Qe(t){var e=t.limit,r=t.expiresIn,n=t.lookup,o=void 0===n?function(t,e){return t.ip}:n,i=t.onBlocked,a=void 0===i?null:i,c=t.countIf,u=void 0===c?null:c;return gt("rateLimit.rateLimit",function(){var t,n=(t=Ke().mark((function t(n,i,c){var s,l,f;return Ke().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=new Xt({limit:e,expiresIn:r}),l=!u,f=o.apply(s,[n,i]),t.next=5,s.useSlotFrom(f,l);case 5:if(!t.sent){t.next=10;break}Ye()(i,(function(t,e){!l&&u.apply(s,[n,e])&&s.manualCountFor(f)})),t.next=15;break;case 10:if(!a){t.next=14;break}return t.abrupt("return",a(n,i,c));case 14:throw new De({httpCode:429,id:"too-many-requests",subtype:"rate-limit",subtypeIsPublic:!0,publicMessage:"Too Many Requests",logLevel:"debug",tags:{"error:rate-limit":"generic"}});case 15:case"end":return t.stop()}}),t)})),function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Je(i,n,o,a,c,"next",t)}function c(t){Je(i,n,o,a,c,"throw",t)}a(void 0)}))});return function(t,e,r){return n.apply(this,arguments)}}())}r(50),r(55),r(56);function $e(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Ve=new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r,n;return e=t,(r=[{key:"newOrderedId",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.uuidSize,r=void 0===e?8:e,n=9999999999999-Ft();return X.urlSafeBase64("".concat(n).concat(X.genericUUID(r)),{padding:!1})}},{key:"newSecret",value:function(){return X.newSecret()}}])&&$e(e.prototype,r),n&&$e(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}());function Xe(t){return(Xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ze(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==r)return;var n,o,i=[],a=!0,c=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(i.push(n.value),!e||i.length!==e);a=!0);}catch(t){c=!0,o=t}finally{try{a||null==r.return||r.return()}finally{if(c)throw o}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return tr(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return tr(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tr(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function er(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function rr(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?er(Object(r),!0).forEach((function(e){nr(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):er(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function nr(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function or(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */or=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var o=e&&e.prototype instanceof f?e:f,i=Object.create(o.prototype),a=new S(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return L()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=b(a,r);if(c){if(c===l)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=s(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(t,r,a),i}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var l={};function f(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(k([])));v&&v!==e&&r.call(v,o)&&(d=v);var m=p.prototype=f.prototype=Object.create(d);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){var n;this._invoke=function(o,i){function a(){return new e((function(n,a){!function n(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==Xe(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,a,c)}),(function(t){n("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,c)}))}c(u.arg)}(o,i,n,a)}))}return n=n?n.then(a,a):a()}}function b(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=s(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function k(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:L}}function L(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},g(w.prototype),c(w.prototype,i,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(u(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=k,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),E(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:k(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function ir(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function ar(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){ir(i,n,o,a,c,"next",t)}function c(t){ir(i,n,o,a,c,"throw",t)}a(void 0)}))}}function cr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ur(t,e){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}function sr(t,e,r){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return r}var lr=Object(I.promisify)(j.a.readFile),fr=Object(I.promisify)(Pt.get).bind(Pt),hr=Object(I.promisify)(Pt.setex).bind(Pt),pr=Object(I.promisify)(Pt.del).bind(Pt),dr=function(t){return t?fr(t):void 0},yr=function(t){return t?pr(t):void 0},vr=new WeakSet,mr=new WeakSet,gr=new WeakSet,wr=new WeakSet,br=new WeakSet,xr=new WeakSet,Er=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),ur(this,xr),ur(this,br),ur(this,wr),ur(this,gr),ur(this,mr),ur(this,vr)}var e,r,n,o;return e=t,r=[{key:"requestSimulation",value:(o=ar(or().mark((function e(r){var n,o,i,a,c,u,s,l,f,h,p,d,y,v,m,g,w;return or().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.id,o=r.photo,i=r.photoPath,a=r.expiresAt,c=void 0===a?0:a,u=r.options,s=void 0===u?{}:u,l=r.safe,f=void 0!==l&&l,n||(n=Ve.newOrderedId()),ht.verbose("[".concat(n,"] Requesting Simulation (").concat(JSON.stringify(s),")")),h="pipeline:listener:".concat(n,":photo"),o){e.next=8;break}return e.next=7,lr(i);case 7:o=e.sent;case 8:return p=Buffer.from(o,"binary"),e.next=11,sr(this,vr,Sr).call(this,n,p,h,c,s);case 11:return d=t.pubsubResponseKey(n),e.next=14,sr(this,mr,Lr).call(this,{pubsubChannel:d,safe:f});case 14:return y=e.sent,v=y.result,m=y.before,g=y.morphed,w=y.error,e.abrupt("return",{id:n,before:m,result:v,morphed:g,error:w,original:o,success:!w});case 20:case"end":return e.stop()}}),e,this)}))),function(t){return o.apply(this,arguments)})}],n=[{key:"pubsubRequestKey",value:function(){return"".concat("listener:pipeline-in-memory",":request")}},{key:"pubsubResponseKey",value:function(t){return"".concat("listener:pipeline-in-memory",":").concat(t,":response")}}],r&&cr(e.prototype,r),n&&cr(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Sr(t,e,r,n,o){return kr.apply(this,arguments)}function kr(){return(kr=ar(or().mark((function t(e,r,n,o,i){var a,c,u;return or().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=sr(this,wr,_r).call(this,r),t.next=3,hr(n,45,a);case 3:c=rr({photo_redis_key:n,expires_at:o},i),u=JSON.stringify({id:e,params:c}),It.publish(Er.pubsubRequestKey(),u),ht.verbose("[".concat(e,"]: Params Published: ").concat(u));case 7:case"end":return t.stop()}}),t,this)})))).apply(this,arguments)}function Lr(t){return jr.apply(this,arguments)}function jr(){return(jr=ar(or().mark((function t(e){var r,n,o,i,a,c,u,s,l,f,h,p,d,y,v=this;return or().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.pubsubChannel,n=e.safe,t.next=3,At(r);case 3:if(o=t.sent,ht.verbose("Result Received ".concat(r," - ").concat(o)),!(i=JSON.parse(o)).error){t.next=8;break}return t.abrupt("return",sr(this,br,Tr).call(this,{message:i.error,safe:n}));case 8:return a=i.data.result_redis_key,c=i.data.before_redis_key,u=i.data.morphed_redis_key,t.next=13,Promise.all([dr(a),dr(c),dr(u)]);case 13:return s=t.sent.map((function(t){return sr(v,gr,Or).call(v,t)})),l=Ze(s,3),f=l[0],h=l[1],p=l[2],yr(a),yr(c),yr(u),d={result:f,before:h,morphed:p},f&&h||(y=sr(this,br,Tr).call(this,{message:"Couldn't find simulation result recorded",safe:n}),Object.assign(d,y)),t.abrupt("return",d);case 24:case"end":return t.stop()}}),t,this)})))).apply(this,arguments)}function Or(t){return t&&X.decrypt(t,ft.workerContentEncryptionSecret)||t}function _r(t){return t&&X.encrypt(t,ft.workerContentEncryptionSecret)||t}function Tr(t){var e=t.message,r=t.safe;if(e){if(e.match(/timeout/i))return sr(this,xr,Pr).call(this,{message:e,safe:r});var n="Error when executing simulation",o="generic",i=void 0;e.match(/detect/i)?(n=e,o="no-face",i="no-face"):e.match(/find.*result/)&&(o="no-result-recorded");var a=new De({httpCode:422,id:"simulation-error",subtype:i,subtypeIsPublic:!0,publicMessage:n,debugMessage:e,logLevel:"error",tags:{"simulation:success":!1,"simulation:error":o}});if(r)return{error:a};throw a}}function Pr(t){var e=t.message,r=t.safe,n=new De({httpCode:504,id:"timeout",subtype:"simulation-timeout",publicMessage:"Operation took too long",debugMessage:e,logLevel:"error",tags:{"simulation:success":!1,"error:timeout":"simulation-queue-wait","simulation:error":"queue-wait"}});if(r)return{error:n};throw n}r(135);var Ir=r(76),Nr=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.projectKey;if(e){var r=ft.googleProjects[e]||{},n=r.credentialPath;if(n)return new Ir.Storage({keyFilename:n})}return new Ir.Storage};function Ar(t){return(Ar="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Cr(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Cr=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var o=e&&e.prototype instanceof f?e:f,i=Object.create(o.prototype),a=new S(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return L()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=b(a,r);if(c){if(c===l)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=s(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(t,r,a),i}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var l={};function f(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(k([])));v&&v!==e&&r.call(v,o)&&(d=v);var m=p.prototype=f.prototype=Object.create(d);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){var n;this._invoke=function(o,i){function a(){return new e((function(n,a){!function n(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==Ar(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,a,c)}),(function(t){n("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,c)}))}c(u.arg)}(o,i,n,a)}))}return n=n?n.then(a,a):a()}}function b(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=s(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function k(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:L}}function L(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},g(w.prototype),c(w.prototype,i,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(u(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=k,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),E(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:k(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function Rr(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==r)return;var n,o,i=[],a=!0,c=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(i.push(n.value),!e||i.length!==e);a=!0);}catch(t){c=!0,o=t}finally{try{a||null==r.return||r.return()}finally{if(c)throw o}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return Fr(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Fr(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Fr(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Gr(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Dr(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Gr(i,n,o,a,c,"next",t)}function c(t){Gr(i,n,o,a,c,"throw",t)}a(void 0)}))}}function Mr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function qr(t,e){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}function Ur(t,e,r){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return r}var Wr=new WeakSet,Br=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),qr(this,Wr),this.bucket=e}var e,r,n,o,i;return e=t,r=[{key:"jsonToUpload",value:(i=Dr(Cr().mark((function t(e){var r,n,o,i,a,c,u,s,l,f,h;return Cr().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.keyName,n=e.expiresInSeconds,o=e.contentType,i=e.contentMD5,a=e.maxSizeInMegabytes,c={"x-goog-content-length-range":"0,".concat(1024*a*1024)},u={version:"v4",action:"write",contentType:o,expires:Date.now()+1e3*n,contentMd5:i,extensionHeaders:c},t.next=5,this.bucket.file(r).getSignedUrl(u);case 5:return s=t.sent,l=Rr(s,1),f=l[0],h=Object.assign({"Content-MD5":i,"Content-Type":o},c),t.abrupt("return",Ur(this,Wr,zr).call(this,"put",f,h));case 10:case"end":return t.stop()}}),t,this)}))),function(t){return i.apply(this,arguments)})},{key:"urlToGet",value:(o=Dr(Cr().mark((function t(e,r){var n,o,i,a,c;return Cr().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=r.expiresInSeconds,o={version:"v4",action:"read",expires:Date.now()+1e3*n,virtualHostedStyle:!0},t.next=4,this.bucket.file(e).getSignedUrl(o);case 4:return i=t.sent,a=Rr(i,1),c=a[0],t.abrupt("return",Ur(this,Wr,zr).call(this,"get",c));case 8:case"end":return t.stop()}}),t,this)}))),function(t,e){return o.apply(this,arguments)})}],n=[{key:"build",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.bucket,n=void 0===r?ft.gcloudBucket:r;return new t(Nr().bucket(n))}}],r&&Mr(e.prototype,r),n&&Mr(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function zr(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return{verb:t,url:e,headers:r}}r(69);function Yr(t){return(Yr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Hr(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Hr=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var o=e&&e.prototype instanceof f?e:f,i=Object.create(o.prototype),a=new S(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return L()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=b(a,r);if(c){if(c===l)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=s(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(t,r,a),i}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var l={};function f(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(k([])));v&&v!==e&&r.call(v,o)&&(d=v);var m=p.prototype=f.prototype=Object.create(d);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){var n;this._invoke=function(o,i){function a(){return new e((function(n,a){!function n(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==Yr(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,a,c)}),(function(t){n("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,c)}))}c(u.arg)}(o,i,n,a)}))}return n=n?n.then(a,a):a()}}function b(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=s(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function k(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:L}}function L(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},g(w.prototype),c(w.prototype,i,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(u(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=k,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),E(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:k(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function Kr(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Jr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Qr,$r,Vr=function(){function t(e){var r=e.externalTimedout,n=void 0===r?function(){return!1}:r,o=e.onTimeout,i=void 0===o?function(){return null}:o;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.timedout=!1,this.externalTimedout=n,this.blownTimeout=!1,this.onTimeout=i}var e,r,n;return e=t,(r=[{key:"exec",value:function(){var t,e=(t=Hr().mark((function t(e,r){var n,o,i,a=this;return Hr().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=void 0,o=void 0,i=null,t.next=5,Promise.race([new Promise((function(t,e){i=setTimeout((function(){a.timedout=!0,t()}),1e3*r)})),new Promise((function(t,r){try{e().then((function(e){n=e,t()})).catch((function(e){o=e,t()}))}catch(e){o=e,t()}}))]);case 5:if(null!==i&&clearTimeout(i),!this.blownTimeout){t.next=8;break}return t.abrupt("return",n);case 8:if(!this.hasTimedout()){t.next=12;break}throw this.blownTimeout=!0,this.onTimeout(),new Error("Timeout: Behavior took too long");case 12:if(!o){t.next=16;break}throw o;case 16:return t.abrupt("return",n);case 17:case"end":return t.stop()}}),t,this)})),function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Kr(i,n,o,a,c,"next",t)}function c(t){Kr(i,n,o,a,c,"throw",t)}a(void 0)}))});return function(t,r){return e.apply(this,arguments)}}()},{key:"hasTimedout",value:function(){return this.blownTimeout||this.timedout||this.externalTimedout()}}])&&Jr(e.prototype,r),n&&Jr(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Xr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Zr(t,e){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}function tn(t,e,r){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return r}var en=new(Qr=new WeakSet,$r=new WeakSet,function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Zr(this,$r),Zr(this,Qr)}var e,r,n;return e=t,(r=[{key:"create",value:function(t,e){var r=tn(this,$r,nn).call(this,t);return tn(this,Qr,rn).call(this,r,e)}},{key:"verify",value:function(t,e,r){var n=tn(this,$r,nn).call(this,e),o=tn(this,Qr,rn).call(this,n,r),i=tn(this,Qr,rn).call(this,n-1,r);return t===o||t===i}}])&&Xr(e.prototype,r),n&&Xr(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}());function rn(t,e){return X.hmac(X.sha1("&&%%95".concat(t,"23**@")),e)}function nn(t){return Math.round(t)%30}function on(t){return(on="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function an(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==r)return;var n,o,i=[],a=!0,c=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(i.push(n.value),!e||i.length!==e);a=!0);}catch(t){c=!0,o=t}finally{try{a||null==r.return||r.return()}finally{if(c)throw o}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return cn(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return cn(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function cn(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function un(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */un=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var o=e&&e.prototype instanceof f?e:f,i=Object.create(o.prototype),a=new S(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return L()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=b(a,r);if(c){if(c===l)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=s(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(t,r,a),i}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var l={};function f(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(k([])));v&&v!==e&&r.call(v,o)&&(d=v);var m=p.prototype=f.prototype=Object.create(d);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){var n;this._invoke=function(o,i){function a(){return new e((function(n,a){!function n(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==on(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,a,c)}),(function(t){n("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,c)}))}c(u.arg)}(o,i,n,a)}))}return n=n?n.then(a,a):a()}}function b(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=s(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function k(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:L}}function L(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},g(w.prototype),c(w.prototype,i,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(u(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=k,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),E(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:k(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function sn(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function ln(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){sn(i,n,o,a,c,"next",t)}function c(t){sn(i,n,o,a,c,"throw",t)}a(void 0)}))}}var fn=o.a.Router(),hn=Object(I.promisify)(j.a.readFile),pn=Qe({limit:ft.instSimIpRateLimitMinutely.amount,expiresIn:ft.instSimIpRateLimitMinutely.timeWindow,lookup:function(t,e){return"instant-simulation:minutely:".concat(t.ip)},onBlocked:function(t,e,r){throw new Error("Exceeded minutely IP rate limit")}}),dn=Qe({limit:ft.instSimIpRateLimitHourly.amount,expiresIn:ft.instSimIpRateLimitHourly.timeWindow,lookup:function(t,e){return"instant-simulation:hourly:".concat(t.ip)},countIf:function(t,e){return e.statusCode>=200&&e.statusCode<=299&&!e.locals.dentInstSimIsErrorPage},onBlocked:function(t,e,r){throw new Error("Exceeded hourly IP rate limit")}}),yn=Qe({limit:ft.instSimIpRateLimitDaily.amount,expiresIn:ft.instSimIpRateLimitDaily.timeWindow,lookup:function(t,e){return"instant-simulation:daily:".concat(t.ip)},onBlocked:function(t,e,r){throw new Error("Exceeded daily IP rate limit")}});function vn(){return(vn=ln(un().mark((function t(e,r,n,o){var i,a,c,u,s;return un().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(ht.error(e),!(i=Sn(e)).isSimulationError){t.next=12;break}return(a=n.locals.info).errorFullMessage=i.fullMessage,a.errorPrettyMessage=i.prettyMessage,t.next=8,hn(n.locals.photoPath);case 8:return c=t.sent,u=n.locals.photoExt,t.next=12,mn({original:c,originalExt:u,info:a});case 12:return s={success:!1,error_message:i.prettyMessage,error_code:i.errorCode,is_simulation_error:i.isSimulationError},n.locals.dentInstSimIsErrorPage=!0,t.abrupt("return",n.render("instant_simulations/index",En({subtitle:"Try Again",simulation:s})));case 15:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function mn(t){return gn.apply(this,arguments)}function gn(){return(gn=ln(un().mark((function t(e){var r,n,o,i,c,u,s,l,f,h,p,d,y,v,m,g,w,b,x,E,S,k,L;return un().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.originalExt,n=e.original,o=e.before,i=void 0===o?null:o,c=e.result,u=void 0===c?null:c,s=e.morphed,l=void 0===s?null:s,f=e.info,h=null!==u,p=Ve.newOrderedId(),d=".instant-simulations/".concat(h?"success":"fail","/").concat(p,"/"),y=a.a.join(d,"original"+r),v=a.a.join(d,"result.jpg"),m=a.a.join(d,"before.jpg"),g=a.a.join(d,"morphed.jpg"),w=[],h&&(w.push(wn(u,v)),w.push(wn(i,m)),l&&w.push(wn(l,g))),w.push(wn(n,y)),w.push(wn(On(f),a.a.join(d,"info.json"))),t.next=14,Promise.all(w);case 14:if(!h){t.next=28;break}return b=[],x=Br.build(),b.push(x.urlToGet(m,{expiresInSeconds:900})),b.push(x.urlToGet(v,{expiresInSeconds:900})),t.next=21,Promise.all(b);case 21:return E=t.sent,S=an(E,2),k=S[0].url,L=S[1].url,t.abrupt("return",{getBeforeUrl:k,getResultUrl:L});case 28:return t.abrupt("return",{});case 29:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function wn(t,e){return bn.apply(this,arguments)}function bn(){return(bn=ln(un().mark((function t(e,r){var n;return un().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=ft.gcloudBucket,t.next=3,new Promise((function(t,o){var i=Nr().bucket(n).file(r),a=new k.a.PassThrough;a.write(e),a.end(),a.pipe(i.createWriteStream()).on("finish",(function(){ht.info("[SUCCESS] Upload: (".concat(n,") ").concat(r)),t()})).on("error",(function(t){ht.error("[FAILED] Upload: (".concat(n,") ").concat(r)),o(t)}))}));case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function xn(t){var e=t.subtitle,r=void 0===e?null:e;return{title:"Free Smiles Simulation"+(r?" - ".concat(r):""),measurementId:U.instSimFirebaseMeasurementId}}function En(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.subtitle,r=void 0===e?null:e,n=t.simulation,o=void 0===n?null:n,i=t.synthTransform,a=void 0!==i&&i,c=xn({subtitle:r});return c=Object.assign(c,{i18n:F.a,maxFileSize:U.maxUploadSizeBytes,recaptchaClientKey:U.instSimRecaptchaClientKey,synthTransform:a}),null!==o&&(c=Object.assign(c,{simulation:o})),c}function Sn(t){var e=t.message||t.error||On(t),r={fullMessage:e,isSimulationError:!1},n=/exceeded.*rate limit/i,o=null,i=null;return e.match(n)&&e.match(/minute/i)?(i="errors:simulations-minutely-limit",o=F()(i)):e.match(n)&&e.match(/hour/i)?(i="errors:simulations-hourly-limit",o=F()(i)):e.match(n)&&e.match(/da(il)?y/i)?(i="errors:simulations-daily-limit",o=F()(i)):e.match(/invalid.*recaptcha/i)?(i="errors:invalid-recaptcha",o=F()(i)):e.match(/maxFileSize exceeded/i)?(i="errors:upload:image-size-limit",o=F()(i,{maxSize:U.maxUploadSizeMb})):e.match(/no photo.*received/i)?(i="errors:upload:no-file",o=F()(i)):e.match(/invalid.*extension/i)?(i="errors:upload:wrong-image-format",o=F()(i)):e.match(/((response|error).*timeout|timeout:)/i)?(i="errors:timeout",o=F()(i)):e.match(/Couldn.*t detect face/i)?(i="errors:no-face",o=F()(i),r.isSimulationError=!0):e.match(/error.*simulation/i)?(i="errors:simulation-error",o=F()(i),r.isSimulationError=!0):(i="errors:unknown-processing-error",o=F()(i)),r.prettyMessage=o,r.errorCode=i,r}function kn(t){return!!ft.instSimTokenDisabled||en.verify(t,_n(),U.instSimSecretToken)}function Ln(t){return jn.apply(this,arguments)}function jn(){return(jn=ln(un().mark((function t(e){var r,n;return un().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,_.a.post("https://www.google.com/recaptcha/api/siteverify?secret=".concat(ft.instSimRecaptchaSecretKey,"&response=").concat(e));case 2:return r=t.sent,n=r.data,t.abrupt("return",n.success&&n.score>=.75);case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function On(t){return JSON.stringify(t,null,4)}function _n(){return Math.round((new Date).getTime()/1e3)}function Tn(t){ft.isProduction()&&t.set("Cache-Control","public, max-age=3600, must-revalidate")}fn.get("/",mt(function(){var t=ln(un().mark((function t(e,r){var n;return un().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:Tn(r),n=!!e.query.transform||!!e.query.t,r.render("instant_simulations/index",En({synthTransform:n}));case 3:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}())),fn.get("/terms",mt(function(){var t=ln(un().mark((function t(e,r){return un().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:Tn(r),r.render("instant_simulations/terms",xn({subtitle:"Terms of Service"}));case 2:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}())),fn.get("/privacy",mt(function(){var t=ln(un().mark((function t(e,r){return un().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:Tn(r),r.render("instant_simulations/privacy",xn({subtitle:"Privacy Policy"}));case 2:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}())),fn.get("/epoch",mt(function(){var t=ln(un().mark((function t(e,r){return un().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r.json({epoch:_n()});case 1:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}())),fn.get("/robots.txt",mt(function(){var t=ln(un().mark((function t(e,r){var n;return un().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=ft.isProduction()?"# https://www.robotstxt.org/robotstxt.html\nUser-agent: *\nDisallow: /terms\n\nUser-agent: *\nDisallow: /privacy":"# https://www.robotstxt.org/robotstxt.html\nUser-agent: *\nDisallow: /",Tn(r),r.setHeader("Content-Type","text/plain"),r.status(200).send(n);case 4:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}())),fn.post("/",C()("".concat(ft.instSimRouteTimeout+ft.instSimUploadTimeout,"s")),dn,pn,yn,mt(function(){var t=ln(un().mark((function t(e,r,n){var o,i,c,u,s,l;return un().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=P()({multiples:!0,maxFileSize:U.maxUploadSizeBytes,maxFieldsSize:1048576,allowEmptyFiles:!1}),i=new Vr({externalTimedout:function(){return e.timedout},onTimeout:function(){return o.pause()}}),t.next=4,i.exec(ln(un().mark((function t(){var r;return un().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,nt.parseForm(o,e);case 2:return r=t.sent,t.abrupt("return",r);case 4:case"end":return t.stop()}}),t)}))),ft.instSimUploadTimeout);case 4:if(c=t.sent,u=c.files,s=c.fields,!i.hasTimedout()){t.next=9;break}return t.abrupt("return");case 9:return l=u.photo,t.next=12,i.exec(ln(un().mark((function t(){var n,o,c,u,f,h,p,d,y,v,m,g;return un().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=Ft(),l&&0!==l.size){t.next=3;break}throw new Error("No photo was received");case 3:if(kn(s.secret)){t.next=5;break}throw new Error("Non authorized token");case 5:return t.next=7,Ln(s.recaptchaToken);case 7:if(t.sent){t.next=10;break}throw new Error("Invalid Recaptcha");case 10:if(o=a.a.extname(l.originalFilename).toLowerCase(),c=l.filepath,u={ip:e.ip,timestamp:(new Date).toLocaleString("en-US",{hour12:!1})},Object.assign(r.locals,{photoPath:c,photoExt:o,info:u}),o.match(ft.supportedImagesFilepathRegex)){t.next=16;break}throw new Error("Invalid extension ".concat(o));case 16:return f=new Er,h=Math.round(n+1e3*ft.instSimGiveUpStartTimeout),p={brightness:ft.instSimBrightness,whiten:ft.instSimWhiten,poisson:ft.instSimPoisson,ortho:!1},"true"!==s.synthTransform&&(p.mix_factor=ft.instSimMixFactor),t.next=22,f.requestSimulation({photoPath:c,expiresAt:h,options:p});case 22:if(d=t.sent,!i.hasTimedout()){t.next=25;break}return t.abrupt("return");case 25:return t.next=27,mn({originalExt:o,original:d.original,before:d.before,result:d.result,morphed:d.morphed,info:r.locals.info});case 27:if(y=t.sent,v=y.getBeforeUrl,m=y.getResultUrl,!i.hasTimedout()){t.next=32;break}return t.abrupt("return");case 32:return g={success:!0,beforeUrl:v,resultUrl:m,originalExt:o},t.abrupt("return",r.render("instant_simulations/index",En({subtitle:"Result",simulation:g})));case 34:case"end":return t.stop()}}),t)}))),ft.instSimRouteTimeout);case 12:case"end":return t.stop()}}),t)})));return function(e,r,n){return t.apply(this,arguments)}}()));var Pn={router:fn,errorHandler:function(t,e,r,n){return vn.apply(this,arguments)}},In=r(53),Nn=r.n(In);function An(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Cn(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Rn(t){return(Rn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Fn(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Fn=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var o=e&&e.prototype instanceof f?e:f,i=Object.create(o.prototype),a=new S(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return L()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=b(a,r);if(c){if(c===l)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=s(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(t,r,a),i}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var l={};function f(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(k([])));v&&v!==e&&r.call(v,o)&&(d=v);var m=p.prototype=f.prototype=Object.create(d);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){var n;this._invoke=function(o,i){function a(){return new e((function(n,a){!function n(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==Rn(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,a,c)}),(function(t){n("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,c)}))}c(u.arg)}(o,i,n,a)}))}return n=n?n.then(a,a):a()}}function b(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=s(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function k(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:L}}function L(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},g(w.prototype),c(w.prototype,i,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(u(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=k,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),E(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:k(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function Gn(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Dn(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Gn(i,n,o,a,c,"next",t)}function c(t){Gn(i,n,o,a,c,"throw",t)}a(void 0)}))}}function Mn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function qn(t,e){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}function Un(t,e,r){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return r}var Wn=new WeakSet,Bn=new WeakSet,zn=function(){function t(e){var r=e.connection,n=e.name;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),qn(this,Bn),qn(this,Wn),this.connection=r,this.name=n}var e,r,n,o,i,c;return e=t,r=[{key:"save",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;return t.__source=this.name,Un(this,Bn,Hn).call(this,e).set(Kn(t,{attrs:n}),{merge:!r})}},{key:"startQuery",value:function(t){return this.connection.collection(t)}},{key:"getResults",value:(c=Dn(Fn().mark((function t(e,r){var n,o,i=this;return Fn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.get();case 2:return n=t.sent,o=[],n.forEach((function(t){var r=Un(i,Wn,Yn).call(i,e,t);o.push(r)})),t.abrupt("return",o);case 6:case"end":return t.stop()}}),t)}))),function(t,e){return c.apply(this,arguments)})},{key:"get",value:(i=Dn(Fn().mark((function t(e,r){var n,o,i;return Fn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=a.a.join(e.COLLECTION_NAME,String(r)),o=Un(this,Bn,Hn).call(this,Jn(n)),t.next=4,o.get();case 4:if((i=t.sent).exists){t.next=7;break}return t.abrupt("return",null);case 7:return t.abrupt("return",Un(this,Wn,Yn).call(this,e,i));case 8:case"end":return t.stop()}}),t,this)}))),function(t,e){return i.apply(this,arguments)})},{key:"set",value:function(t,e){return Un(this,Bn,Hn).call(this,t).set(e)}},{key:"delete",value:(o=Dn(Fn().mark((function t(e){var r=arguments;return Fn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r.length>1&&void 0!==r[1]&&r[1]||"/"!==e&&""!==e&&e){t.next=3;break}throw new Error("Can't delete root");case 3:return t.abrupt("return",Un(this,Bn,Hn).call(this,e).delete());case 4:case"end":return t.stop()}}),t,this)}))),function(t){return o.apply(this,arguments)})}],n=[{key:"build",value:function(e){var r=e.app,n=e.name,o=void 0===n?"default":n;if(ft.isTest()&&(!r.options.databaseURL||!r.options.databaseURL.includes("localhost")))throw"Invalid firestore options. Test environment can connect on localhost only. Options: ".concat(JSON.stringify(r.options));return new t({connection:r.firestore(),name:o})}},{key:"setInstance",value:function(t){var e=t.database;this.instances||(this.instances={}),this.instances[e.name]=e}},{key:"instance",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.name;if(!this.instances)return null;e=e||"default";var r=this.instances[e];if(!r)throw new Error("Couldn't find database named ".concat(e));return r}},{key:"toTimestamp",value:function(t){return Nn.a.firestore.Timestamp.fromDate(t)}},{key:"sourceOf",value:function(t){return t.__source||"default"}}],r&&Mn(e.prototype,r),n&&Mn(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Yn(t,e){var r=new t(function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?An(Object(r),!0).forEach((function(e){Cn(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):An(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({id:e.id},e.data()));return r.__source=this.name,r}function Hn(t){return this.connection.doc(t)}function Kn(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.attrs;if("object"!==Rn(t))return t;var n={};return r?r.forEach((function(e){n[e]=t[e]})):Object.assign(n,t),Object.keys(n).forEach((function(t){n[t]instanceof Nn.a.firestore.Timestamp&&(n[t]=n[t].toDate())})),delete n.id,delete n.__source,n}function Jn(t){var e=[];return t.split("/").forEach((function(t){""!==t.trim()&&e.push(t)})),e.join("/")}function Qn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var $n,Vn=new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r,n;return e=t,(r=[{key:"onlyKeys",value:function(t,e){var r={};return Object.keys(t).forEach((function(n){e.includes(n)&&(r[n]=t[n])})),r}}])&&Qn(e.prototype,r),n&&Qn(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}());function Xn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Zn(t,e,r){return e&&Xn(t.prototype,e),r&&Xn(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function to(t){return(to="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function eo(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */eo=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var o=e&&e.prototype instanceof f?e:f,i=Object.create(o.prototype),a=new S(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return L()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=b(a,r);if(c){if(c===l)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=s(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(t,r,a),i}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var l={};function f(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(k([])));v&&v!==e&&r.call(v,o)&&(d=v);var m=p.prototype=f.prototype=Object.create(d);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){var n;this._invoke=function(o,i){function a(){return new e((function(n,a){!function n(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==to(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,a,c)}),(function(t){n("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,c)}))}c(u.arg)}(o,i,n,a)}))}return n=n?n.then(a,a):a()}}function b(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=s(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function k(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:L}}function L(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},g(w.prototype),c(w.prototype,i,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(u(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=k,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),E(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:k(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function ro(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function no(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){ro(i,n,o,a,c,"next",t)}function c(t){ro(i,n,o,a,c,"throw",t)}a(void 0)}))}}function oo(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function io(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ao(t,e,r){return function(t,e){if(t!==e)throw new TypeError("Private static access of wrong provenance")}(t,e),r}function co(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var uo=new(Zn((function t(e){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._properties=e,e.forEach((function(t){r[t]=function(){return t}}))})))(["patient","inhouseClient"]),so=(co($n={},uo.patient(),{fields:["ip","accessPointId","origin","email","name","phone"],pathPattern:"ml-images/{clientId}/{id}/{filename}"}),co($n,uo.inhouseClient(),{fields:["ip"],pathPattern:"{userId}/on_demand/{id}/{filename}"}),$n),lo=["mode","blend","mix_factor","style_mode","whiten","brightness","feedback_score","capture_type","external_customer_id"],fo=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};oo(this,t),this.id=e.id,this.createdAt=e.createdAt,this.imageMD5=e.imageMD5,this.userId=e.userId,this.clientId=e.clientId,this.contentType=e.contentType,this.status=e.status||"pending",this.filepathUploaded=e.filepathUploaded,this.filepathResult=e.filepathResult,this.filepathPreprocessed=e.filepathPreprocessed,this.filepathSideBySide=e.filepathSideBySide,this.filepathSideBySideSmall=e.filepathSideBySideSmall,this.metadata={},this.requester=e.requester}var e,r,n,o,a,c;return e=t,r=[{key:"hasFinished",value:function(){return"finished"===this.status}},{key:"save",value:(c=no(eo().mark((function e(){var r,n,o=arguments;return eo().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.length>0&&void 0!==o[0]?o[0]:{},n=r.attrs,e.abrupt("return",zn.instance().save(this,"".concat(t.COLLECTION_NAME,"/").concat(this.id),!1,n));case 2:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"addMetadata",value:function(t){t=Vn.onlyKeys(t,lo),Object.assign(this.metadata,t)}},{key:"uploadsDir",value:function(){return i.join(i.dirname(this.filepathUploaded),"/")}},{key:"resultsDirectory",value:function(){return i.join(i.dirname(this.filepathResult),"/")}},{key:"filepathUploadedToReview",value:function(){var t="smile_review_pending"+i.extname(this.filepathUploaded);return i.join(this.uploadsDir(),t)}}],n=[{key:"COLLECTION_NAME",get:function(){return"smile_tasks"}},{key:"RequesterType",get:function(){return uo}},{key:"UPLOADED_TO_REVIEW_NAME",get:function(){return"smile_review_pending"}},{key:"build",value:function(e,r){return new t(ao(t,t,ho).call(t,e,r))}},{key:"get",value:(a=no(eo().mark((function e(r){var n;return eo().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=zn.instance(),e.next=3,n.get(t,r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)}))),function(t){return a.apply(this,arguments)})},{key:"all",value:(o=no(eo().mark((function e(){var r,n;return eo().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=zn.instance(),n=r.startQuery(t.COLLECTION_NAME),e.next=4,r.getResults(t,n);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)}))),function(){return o.apply(this,arguments)})},{key:"newId",value:function(t){return Ve.newOrderedId()}}],r&&io(e.prototype,r),n&&io(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function ho(t,e){var r=so[t],n=e.id||fo.newId();return e=Object.assign({id:n,createdAt:e.createdAt||zn.toTimestamp(new Date),requester:{type:t,info:Vn.onlyKeys(e,r.fields)}},e),Object.assign({filepathUploaded:ao(fo,fo,po).call(fo,r.pathPattern,e,"smile.jpg"),filepathResult:ao(fo,fo,po).call(fo,r.pathPattern,e,"smile_after.jpg"),filepathPreprocessed:ao(fo,fo,po).call(fo,r.pathPattern,e,"smile_before.jpg"),filepathSideBySide:ao(fo,fo,po).call(fo,r.pathPattern,e,"smile_sidebyside.jpg"),filepathSideBySideSmall:ao(fo,fo,po).call(fo,r.pathPattern,e,"smile_sidebyside_small.jpg")},e)}function po(t,e,r){var n=t.replace("{filename}",r);return Object.keys(e).forEach((function(t){n=n.replace("{"+t+"}",e[t])})),n}r(70);function yo(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==r)return;var n,o,i=[],a=!0,c=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(i.push(n.value),!e||i.length!==e);a=!0);}catch(t){c=!0,o=t}finally{try{a||null==r.return||r.return()}finally{if(c)throw o}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return vo(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return vo(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function vo(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function mo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var go=new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r,n;return e=t,(r=[{key:"sign",value:function(t,e){var r=this.serialize(t),n=this.serialize(e);return X.hmac(r,n)}},{key:"verify",value:function(t,e,r){return this.sign(t,e)===r}},{key:"apiSign",value:function(t,e,r){return this.sign([t,e],[r,U.apiSecretToken])}},{key:"apiVerify",value:function(t,e,r,n){return this.verify([t,e],[r,U.apiSecretToken],n)}},{key:"serialize",value:function(t){var e=this;if("string"==typeof t)return t;if("number"==typeof t)return t.toString();if(Array.isArray(t))return t.map((function(t){return e.serialize(t)})).join(":");var r=[];for(var n in t)r.push([n.toString(),t[n]]);r.sort((function(t,e){return t[0]>e[0]?1:t[0]==e[0]?0:-1}));var o="";return r.forEach((function(t){var r=yo(t,2),n=r[0],i=r[1];return o+='"'.concat(n,'":').concat(e.serialize(i),",")})),"{".concat(o,"}")}}])&&mo(e.prototype,r),n&&mo(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}());function wo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var bo=new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r,n;return e=t,(r=[{key:"getSignature",value:function(t,e,r){var n=nt.getSignature(t);if(!n)return nt.respondError(e,403,"Not Authorized");var o=n.split(":");return 2===o.length&&o[0]&&o[1]?(e.locals.dentClientId=o[0],e.locals.dentSignature=o[1],r()):nt.respondError(e,403,"Not Authorized")}},{key:"getImageMD5",value:function(t,e,r){var n=t.body.imageMD5;return n?(e.locals.dentImageMD5=n,r()):nt.respondError(e,422,"imageMD5 is mandatory")}},{key:"getContentType",value:function(t,e,r){var n=t.body.contentType;return n?(e.locals.dentImageContentType=n,r()):nt.respondError(e,422,"contentType is mandatory")}},{key:"verifySignature",value:function(t,e,r){var n=e.locals.dentSignature,o=e.locals.dentUser.id,i=e.locals.dentImageMD5,a=e.locals.dentClient.secret;return go.apiVerify(o,i,a,n)?r():nt.respondError(e,403,"Not Authorized")}}])&&wo(e.prototype,r),n&&wo(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}()),xo=(r(136),r(137),r(88)),Eo=r.n(xo);function So(t){return(So="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ko(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Lo(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ko(Object(r),!0).forEach((function(e){jo(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ko(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function jo(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Oo(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return _o(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _o(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){c=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(c)throw i}}}}function _o(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function To(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */To=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var o=e&&e.prototype instanceof f?e:f,i=Object.create(o.prototype),a=new S(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return L()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=b(a,r);if(c){if(c===l)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=s(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(t,r,a),i}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var l={};function f(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(k([])));v&&v!==e&&r.call(v,o)&&(d=v);var m=p.prototype=f.prototype=Object.create(d);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){var n;this._invoke=function(o,i){function a(){return new e((function(n,a){!function n(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==So(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,a,c)}),(function(t){n("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,c)}))}c(u.arg)}(o,i,n,a)}))}return n=n?n.then(a,a):a()}}function b(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=s(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function k(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:L}}function L(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},g(w.prototype),c(w.prototype,i,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(u(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=k,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),E(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:k(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function Po(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Io(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Po(i,n,o,a,c,"next",t)}function c(t){Po(i,n,o,a,c,"throw",t)}a(void 0)}))}}function No(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ao(t,e){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}function Co(t,e,r){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return r}Ct.SECONDS;var Ro=Ct.MINUTES,Fo=(Ct.HOURS,Ct.DAYS,[]),Go=new WeakSet,Do=new WeakSet,Mo=new WeakSet,qo=new WeakSet,Uo=new WeakSet,Wo=new WeakSet,Bo=new WeakSet,zo=new WeakSet,Yo=function(){function t(e){var r=e.cache,n=e.cacheTTL,o=e.staleTTL;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Ao(this,zo),Ao(this,Bo),Ao(this,Wo),Ao(this,Uo),Ao(this,qo),Ao(this,Mo),Ao(this,Do),Ao(this,Go),this.cache=r,this.cacheTTL=n,this.staleTTL=o,Fo.push(this)}var e,r,n,o;return e=t,r=[{key:"delete",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.keepCache,n=void 0!==r&&r,o=e.keepStale,i=void 0!==o&&o,a=Co(this,Bo,ri).call(this,t),c=Co(this,zo,ni).call(this,t);n||this.cache.del(a),i||this.cache.del(c)}},{key:"clear",value:function(){this.cache.flushAll()}},{key:"wrap",value:(o=Io(To().mark((function t(e){var r,n,o,i,a;return To().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.key,n=e.op,void 0===(o=e.skipCache)||!o){t.next=5;break}ht.verbose("Cache SKIP: ".concat(r)),t.next=10;break;case 5:if(i=Co(this,Bo,ri).call(this,r),void 0===(a=this.cache.get(i))){t.next=10;break}return ht.verbose("cache.InMemory: Return Cached ".concat(r)),t.abrupt("return",a);case 10:return t.abrupt("return",Co(this,qo,Xo).call(this,{op:n,key:r}));case 11:case"end":return t.stop()}}),t,this)}))),function(t){return o.apply(this,arguments)})}],n=[{key:"clear",value:function(){var t,e=Oo(Fo);try{for(e.s();!(t=e.n()).done;){var r=t.value;"function"==typeof r.clear&&r.clear()}}catch(t){e.e(t)}finally{e.f()}}},{key:"build",value:function(e){var r=e.cacheTTL,n=new Eo.a({stdTTL:r,useClones:!1,checkperiod:10*Ro,deleteOnExpire:!0,maxKeys:5e3});return new t(Lo(Lo({},e),{},{cache:n}))}}],r&&No(e.prototype,r),n&&No(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Ho(t,e){return Ko.apply(this,arguments)}function Ko(){return(Ko=Io(To().mark((function t(e,r){var n,o,i;return To().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Co(this,Uo,ti).call(this,r)&&ht.warn("cache.InMemory (silent fail): Invalid result for key ".concat(e,": ").concat(r)),n=[],o=Co(this,Bo,ri).call(this,e),n.push({key:o,val:r,ttl:this.cacheTTL}),Co(this,Wo,ei).call(this)&&(i=Co(this,zo,ni).call(this,e),n.push({key:i,val:r,ttl:this.staleTTL})),this.cache.mset(n)?ht.verbose("cache.InMemory: Stored ".concat(e)):ht.warn("cache.InMemory (silent fail): Couldn't store ".concat(e," with: ").concat(r)),t.abrupt("return",Promise.resolve(r));case 8:case"end":return t.stop()}}),t,this)})))).apply(this,arguments)}function Jo(t,e){return Qo.apply(this,arguments)}function Qo(){return(Qo=Io(To().mark((function t(e,r){var n,o;return To().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=Co(this,zo,ni).call(this,e),void 0!==(o=Co(this,Wo,ei).call(this)?this.cache.get(n):void 0)){t.next=6;break}return t.abrupt("return",Promise.reject(r));case 6:return ht.warn("cache.InMemory: Failed to execute behaviour of ".concat(e,", returning stale instead: ").concat(o)),t.abrupt("return",Promise.resolve(o));case 8:case"end":return t.stop()}}),t,this)})))).apply(this,arguments)}function $o(t){return Vo.apply(this,arguments)}function Vo(){return(Vo=Io(To().mark((function t(e){var r;return To().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("function"==typeof e&&(r=function(){var t=Io(To().mark((function t(){return To().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e());case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),e=r()),!(e instanceof Error)){t.next=5;break}return t.abrupt("return",Promise.reject({error:e}));case 5:if(!e.error){t.next=9;break}return t.abrupt("return",Promise.reject(e));case 9:return t.abrupt("return",Promise.resolve(e));case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Xo(t){return Zo.apply(this,arguments)}function Zo(){return(Zo=Io(To().mark((function t(e){var r,n,o=this;return To().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.op,n=e.key,t.abrupt("return",Co(this,Mo,$o).call(this,r).then((function(t){return Co(o,Go,Ho).call(o,n,t),Promise.resolve(t)})).catch((function(t){return Co(o,Do,Jo).call(o,n,t)})));case 2:case"end":return t.stop()}}),t,this)})))).apply(this,arguments)}function ti(t){return!("undefined"==typeof obj||null===obj||obj instanceof Error||"error"in obj||"object"===("undefined"==typeof obj?"undefined":So(obj))&&0===Object.keys(obj).length)}function ei(){return"number"==typeof this.staleTTL&&this.staleTTL>0}function ri(t){return"cache:".concat(t)}function ni(t){return"stale:".concat(t)}function oi(t){return(oi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ii(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ii=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var o=e&&e.prototype instanceof f?e:f,i=Object.create(o.prototype),a=new S(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return L()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=b(a,r);if(c){if(c===l)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=s(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(t,r,a),i}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var l={};function f(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(k([])));v&&v!==e&&r.call(v,o)&&(d=v);var m=p.prototype=f.prototype=Object.create(d);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){var n;this._invoke=function(o,i){function a(){return new e((function(n,a){!function n(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==oi(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,a,c)}),(function(t){n("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,c)}))}c(u.arg)}(o,i,n,a)}))}return n=n?n.then(a,a):a()}}function b(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=s(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function k(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:L}}function L(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},g(w.prototype),c(w.prototype,i,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(u(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=k,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),E(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:k(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function ai(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function ci(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){ai(i,n,o,a,c,"next",t)}function c(t){ai(i,n,o,a,c,"throw",t)}a(void 0)}))}}function ui(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function si(t,e){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}function li(t,e,r){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return r}function fi(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}Ct.SECONDS;var hi=Ct.MINUTES,pi=(Ct.HOURS,Ct.DAYS),di=Yo.build({cacheTTL:5*hi,staleTTL:3*pi}),yi=new WeakSet,vi=new WeakSet,mi=new WeakSet,gi=function(){function t(e){var r,n=e.id,o=e.secret,i=e.exposedSecret,a=e.createdAt,c=void 0===a?null:a,u=e.updatedAt,s=void 0===u?null:u,l=e.revoked,f=void 0!==l&&l,h=e.apisConfig,p=void 0===h?null:h;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),si(this,mi),si(this,vi),si(this,yi),this.id=n,this.secret=o,this.exposedSecret=i,this.createdAt=c||zn.toTimestamp(new Date),this.updatedAt=s||this.createdAt,this.revoked=f,this.apisConfig=p||{default:(fi(r={},"enabled",!0),fi(r,"allowedHosts",null),fi(r,"rateLimit",null),fi(r,"recaptcha",{}),fi(r,"customBucket",null),fi(r,"customGoogleProject",null),r)}}var e,r,n,o,i,a;return e=t,r=[{key:"addApiAllowedHost",value:function(t){var e=t.api,r=void 0===e?"default":e,n=t.host,o=li(this,vi,bi).call(this,{api:r,config:"allowedHosts"})||[];return o.push(n),li(this,yi,wi).call(this,{api:r,config:"allowedHosts",value:o}),o}},{key:"clearApiAllowedHosts",value:function(t){var e=t.api,r=void 0===e?"default":e;li(this,yi,wi).call(this,{api:r,config:"allowedHosts",value:null})}},{key:"apiAllowedHosts",value:function(t){var e=t.api,r=void 0===e?"default":e;return t.host,li(this,mi,xi).call(this,{api:r,config:"allowedHosts"})||[]}},{key:"apiIsEnabled",value:function(t){var e=t.api,r=void 0===e?"default":e,n=li(this,mi,xi).call(this,{api:r,config:"enabled"});return void 0===n||n}},{key:"enableApi",value:function(t){var e=t.api,r=void 0===e?"default":e;return li(this,yi,wi).call(this,{api:r,config:"enabled",value:!0})}},{key:"disableApi",value:function(t){var e=t.api,r=void 0===e?"default":e;return t.value,li(this,yi,wi).call(this,{api:r,config:"enabled",value:!1})}},{key:"customBucket",value:function(t){var e=t.api,r=void 0===e?"default":e;return li(this,mi,xi).call(this,{api:r,config:"customBucket"})}},{key:"setCustomBucket",value:function(t){var e=t.api,r=void 0===e?"default":e,n=t.bucket;return li(this,yi,wi).call(this,{api:r,config:"customBucket",value:n})}},{key:"customGoogleProject",value:function(t){var e=t.api,r=void 0===e?"default":e;return li(this,mi,xi).call(this,{api:r,config:"customGoogleProject"})}},{key:"setCustomGoogleProject",value:function(t){var e=t.api,r=void 0===e?"default":e,n=t.projectKey;return li(this,yi,wi).call(this,{api:r,config:"customGoogleProject",value:n})}},{key:"isRevoked",value:function(){return!0===this.revoked}},{key:"apiMaxSuccessesPerSecond",value:function(t){var e=t.api,r=void 0===e?"default":e;return(li(this,mi,xi).call(this,{api:r,config:"rateLimit"})||{}).maxSuccessesPerSecond}},{key:"setMaxSuccessesPerSecond",value:function(t){var e=t.api,r=void 0===e?"default":e,n=t.value,o=li(this,vi,bi).call(this,{api:r,config:"rateLimit"})||{};o.maxSuccessesPerSecond=n,li(this,yi,wi).call(this,{api:r,config:"rateLimit",value:o})}},{key:"apiRecaptcha",value:function(t){var e=t.api,r=void 0===e?"default":e;return li(this,mi,xi).call(this,{api:r,config:"recaptcha"})||{}}},{key:"setApiRecaptcha",value:function(t,e){var r=t.api,n=void 0===r?"default":r,o=e.secret,i=e.minScore,a=li(this,vi,bi).call(this,{api:n,config:"recaptcha"})||{};o&&(a.secret=o),i&&(a.minScore=i),li(this,yi,wi).call(this,{api:n,config:"recaptcha",value:a})}},{key:"save",value:function(){var e=zn.instance();return this.updatedAt=zn.toTimestamp(new Date),this.createdAt=this.createdAt||this.updatedAt,e.save(this,"".concat(t.COLLECTION_NAME,"/").concat(this.id))}}],n=[{key:"COLLECTION_NAME",get:function(){return"api_clients"}},{key:"CACHE",get:function(){return di}},{key:"all",value:(a=ci(ii().mark((function e(){var r,n,o,i=arguments;return ii().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>0&&void 0!==i[0]?i[0]:{},n=r.skipCache,o=void 0!==n&&n,e.abrupt("return",di.wrap({key:"ApiClient.all",skipCache:o,op:function(){var e=ci(ii().mark((function e(){var r,n;return ii().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=zn.instance(),n=r.startQuery(t.COLLECTION_NAME),e.abrupt("return",r.getResults(t,n));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}));case 2:case"end":return e.stop()}}),e)}))),function(){return a.apply(this,arguments)})},{key:"getAllAllowedHosts",value:(i=ci(ii().mark((function e(r){var n;return ii().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.api,e.abrupt("return",di.wrap({key:"ApiClient.getAllAllowedHosts:".concat(n),op:function(){var e=ci(ii().mark((function e(){var r;return ii().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.all({skipCache:!0});case 2:return r=e.sent,e.abrupt("return",r.flatMap((function(t){return t.apiAllowedHosts({api:n})})));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}));case 2:case"end":return e.stop()}}),e)}))),function(t){return i.apply(this,arguments)})},{key:"get",value:(o=ci(ii().mark((function e(r){var n,o=arguments;return ii().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]&&o[1],e.next=3,di.wrap({key:"ApiClient:".concat(r),skipCache:n,op:function(){var e=ci(ii().mark((function e(){var n;return ii().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=zn.instance(),e.abrupt("return",n.get(t,r));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)}))),function(t){return o.apply(this,arguments)})},{key:"destroy",value:function(e){if("/"===e||""===e||!e)throw new Error("Can't delete root");return zn.instance().delete("/".concat(t.COLLECTION_NAME,"/").concat(e))}},{key:"build",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.idSuffix,n=this.newId();return r&&(n="".concat(n,"_").concat(r)),new t({id:n,secret:this.newSecret(),exposedSecret:this.newSecret()})}},{key:"newId",value:function(){return Ve.newOrderedId()}},{key:"newSecret",value:function(){return Ve.newSecret()}}],r&&ui(e.prototype,r),n&&ui(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function wi(t){var e=t.api,r=t.config,n=t.value;this.apisConfig||(this.apisConfig={}),this.apisConfig[e]||(this.apisConfig[e]={}),this.apisConfig[e][r]=n}function bi(t){var e=t.api,r=t.config;return this.apisConfig&&e in this.apisConfig?this.apisConfig[e][r]:null}function xi(t){var e=t.api,r=t.config,n=li(this,vi,bi).call(this,{api:e,config:r});return void 0!==n&&null!=n||(n=li(this,vi,bi).call(this,{api:"default",config:r})),n}function Ei(t){return(Ei="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Si(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Si=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var o=e&&e.prototype instanceof f?e:f,i=Object.create(o.prototype),a=new S(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return L()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=b(a,r);if(c){if(c===l)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=s(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(t,r,a),i}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var l={};function f(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(k([])));v&&v!==e&&r.call(v,o)&&(d=v);var m=p.prototype=f.prototype=Object.create(d);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){var n;this._invoke=function(o,i){function a(){return new e((function(n,a){!function n(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==Ei(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,a,c)}),(function(t){n("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,c)}))}c(u.arg)}(o,i,n,a)}))}return n=n?n.then(a,a):a()}}function b(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=s(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function k(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:L}}function L(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},g(w.prototype),c(w.prototype,i,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(u(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=k,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),E(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:k(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function ki(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Li(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){ki(i,n,o,a,c,"next",t)}function c(t){ki(i,n,o,a,c,"throw",t)}a(void 0)}))}}function ji(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Oi=function(){function t(e){var r=e.id,n=e.email,o=e.fullName,i=e.company;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.id=r,this.email=n,this.fullName=o,this.company=i}var e,r,n,o,i,a;return e=t,r=[{key:"save",value:(a=Li(Si().mark((function e(){var r;return Si().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ft.isLocal()){e.next=2;break}throw new Error("Save only in development. This application shouldn't change users");case 2:return r=zn.instance(),e.abrupt("return",r.save(this,"".concat(t.COLLECTION_NAME,"/").concat(this.id)));case 4:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})}],n=[{key:"COLLECTION_NAME",get:function(){return"users"}},{key:"get",value:(i=Li(Si().mark((function e(r){var n;return Si().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=zn.instance(),e.next=3,n.get(t,r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)}))),function(t){return i.apply(this,arguments)})},{key:"getByEmail",value:(o=Li(Si().mark((function e(r){var n,o;return Si().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=zn.instance(),o=n.startQuery(t.COLLECTION_NAME).where("email","==",r),e.next=4,n.getResults(t,o)[0];case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)}))),function(t){return o.apply(this,arguments)})}],r&&ji(e.prototype,r),n&&ji(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function _i(t){return(_i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ti(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Ti=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var o=e&&e.prototype instanceof f?e:f,i=Object.create(o.prototype),a=new S(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return L()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=b(a,r);if(c){if(c===l)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=s(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(t,r,a),i}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var l={};function f(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(k([])));v&&v!==e&&r.call(v,o)&&(d=v);var m=p.prototype=f.prototype=Object.create(d);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){var n;this._invoke=function(o,i){function a(){return new e((function(n,a){!function n(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==_i(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,a,c)}),(function(t){n("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,c)}))}c(u.arg)}(o,i,n,a)}))}return n=n?n.then(a,a):a()}}function b(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=s(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function k(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:L}}function L(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},g(w.prototype),c(w.prototype,i,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(u(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=k,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),E(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:k(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function Pi(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Ii(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Pi(i,n,o,a,c,"next",t)}function c(t){Pi(i,n,o,a,c,"throw",t)}a(void 0)}))}}function Ni(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Ai=new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r,n;return e=t,(r=[{key:"client",get:function(){return gt("getModel.client",function(){var t=Ii(Ti().mark((function t(e,r,n){var o,i;return Ti().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=r.locals.dentClientId,t.next=3,gi.get(o);case 3:if(i=t.sent){t.next=6;break}throw new De({httpCode:403,id:"not-authorized",subtype:"bad-token",debugMessage:'Unauthorized: Could not find client "'.concat(o,'"'),debugDetails:{clientId:o},publicMessage:"Not Authorized",logLevel:"debug"});case 6:r.locals.dentClient=i;case 7:case"end":return t.stop()}}),t)})));return function(e,r,n){return t.apply(this,arguments)}}())}},{key:"user",get:function(){return gt("getModel.user",function(){var t=Ii(Ti().mark((function t(e,r,n){var o,i;return Ti().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=e.params.userId,t.next=3,Oi.get(o);case 3:if(i=t.sent){t.next=6;break}throw new De({httpCode:404,id:"not-found",subtype:"user-not-found",subtypeIsPublic:!0,publicMessage:"User not found",debugDetails:{userId:o},logLevel:"debug"});case 6:r.locals.dentUser=i;case 7:case"end":return t.stop()}}),t)})));return function(e,r,n){return t.apply(this,arguments)}}())}},{key:"smileTask",get:function(){return gt("getModel.smileTask",function(){var t=Ii(Ti().mark((function t(e,r,n){var o,i;return Ti().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=e.params.smileTaskId,t.next=3,fo.get(o);case 3:if(i=t.sent){t.next=6;break}throw new De({httpCode:404,id:"not-found",subtype:"smiletask-not-found",subtypeIsPublic:!0,publicMessage:"SmileTask not found",debugDetails:{smileTaskId:o},logLevel:"debug"});case 6:r.locals.dentSmileTask=i;case 7:case"end":return t.stop()}}),t)})));return function(e,r,n){return t.apply(this,arguments)}}())}}])&&Ni(e.prototype,r),n&&Ni(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}());function Ci(t){return(Ci="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ri(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Ri=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var o=e&&e.prototype instanceof f?e:f,i=Object.create(o.prototype),a=new S(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return L()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=b(a,r);if(c){if(c===l)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=s(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(t,r,a),i}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var l={};function f(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(k([])));v&&v!==e&&r.call(v,o)&&(d=v);var m=p.prototype=f.prototype=Object.create(d);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){var n;this._invoke=function(o,i){function a(){return new e((function(n,a){!function n(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==Ci(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,a,c)}),(function(t){n("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,c)}))}c(u.arg)}(o,i,n,a)}))}return n=n?n.then(a,a):a()}}function b(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=s(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function k(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:L}}function L(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},g(w.prototype),c(w.prototype,i,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(u(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=k,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),E(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:k(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function Fi(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Gi(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Fi(i,n,o,a,c,"next",t)}function c(t){Fi(i,n,o,a,c,"throw",t)}a(void 0)}))}}function Di(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Mi=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.credentialsProvider=e}var e,r,n,o,i,a;return e=t,r=[{key:"uploadDescriptor",value:(a=Gi(Ri().mark((function t(e){var r,n,o,i,a=arguments;return Ri().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=a.length>1&&void 0!==a[1]?a[1]:{},n=r.overwriteImageName,o=void 0!==n&&n,i=e.filepathUploaded,o&&(i=i.replace(/[^\/]+(\..*)$/,"".concat(o,"$1"))),t.next=5,this.credentialsProvider.jsonToUpload({keyName:i,contentType:e.contentType,contentMD5:e.imageMD5,maxSizeInMegabytes:U.maxUploadSizeMb,expiresInSeconds:600});case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t,this)}))),function(t){return a.apply(this,arguments)})},{key:"uplodedDescriptorGet",value:(i=Gi(Ri().mark((function t(e){return Ri().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.credentialsProvider.urlToGet(e.filepathUploaded,{expiresInSeconds:600});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)}))),function(t){return i.apply(this,arguments)})},{key:"resultDescriptorGet",value:(o=Gi(Ri().mark((function t(e){return Ri().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.credentialsProvider.urlToGet(e.filepathResult,{expiresInSeconds:600});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)}))),function(t){return o.apply(this,arguments)})}],n=[{key:"build",value:function(){return new t(Br.build())}}],r&&Di(e.prototype,r),n&&Di(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function qi(t){return(qi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ui(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Ui=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var o=e&&e.prototype instanceof f?e:f,i=Object.create(o.prototype),a=new S(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return L()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=b(a,r);if(c){if(c===l)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=s(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(t,r,a),i}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var l={};function f(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(k([])));v&&v!==e&&r.call(v,o)&&(d=v);var m=p.prototype=f.prototype=Object.create(d);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){var n;this._invoke=function(o,i){function a(){return new e((function(n,a){!function n(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==qi(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,a,c)}),(function(t){n("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,c)}))}c(u.arg)}(o,i,n,a)}))}return n=n?n.then(a,a):a()}}function b(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=s(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function k(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:L}}function L(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},g(w.prototype),c(w.prototype,i,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(u(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=k,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),E(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:k(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function Wi(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==r)return;var n,o,i=[],a=!0,c=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(i.push(n.value),!e||i.length!==e);a=!0);}catch(t){c=!0,o=t}finally{try{a||null==r.return||r.return()}finally{if(c)throw o}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return Bi(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Bi(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Bi(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function zi(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}var Yi=o.a.Router(),Hi=Qe({limit:ft.userRateLimit.amount,expiresIn:ft.userRateLimit.timeWindow,lookup:function(t,e){return e.locals.dentUser.id}}),Ki=Qe({limit:ft.ipRateLimit.amount,expiresIn:ft.ipRateLimit.timeWindow,lookup:function(t,e){return t.ip}}),Ji=Qe({limit:ft.clientRateLimit.amount,expiresIn:ft.clientRateLimit.timeWindow,lookup:function(t,e){return e.locals.dentClient.id}});Yi.post("/solicitation",bo.getContentType,bo.getSignature,bo.getImageMD5,Ai.client,bo.verifySignature,Hi,Ki,Ji,mt(function(){var t,e=(t=Ui().mark((function t(e,r){var n,o,i,a,c,u,s,l;return Ui().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.body.manualReview,o=fo.build(fo.RequesterType.inhouseClient(),{ip:e.ip,userId:r.locals.dentUser.id,clientId:r.locals.dentClient.id,imageMD5:r.locals.dentImageMD5,contentType:r.locals.dentImageContentType}),i=Mi.build(),a=n?i.uploadDescriptor(o,{overwriteImageName:"smile_review_pending"}):i.uploadDescriptor(o),t.next=6,Promise.all([o.save(),a]);case 6:return c=t.sent,(u=Wi(c,2))[0],s=u[1],l={uploadDescriptor:s,originalPath:o.filepathUploaded,resultPath:o.filepathResult,preprocessedPath:o.filepathPreprocessed,sideBySidePath:o.filepathSideBySide,sideBySideSmallPath:o.filepathSideBySideSmall,smileTaskId:o.id},n||(l.progressWebsocket="/ws/smile-tasks/".concat(o.id)),t.abrupt("return",r.json(l));case 13:case"end":return t.stop()}}),t)})),function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){zi(i,n,o,a,c,"next",t)}function c(t){zi(i,n,o,a,c,"throw",t)}a(void 0)}))});return function(t,r){return e.apply(this,arguments)}}()));var Qi,$i,Vi,Xi,Zi=Yi,ta=r(65),ea=r.n(ta);function ra(t){return(ra="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function na(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */na=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var o=e&&e.prototype instanceof f?e:f,i=Object.create(o.prototype),a=new S(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return L()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=b(a,r);if(c){if(c===l)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=s(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(t,r,a),i}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var l={};function f(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(k([])));v&&v!==e&&r.call(v,o)&&(d=v);var m=p.prototype=f.prototype=Object.create(d);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){var n;this._invoke=function(o,i){function a(){return new e((function(n,a){!function n(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==ra(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,a,c)}),(function(t){n("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,c)}))}c(u.arg)}(o,i,n,a)}))}return n=n?n.then(a,a):a()}}function b(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=s(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function k(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:L}}function L(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},g(w.prototype),c(w.prototype,i,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(u(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=k,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),E(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:k(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function oa(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function ia(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?oa(Object(r),!0).forEach((function(e){aa(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):oa(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function aa(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function ca(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function ua(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){ca(i,n,o,a,c,"next",t)}function c(t){ca(i,n,o,a,c,"throw",t)}a(void 0)}))}}function sa(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function la(t,e){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}function fa(t,e,r){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return r}Ct.SECONDS;var ha=Ct.MINUTES,pa=(Ct.HOURS,Ct.DAYS,new(Qi=new WeakSet,$i=new WeakSet,Vi=new WeakSet,Xi=new WeakSet,function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),la(this,Xi),la(this,Vi),la(this,$i),la(this,Qi)}var e,r,n,o,i;return e=t,(r=[{key:"upload",value:(i=ua(na().mark((function t(e){var r,n,o,i,c,u,s,l,f,h,p,d,y,v,m,g,w,b,x,E;return na().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=e.googleProjectKey,n=e.bucket,o=e.simulation,i=e.uploadsConfig,c=e.info,u=e.clientId,s=e.root,l=void 0===s?".api-simulations/":s,f=o.success,h=a.a.join(l,f?"success":"fail","".concat(o.id,"SIM_").concat(u,"CLI")),p=[{filename:"info.json",content:fa(pa,Xi,ga).call(pa,ia({id:o.id,success:f,timestamp:Gt,clientId:u},c))}],d=0,y=Object.keys(i);case 5:if(!(d<y.length)){t.next=25;break}if(v=y[d],m=o[v]){t.next=10;break}return t.abrupt("continue",22);case 10:return g=i[v],t.next=13,ea.a.fromBuffer(m);case 13:if(t.t0=t.sent,t.t0){t.next=16;break}t.t0={};case 16:w=t.t0,b=(b=w.ext)||g.extensionPlaceholder||"unknown",x=v+".".concat(b),g.rawCfg={filename:x,content:m,getUrl:g.getUrl,isPublic:g.isPublic},p.push(g.rawCfg);case 22:d++,t.next=5;break;case 25:return t.next=27,pa.rawUpload({googleProjectKey:r,bucket:n,uploads:p,folderpath:h});case 27:return E={},Object.keys(i).forEach((function(t){var e=i[t].rawCfg;E[t]=e||{}})),t.abrupt("return",{results:E,folderpath:h});case 30:case"end":return t.stop()}}),t)}))),function(t){return i.apply(this,arguments)})},{key:"rawUpload",value:(o=ua(na().mark((function t(e){var r,n,o,i,c,u,s,l,f=this;return na().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.googleProjectKey,n=e.bucket,o=e.uploads,i=void 0===o?[]:o,c=e.folderpath,i.forEach((function(t){t.filepath=a.a.join(c,t.filename)})),u=i.map((function(t){return fa(pa,Qi,da).call(pa,{googleProjectKey:r,bucket:n},t)})),t.next=5,Promise.all(u);case 5:return s=Br.build({bucket:n}),l=i.map(function(){var t=ua(na().mark((function t(e){var r;return na().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.getUrl){t.next=2;break}return t.abrupt("return");case 2:if(r=null,!e.isPublic){t.next=7;break}r=fa(f,Vi,ma).call(f,ia({bucket:n},e)),t.next=10;break;case 7:return t.next=9,s.urlToGet(e.filepath,{expiresInSeconds:15*ha}).then((function(t){return t.url}));case 9:r=t.sent;case 10:e.getUrlSigned=r;case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),t.next=9,Promise.all(l);case 9:return t.abrupt("return",i);case 10:case"end":return t.stop()}}),t)}))),function(t){return o.apply(this,arguments)})}])&&sa(e.prototype,r),n&&sa(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}()));function da(t,e){return ya.apply(this,arguments)}function ya(){return(ya=ua(na().mark((function t(e,r){var n,o,i,a,c,u,s=this;return na().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.googleProjectKey,o=e.bucket,i=r.content,a=r.filepath,c=r.isPublic,u=void 0!==c&&c,t.next=4,new Promise((function(t,e){var r=fa(s,$i,va).call(s,{googleProjectKey:n,bucket:o,filepath:a}),c=new k.a.PassThrough;c.write(i),c.end(),c.pipe(r.createWriteStream({predefinedAcl:u?"publicRead":"authenticatedRead"})).on("finish",(function(){ht.verbose("[SUCCESS] Upload: (".concat(o,") ").concat(a)),t()})).on("error",(function(t){ht.error("[FAILED] Upload: (".concat(o,") ").concat(a)),e(t)}))}));case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function va(t){var e=t.googleProjectKey,r=t.bucket,n=t.filepath;return Nr({projectKey:e}).bucket(r).file(n)}function ma(t){var e=t.bucket,r=t.filepath;return fa(this,$i,va).call(this,{bucket:e,filepath:r}).publicUrl()}function ga(t){return JSON.stringify(t,null,4)}var wa=pa;function ba(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var xa,Ea,Sa,ka,La,ja,Oa,_a,Ta=/^-?[0-9]+(\.[0-9]+)?$/,Pa=new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r,n;return e=t,(r=[{key:"toChoicesString",value:function(t){return null==t?null:t.toString().trim().toLowerCase()}},{key:"toFloat",value:function(t){return null==t?null:"number"==typeof t?t:(t=t.toString()).match(Ta)?parseFloat(t):t}}])&&ba(e.prototype,r),n&&ba(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}());r(138);function Ia(t){return function(t){if(Array.isArray(t))return Na(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return Na(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Na(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Na(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Aa(t){return(Aa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ca(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ra(t,e){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}function Fa(t,e,r){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return r}var Ga=new(xa=new WeakSet,Ea=new WeakSet,Sa=new WeakSet,ka=new WeakSet,La=new WeakSet,ja=new WeakSet,Oa=new WeakSet,_a=new WeakSet,function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Ra(this,_a),Ra(this,Oa),Ra(this,ja),Ra(this,La),Ra(this,ka),Ra(this,Sa),Ra(this,Ea),Ra(this,xa)}var e,r,n;return e=t,(r=[{key:"validateNumber",value:function(t){var e=[];return Fa(Ga,xa,Da).call(Ga,{options:t,addTo:e})||Fa(Ga,ka,Ua).call(Ga,{options:t,type:"number",addTo:e})||Fa(Ga,La,Wa).call(Ga,{options:t,addTo:e})?Fa(Ga,Oa,za).call(Ga,{errors:e,options:t}):[]}},{key:"validateChoices",value:function(t){var e=[];return Fa(Ga,xa,Da).call(Ga,{options:t,addTo:e})||Fa(Ga,ka,Ua).call(Ga,{options:t,type:"string",addTo:e})||Fa(Ga,ja,Ba).call(Ga,{options:t,addTo:e})?Fa(Ga,Oa,za).call(Ga,{errors:e,options:t}):[]}}])&&Ca(e.prototype,r),n&&Ca(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}());function Da(t){var e=t.options,r=t.addTo;return(Fa(Ga,Ea,Ma).call(Ga,{options:e,addTo:r})||!!Fa(Ga,Sa,qa).call(Ga,{options:e,addTo:r}))&&(Fa(Ga,Oa,za).call(Ga,{errors:r,options:e}),!0)}function Ma(t){var e=t.options,r=e.condition;e.value,t.addTo;return!!r&&!r()}function qa(t){var e=t.options,r=e.optional,n=e.value,o=e.fieldName,i=t.addTo;return!r&&!Fa(Ga,_a,Ya).call(Ga,n)&&(i.push({message:"".concat(o," is not present")}),!0)}function Ua(t){var e=t.options,r=e.value,n=e.fieldName,o=t.type,i=t.addTo;return!!Fa(Ga,_a,Ya).call(Ga,r)&&(Aa(r)!==o&&(i.push({message:"".concat(n," must be of type ").concat(o," (received ").concat(r,")")}),!0))}function Wa(t){var e=t.options,r=e.value,n=e.min,o=e.max,i=e.fieldName,a=t.addTo;if(!Fa(Ga,_a,Ya).call(Ga,r))return!1;var c=void 0===n?Number.MIN_VALUE:n,u=void 0===o?Number.MAX_VALUE:o;if(r-c>=-1e-4&&u-r>=-1e-4)return!1;var s=void 0!==n,l=void 0!==o;return s&&l?a.push({message:"".concat(i," must be between ").concat(n," and ").concat(o," (received ").concat(r,")")}):s?a.push({message:"".concat(i," must be greather than ").concat(n," (received ").concat(r,")")}):l&&a.push({message:"".concat(i," must be less than ").concat(o," (received ").concat(r,")")}),!0}function Ba(t){var e=t.options,r=e.value,n=e.choices,o=e.fieldName,i=t.addTo;return!!Fa(Ga,_a,Ya).call(Ga,r)&&(!n.includes(r)&&(i.push({message:"".concat(o," must be one of the options: ").concat(n.join(", ")," (received ").concat(r,")")}),!0))}function za(t){var e=t.errors,r=t.options.addTo;return void 0===r?e:(r.push.apply(r,Ia(e)),r)}function Ya(t){return null!=t}function Ha(t){return(Ha="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ka(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==r)return;var n,o,i=[],a=!0,c=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(i.push(n.value),!e||i.length!==e);a=!0);}catch(t){c=!0,o=t}finally{try{a||null==r.return||r.return()}finally{if(c)throw o}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return Ja(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ja(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ja(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Qa(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Qa=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var o=e&&e.prototype instanceof f?e:f,i=Object.create(o.prototype),a=new S(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return L()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=b(a,r);if(c){if(c===l)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=s(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(t,r,a),i}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var l={};function f(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(k([])));v&&v!==e&&r.call(v,o)&&(d=v);var m=p.prototype=f.prototype=Object.create(d);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){var n;this._invoke=function(o,i){function a(){return new e((function(n,a){!function n(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==Ha(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,a,c)}),(function(t){n("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,c)}))}c(u.arg)}(o,i,n,a)}))}return n=n?n.then(a,a):a()}}function b(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=s(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function k(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:L}}function L(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},g(w.prototype),c(w.prototype,i,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(u(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=k,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),E(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:k(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function $a(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Va(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){$a(i,n,o,a,c,"next",t)}function c(t){$a(i,n,o,a,c,"throw",t)}a(void 0)}))}}function Xa(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Za(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var tc=["auto","mix_manual"],ec=["cosmetic","ortho"],rc=["poisson","replace"],nc=["file","camera"],oc=["styleMode","mixFactor","mode","blend","brightness","whiten"],ic=["feedbackScore","captureType","externalCustomerId"],ac=["bucket","directoryPath","beforePath","originalPath","resultPath"],cc=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.id,n=e.createdAt,o=e.clientId,i=e.storage,a=void 0===i?{}:i,c=e.params,u=void 0===c?{}:c,s=e.metadata,l=void 0===s?{}:s;Xa(this,t),this.id=r,this.createdAt=n,this.clientId=o,this.storage=a,this.params=u,this.metadata=l}var e,r,n,o,i,a;return e=t,r=[{key:"save",value:(a=Va(Qa().mark((function e(){var r,n,o,i,a,c,u,s,l=arguments;return Qa().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=l.length>0&&void 0!==l[0]?l[0]:{},n=r.attrs,o=r.skipNormalization,i=r.skipValidation,a=r.source,c=zn.instance({name:a||zn.sourceOf(this)}),o||this.normalizeData(),i){e.next=7;break}if(!((u=this.validationErrors()).length>0)){e.next=7;break}return e.abrupt("return",{errors:u});case 7:return e.next=9,c.save(this,"".concat(t.COLLECTION_NAME,"/").concat(this.id),!1,n);case 9:return s=e.sent,e.abrupt("return",{result:s});case 11:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"addMetadata",value:function(t){t&&(t=Vn.onlyKeys(t,ic),Object.assign(this.metadata,t))}},{key:"addStorageData",value:function(t){t&&(t=Vn.onlyKeys(t,ac),Object.assign(this.storage,t))}},{key:"addParams",value:function(t){t&&(t=Vn.onlyKeys(t,oc),Object.assign(this.params,t))}},{key:"normalizeData",value:function(){this.params.mode=Pa.toChoicesString(this.params.mode||"cosmetic"),this.params.blend=Pa.toChoicesString(this.params.blend||"poisson"),this.params.brightness=Pa.toFloat(this.params.brightness||0),this.params.whiten=Pa.toFloat(this.params.whiten||0),this.params.styleMode=Pa.toChoicesString(this.params.styleMode||"auto"),"mix_manual"==this.params.styleMode?this.params.mixFactor=Pa.toFloat(this.params.mixFactor):this.params.mixFactor=null,void 0!==this.metadata.feedbackScore&&(this.metadata.feedbackScore=Pa.toFloat(this.metadata.feedbackScore)),void 0!==this.metadata.captureType&&(this.metadata.captureType=Pa.toChoicesString(this.metadata.captureType))}},{key:"validationErrors",value:function(){var t=this,e=[];return Ga.validateChoices({fieldName:"mode",value:this.params.mode,choices:ec,addTo:e}),Ga.validateChoices({fieldName:"blend",value:this.params.blend,choices:rc,addTo:e}),Ga.validateChoices({fieldName:"styleMode",value:this.params.styleMode,choices:tc,addTo:e}),Ga.validateNumber({fieldName:"brightness",value:this.params.brightness,min:-1,max:1,addTo:e}),Ga.validateNumber({fieldName:"whiten",value:this.params.whiten,min:0,max:1,addTo:e}),Ga.validateNumber({fieldName:"mixFactor",value:this.params.mixFactor,min:0,max:1,condition:function(){return"mix_manual"==t.params.styleMode},addTo:e}),Ga.validateNumber({fieldName:"feedbackScore",value:this.metadata.feedbackScore,min:0,max:5,optional:!0,addTo:e}),Ga.validateChoices({fieldName:"captureType",value:this.metadata.captureType,choices:nc,optional:!0,addTo:e}),e}},{key:"buildJobOptions",value:function(){var t={whiten:this.params.whiten,brightness:1+this.params.brightness,ortho:"ortho"===this.params.mode,poisson:"poisson"===this.params.blend};return"mix_manual"===this.params.styleMode&&(t.mix_factor=this.params.mixFactor),t}}],n=[{key:"COLLECTION_NAME",get:function(){return"quick_simulations"}},{key:"build",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.id,n=e.createdAt,o=e.clientId,i=e.storage,a=e.params,c=e.metadata,u=new t({id:r||t.newId(),createdAt:n||zn.toTimestamp(new Date),clientId:o});return u.addStorageData(i),u.addMetadata(c),u.addParams(a),u}},{key:"get",value:(i=Va(Qa().mark((function e(r){var n,o,i,a=arguments;return Qa().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:{},o=n.source,i=zn.instance({name:o}),e.next=4,i.get(t,r);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)}))),function(t){return i.apply(this,arguments)})},{key:"list",value:(o=Va(Qa().mark((function e(r){var n,o,i,a,c,u,s,l,f;return Qa().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.orderBy,o=void 0===n?"id":n,i=r.orderAsc,a=void 0!==i&&i,c=r.filters,u=void 0===c?{}:c,s=r.source,l=zn.instance({name:s}),f=l.startQuery(t.COLLECTION_NAME),Object.entries(u).forEach((function(t){var e=Ka(t,2),r=e[0],n=e[1];f=f.where(r,"==",n)})),f=f.orderBy(o,a?"asc":"desc").limit(100),e.next=7,l.getResults(t,f);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)}))),function(t){return o.apply(this,arguments)})},{key:"newId",value:function(t){return Ve.newOrderedId()}}],r&&Za(e.prototype,r),n&&Za(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();var uc,sc,lc=r(66),fc=r.n(lc);function hc(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function pc(t,e){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}function dc(t,e,r){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return r}var yc=new(uc=new WeakSet,sc=new WeakSet,function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),pc(this,sc),pc(this,uc)}var e,r,n;return e=t,(r=[{key:"addTag",value:function(t){var e=t.label,r=t.value;fc.a.addCustomAttribute(e,r)}},{key:"stopwatch",value:function(t,e){return fc.a.startSegment(t,!0,e)}},{key:"addRequestBytesMeasure",value:function(t){var e=t.env,r=t.apiId,n=t.bytes;dc(yc,uc,vc).call(yc,{name:dc(yc,sc,mc).call(yc,{env:e,apiId:r,name:"RequestBytes"}),value:n})}},{key:"addImageBytesMeasure",value:function(t){var e=t.env,r=t.apiId,n=t.bytes;dc(yc,uc,vc).call(yc,{name:dc(yc,sc,mc).call(yc,{env:e,apiId:r,name:"ImageBytes"}),value:n})}},{key:"addImageDimensionsMeasure",value:function(t){var e=t.env,r=t.apiId,n=t.dimensions,o=n.width,i=n.height,a=n.area,c=n.areaSqrt;dc(yc,uc,vc).call(yc,{name:dc(yc,sc,mc).call(yc,{env:e,apiId:r,name:"ImageWidth"}),value:o}),dc(yc,uc,vc).call(yc,{name:dc(yc,sc,mc).call(yc,{env:e,apiId:r,name:"ImageHeight"}),value:i}),dc(yc,uc,vc).call(yc,{name:dc(yc,sc,mc).call(yc,{env:e,apiId:r,name:"ImageArea"}),value:a}),dc(yc,uc,vc).call(yc,{name:dc(yc,sc,mc).call(yc,{env:e,apiId:r,name:"ImageAreaSqrt"}),value:c})}}])&&hc(e.prototype,r),n&&hc(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}());function vc(t){var e=t.name,r=t.value;fc.a.recordMetric(e,r)}function mc(t){var e=t.apiId,r=t.env,n=t.name;return"".concat(e,":").concat(r,"/").concat(n)}r(71);var gc,wc,bc,xc,Ec,Sc,kc,Lc=r(77),jc=r.n(Lc);r(72),r(139);function Oc(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return _c(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _c(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){c=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(c)throw i}}}}function _c(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Tc(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Pc(t,e){Ic(t,e),e.add(t)}function Ic(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Nc(t,e,r){return function(t,e,r){if(e.set)e.set.call(t,r);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=r}}(t,Cc(t,e,"set"),r),r}function Ac(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Cc(t,e,"get"))}function Cc(t,e,r){if(!e.has(t))throw new TypeError("attempted to "+r+" private field on non-instance");return e.get(t)}function Rc(t,e,r){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return r}var Fc,Gc=new(gc=new WeakMap,wc=new WeakSet,bc=new WeakSet,xc=new WeakSet,Ec=new WeakSet,Sc=new WeakSet,kc=new WeakSet,function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Pc(this,kc),Pc(this,Sc),Pc(this,Ec),Pc(this,xc),Pc(this,bc),Pc(this,wc),function(t,e,r){Ic(t,e),e.set(t,r)}(this,gc,{writable:!0,value:null})}var e,r,n;return e=t,(r=[{key:"setId",value:function(t){var e=this,r=t.apiId,n=t.clientIsFrontend,o=void 0!==n&&n;return o&&(r="public-".concat(r)),function(t,n,i){n.locals.dentApiId=r,n.locals.dentIsFrontendRoute=o,Rc(e,wc,Dc).call(e,t,n),i()}}},{key:"addCallback",value:function(t,e){Ac(this,gc)||Nc(this,gc,{}),Ac(this,gc)[t]||(Ac(this,gc)[t]=[]),Ac(this,gc)[t].push(e)}},{key:"corsOnError",value:function(){return function(t,e,r){e.locals.dentCorsOnError=!0,r()}}},{key:"newNotFoundError",value:function(){return new De({httpCode:404,id:"not-found",publicMessage:"Not Found",logLevel:void 0})}},{key:"newServerError",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.httpCode,r=void 0===e?500:e,n=t.id,o=void 0===n?"internal-server-error":n,i=t.publicMessage,a=void 0===i?"Internal Server Error":i,c=t.debugMessage;return new De({httpCode:r,id:o,publicMessage:a,debugMessage:c||a,logLevel:"error"})}},{key:"getTags",value:function(t){return t.locals.dentApiTags||(t.locals.dentApiTags=new pe),t.locals.dentApiTags}},{key:"addTags",value:function(t,e){var r=Gc.getTags(t);r.add(e),Rc(this,kc,Bc).call(this,"tags.add",{allTags:r.tags,addedTags:new pe(e).tags})}},{key:"getId",value:function(t){return t.locals.dentApiId}},{key:"getInfo",value:function(t){return t.locals.dentApiInfo||{}}},{key:"addInfo",value:function(t,e){var r=Gc.getInfo(t);t.locals.dentApiInfo=Object.assign(r,e),Rc(this,kc,Bc).call(this,"info.add",{addedInfo:e,allInfo:r})}},{key:"convertToRichError",value:function(t,e,r,n){var o=De.fromError(t);if(!o)return ht.warn("Can't convert it to RichError",t),n(t);var i=Gc.getInfo(r);return o.addDebugDetails(i),Gc.addTags(r,o.tags),n(o)}}])&&Tc(e.prototype,r),n&&Tc(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}());function Dc(t,e){var r=e.locals.dentIsFrontendRoute,n=this.getId(e),o=Rc(this,xc,qc).call(this,t),i=Rc(this,Ec,Uc).call(this);this.addInfo(e,{api:{id:n,isFrontEndRoute:r},request:o,env:i});var a=t.headers["content-length"];void 0!==a&&yc.addRequestBytesMeasure({apiId:n,env:ft.name,bytes:a}),this.addTags(e,Rc(this,bc,Mc).call(this,{req:t,res:e,reqSize:a}))}function Mc(t){var e=t.req,r=t.res,n=t.reqSize,o=r.locals.dentIsFrontendRoute,i={"api:id":this.getId(r),"api:isFrontEndRoute":String(o),"req:method":e.method,"req:protocol":e.protocol,"env:name":ft.name};return void 0!==n&&(i["req:content:megabytes"]=(n/1024/1024).toFixed(3)),new pe(i)}function qc(t){return Rc(Gc,Sc,Wc).call(Gc,t,["method","headers","protocol","query","baseurl","ip","originalurl","path"])}function Uc(){return{name:ft.name}}function Wc(t,e){return e.reduce((function(e,r){return Object.assign(e,function(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}({},r,t[r]))}),{})}function Bc(t,e){if(Ac(this,gc)&&Ac(this,gc)[t]){var r,n=Oc(Ac(this,gc)[t]);try{for(n.s();!(r=n.n()).done;){(0,r.value)(e)}}catch(t){n.e(t)}finally{n.f()}}}function zc(t){return(zc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Yc(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Yc=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var o=e&&e.prototype instanceof f?e:f,i=Object.create(o.prototype),a=new S(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return L()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=b(a,r);if(c){if(c===l)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=s(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(t,r,a),i}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var l={};function f(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(k([])));v&&v!==e&&r.call(v,o)&&(d=v);var m=p.prototype=f.prototype=Object.create(d);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){var n;this._invoke=function(o,i){function a(){return new e((function(n,a){!function n(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==zc(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,a,c)}),(function(t){n("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,c)}))}c(u.arg)}(o,i,n,a)}))}return n=n?n.then(a,a):a()}}function b(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=s(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function k(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:L}}function L(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},g(w.prototype),c(w.prototype,i,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(u(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=k,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),E(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:k(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function Hc(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Kc(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Jc(t,e){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}function Qc(t,e,r){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return r}var $c=new(Fc=new WeakSet,function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Jc(this,Fc)}var e,r,n;return e=t,(r=[{key:"enforceCors",value:function(t){var e=t.hosts,r=t.methods,n=t.headers,o=t.skipValidation,i=void 0!==o&&o;return gt("cors.enforceCors",function(){var t,o=(t=Yc().mark((function t(o,a,c){var u,s,l,f;return Yc().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!i){t.next=3;break}return nt.setAllowingCors(o,a),t.abrupt("return");case 3:if((u=nt.normalizedOriginForCors(o))&&e&&e.length){t.next=6;break}throw Qc($c,Fc,Vc).call($c,{message:"Couldn't get origin or allowed origins aren't configured",details:{originNormalized:u,allowed:{hosts:e,methods:r,headers:n}}});case 6:for(s=[],l=0;l<e.length;l++)f=nt.normalizeOrigin(e[l],"https"),s.push(f);if(s.includes(u)){t.next=10;break}throw Qc($c,Fc,Vc).call($c,{message:"Origin on header doesn't match the allowed ones for this client",details:{originNormalized:u,allowed:{hosts:e,methods:r,headers:n}}});case 10:nt.setAllowingCors(o,a);case 11:case"end":return t.stop()}}),t)})),function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Hc(i,n,o,a,c,"next",t)}function c(t){Hc(i,n,o,a,c,"throw",t)}a(void 0)}))});return function(t,e,r){return o.apply(this,arguments)}}())}}])&&Kc(e.prototype,r),n&&Kc(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}());function Vc(t){var e=t.message,r=t.details;return new De({httpCode:403,id:"not-authorized",subtype:"cors-block",debugMessage:e,debugDetails:void 0===r?{}:r,publicMessage:"Not Authorized",logLevel:"debug"})}var Xc,Zc=r(67),tu=r.n(Zc);function eu(t){return(eu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ru(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ru=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var o=e&&e.prototype instanceof f?e:f,i=Object.create(o.prototype),a=new S(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return L()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=b(a,r);if(c){if(c===l)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=s(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(t,r,a),i}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var l={};function f(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(k([])));v&&v!==e&&r.call(v,o)&&(d=v);var m=p.prototype=f.prototype=Object.create(d);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){var n;this._invoke=function(o,i){function a(){return new e((function(n,a){!function n(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==eu(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,a,c)}),(function(t){n("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,c)}))}c(u.arg)}(o,i,n,a)}))}return n=n?n.then(a,a):a()}}function b(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=s(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function k(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:L}}function L(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},g(w.prototype),c(w.prototype,i,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(u(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=k,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),E(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:k(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function nu(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function ou(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function iu(t,e){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}tu.a.disableFS(!0),tu.a.disableTypes(["tiff","ico","gif","psd","svg","tga","icns"]);var au=[3,5,6,7,8],cu=new(Xc=new WeakSet,function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),iu(this,Xc)}var e,r,n,o,i;return e=t,(r=[{key:"getDimensions",value:function(t){var e=function(t,e,r){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return r}(cu,Xc,uu).call(cu,t);if(e){var r=e.width,n=e.height;return e.orientation,au.includes(e.orientation)&&(r=e.height,n=e.width),{width:r,height:n}}}},{key:"getExtension",value:(o=ru().mark((function t(e){var r,n;return ru().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,ea.a.fromBuffer(e);case 4:if(t.t0=t.sent,t.t0){t.next=7;break}t.t0={};case 7:return r=t.t0,n=r.ext,t.abrupt("return",n);case 10:case"end":return t.stop()}}),t)})),i=function(){var t=this,e=arguments;return new Promise((function(r,n){var i=o.apply(t,e);function a(t){nu(i,r,n,a,c,"next",t)}function c(t){nu(i,r,n,a,c,"throw",t)}a(void 0)}))},function(t){return i.apply(this,arguments)})}])&&ou(e.prototype,r),n&&ou(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}());function uu(t){if(t)try{return tu()(t)}catch(t){if(t instanceof TypeError)return;throw t}}function su(t){return(su="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function lu(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function fu(t,e){return(fu=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function hu(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=du(t);if(e){var o=du(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return pu(this,r)}}function pu(t,e){if(e&&("object"===su(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function du(t){return(du=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var yu,vu,mu,gu,wu,bu,xu,Eu,Su,ku,Lu,ju,Ou,_u,Tu;S.Writable;function Pu(t){return(Pu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Iu(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Nu(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==r)return;var n,o,i=[],a=!0,c=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(i.push(n.value),!e||i.length!==e);a=!0);}catch(t){c=!0,o=t}finally{try{a||null==r.return||r.return()}finally{if(c)throw o}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return Au(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Au(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Au(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Cu(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Cu=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var o=e&&e.prototype instanceof f?e:f,i=Object.create(o.prototype),a=new S(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return L()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=b(a,r);if(c){if(c===l)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=s(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(t,r,a),i}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var l={};function f(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(k([])));v&&v!==e&&r.call(v,o)&&(d=v);var m=p.prototype=f.prototype=Object.create(d);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){var n;this._invoke=function(o,i){function a(){return new e((function(n,a){!function n(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==Pu(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,a,c)}),(function(t){n("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,c)}))}c(u.arg)}(o,i,n,a)}))}return n=n?n.then(a,a):a()}}function b(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=s(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function k(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:L}}function L(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},g(w.prototype),c(w.prototype,i,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(u(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=k,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),E(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:k(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function Ru(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Fu(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Ru(i,n,o,a,c,"next",t)}function c(t){Ru(i,n,o,a,c,"throw",t)}a(void 0)}))}}function Gu(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Du(t,e){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}function Mu(t,e,r){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return r}Ct.SECONDS,Ct.MINUTES,Ct.HOURS,Ct.DAYS,Object(I.promisify)(j.a.readFile);var qu=["clientId","paramsHashed"],Uu=jc()({storage:jc.a.memoryStorage(),limits:{fieldSize:1048576,fileSize:ft.quickApiMaxUploadSizeBytes+1024,files:1}}),Wu=new(yu=new WeakSet,vu=new WeakSet,mu=new WeakSet,gu=new WeakSet,wu=new WeakSet,bu=new WeakSet,xu=new WeakSet,Eu=new WeakSet,Su=new WeakSet,ku=new WeakSet,Lu=new WeakSet,ju=new WeakSet,Ou=new WeakSet,_u=new WeakSet,Tu=new WeakSet,function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Du(this,Tu),Du(this,_u),Du(this,Ou),Du(this,ju),Du(this,Lu),Du(this,ku),Du(this,Su),Du(this,Eu),Du(this,xu),Du(this,bu),Du(this,wu),Du(this,gu),Du(this,mu),Du(this,vu),Du(this,yu)}var e,r,n;return e=t,(r=[{key:"enforceCors",get:function(){return gt("quickApi.enforceCors",function(){var t=Fu(Cu().mark((function t(e,r,n){var o,i,a,c,u;return Cu().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=r.locals,i=o.dentApiId,a=o.dentClient,c=a.apiAllowedHosts({api:i}),u=$c.enforceCors({hosts:c,methods:["POST"],headers:["Authorization"],skipValidation:!c||0===c.length}),t.next=5,wt(u,e,r);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)})));return function(e,r,n){return t.apply(this,arguments)}}())}},{key:"enforcePreflightCors",get:function(){return gt("quickApi.enforcePreflightCors",function(){var t=Fu(Cu().mark((function t(e,r,n){var o,i,a;return Cu().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=r.locals.dentApiId,t.next=3,gi.getAllAllowedHosts({api:o});case 3:return i=t.sent,a=$c.enforceCors({hosts:i,methods:["OPTIONS"]}),t.next=7,wt(a,e,r);case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}}),t)})));return function(e,r,n){return t.apply(this,arguments)}}())}},{key:"validateApiVisibility",get:function(){return gt("quickApi.validateApiVisibility",function(){var t=Fu(Cu().mark((function t(e,r,n){var o,i;return Cu().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=r.locals,i=o.dentApiId,o.dentClient.apiIsEnabled({api:i})){t.next=3;break}throw Mu(Wu,Tu,cs).call(Wu,{subtype:"no-access-to-route",message:"The client aren't authorized to access this route"});case 3:case"end":return t.stop()}}),t)})));return function(e,r,n){return t.apply(this,arguments)}}())}},{key:"validateClient",get:function(){return gt("quickApi.validateClient",function(){var t=Fu(Cu().mark((function t(e,r,n){return Cu().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!r.locals.dentClient.isRevoked()){t.next=3;break}throw Mu(Wu,Tu,cs).call(Wu,{subtype:"token-revoked",message:"This client access was revoked"});case 3:case"end":return t.stop()}}),t)})));return function(e,r,n){return t.apply(this,arguments)}}())}},{key:"rateLimit",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.ip,r=void 0===e||e,n=t.client,o=void 0===n||n;return gt("quickApi.rateLimit",function(){var t=Fu(Cu().mark((function t(e,n,i){var a,c,u,s,l,f,h,p;return Cu().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(a=n.locals).dentApiId,c=a.dentClient,u=1e3*ft.quickApiRateLimit_timeWindowSeconds,s=Qe({limit:ft.quickApiRateLimit_ipRequestsPerTimeWindow,expiresIn:u,lookup:function(t,e){return"rlimit:ip:".concat(t.ip,":requests")},onBlocked:function(t,e,r){throw Mu(Wu,Ou,is).call(Wu,{message:"Exceeded IP requests rate",tags:{"error:rate-limit":"ip-requests"}})}}),l=Qe({limit:ft.quickApiRateLimit_clientRequestsPerTimeWindow,expiresIn:u,lookup:function(t,e){return"rlimit:client:".concat(c.id,":requests")},onBlocked:function(t,e,r){throw Mu(Wu,Ou,is).call(Wu,{message:"Exceeded client requests rate",tags:{"error:rate-limit":"client-requests"}})}}),f=Qe({limit:ft.quickApiRateLimit_ipSimulationsPerTimeWindow,expiresIn:u,lookup:function(t,e){return"rlimit:ip:".concat(t.ip,":simulations")},countIf:function(t,e){return Wu.hasStartedSimulation(e)},onBlocked:function(t,e,r){throw Mu(Wu,Ou,is).call(Wu,{message:"Exceeded IP simulations rate",tags:{"error:rate-limit":"ip-simulations"}})}}),h=Qe({limit:ft.quickApiRateLimit_clientSimulationsPerTimeWindow,expiresIn:u,lookup:function(t,e){return"rlimit:client:".concat(c.id,":simulations")},countIf:function(t,e){return Wu.hasStartedSimulation(e)},onBlocked:function(t,e,r){throw Mu(Wu,Ou,is).call(Wu,{message:"Exceeded client simulations rate",tags:{"error:rate-limit":"client-simulations"}})}}),p=[],r&&p.push(s),o&&p.push(l),r&&p.push(f),o&&p.push(h),t.next=13,xt(p,e,n);case 13:return t.abrupt("return",t.sent);case 14:case"end":return t.stop()}}),t)})));return function(e,r,n){return t.apply(this,arguments)}}())}},{key:"parseRequestBody",get:function(){return gt("quickApi.parseRequestBody",function(){var t=Fu(Cu().mark((function t(e,r,n){var o,i,a,c,u,s,l;return Cu().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Mu(Wu,yu,Bu).call(Wu,e,r);case 2:for(l in o=t.sent,i=o.fields,a=o.files,c=i.data,u=Mu(Wu,ku,rs).call(Wu,c)||{},s={},a)l.startsWith("img")&&(s[l]=a[l]);r.locals.dentParsedBody={data:u,dataJson:c,images:s};case 10:case"end":return t.stop()}}),t)})));return function(e,r,n){return t.apply(this,arguments)}}())}},{key:"dataToQuickSimulation",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.customizable,r=t.force,n=void 0===r?{}:r;return gt("quickApi.dataToSimulationOptions",function(){var t=Fu(Cu().mark((function t(r,o,i){var a,c,u,s,l,f,h,p,d,y,v,m,g;return Cu().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=o.locals.dentClientId,c=o.locals.dentParsedBody,u=c.data,s=c.images,t.next=4,Mu(Wu,mu,Ku).call(Wu,{res:o,images:s,imgFields:["imgPhoto"]});case 4:if(l=Object.assign({},u,n),void 0!==e&&Object.keys(l).forEach((function(t){e.includes(t)||t in n||delete l[t]})),(f=cc.build({clientId:a,params:l,metadata:u})).normalizeData(),!((h=f.validationErrors()).length>0)){t.next=12;break}throw p=h[0].message,Mu(Wu,_u,as).call(Wu,{subtype:"body-validation-error",message:p});case 12:for(d=0,y=Object.entries(f.params);d<y.length;d++)v=Nu(y[d],2),m=v[0],g=v[1],Gc.addTags(o,Iu({},"simulation:params:".concat(m),String(g)));o.locals.dentQuickSimulation=f;case 14:case"end":return t.stop()}}),t)})));return function(e,r,n){return t.apply(this,arguments)}}())}},{key:"parseAuthToken",get:function(){return gt("quickApi.parseAuthToken",function(){var t=Fu(Cu().mark((function t(e,r){var n,o,i,a,c;return Cu().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=Mu(Wu,ju,os).call(Wu,e),o=e.query.clientId,delete e.query.clientId,n||o){t.next=5;break}throw Mu(Wu,Tu,cs).call(Wu,{subtype:"no-token",message:"Didn't received token"});case 5:i=void 0,a={},n?(c=Mu(Wu,gu,Qu).call(Wu,n),i=c.clientId,a=c.parsedToken):i=o,Gc.addInfo(r,{security:{"client-id":i,signature:a.signature}}),r.locals.dentClientId=i,r.locals.dentParsedToken=a;case 11:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}())}},{key:"validateRecaptcha",get:function(){return gt("quickApi.validateRecaptcha",function(){var t=Fu(Cu().mark((function t(e,r){var n,o,i,a,c,u,s,l,f,h;return Cu().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=r.locals,o=n.dentApiId,i=n.dentClient,a=r.locals.dentParsedToken.claims,c=i.apiRecaptcha({api:o})||{},u=c.secret,s=c.minScore,l=void 0===s?.75:s,u){t.next=6;break}return Mu(Wu,Eu,Zu).call(Wu,r,"skipped"),t.abrupt("return");case 6:return f=a.recaptchaToken,t.next=9,Mu(Wu,Su,ts).call(Wu,{secret:u,token:f,ip:e.ip});case 9:if(!((h=t.sent)&&h.success&&h.score>=l)){t.next=15;break}Mu(Wu,Eu,Zu).call(Wu,r,"accepted"),t.next=21;break;case 15:if(!ft.recaptchaIgnore){t.next=19;break}Mu(Wu,Eu,Zu).call(Wu,r,"ignored"),t.next=21;break;case 19:throw Mu(Wu,Eu,Zu).call(Wu,r,"refused"),Mu(Wu,Tu,cs).call(Wu,{subtype:"failed-recaptcha",message:"Failed on recaptcha validation",details:{googleResponse:h,minScore:l}});case 21:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}())}},{key:"validateAuthToken",value:function(t){var e=t.secretKey;return gt("quickApi.validateAuthToken",function(){var t=Fu(Cu().mark((function t(r,n){var o,i,a,c,u;return Cu().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=n.locals,i=o.dentClient,o.dentIsFrontendRoute){t.next=3;break}return t.abrupt("return");case 3:if(a=n.locals.dentParsedToken,c=a.claimsJson,u=a.signature,c&&X.verifySignatureHmac(u,c,i[e])){t.next=7;break}throw Mu(Wu,Tu,cs).call(Wu,{message:"Claims JSON signature doesn't match it",details:{signatureReceived:u,claimsJsonReceived:c}});case 7:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}())}},{key:"validateBodyData",get:function(){return gt("quickApi.validateBodyData",function(){var t=Fu(Cu().mark((function t(e,r){var n,o,i,a,c,u,s,l,f,h,p,d,y;return Cu().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r.locals.dentIsFrontendRoute){t.next=2;break}return t.abrupt("return");case 2:if(n=r.locals.dentParsedToken.claims,o=r.locals.dentParsedBody,i=o.dataJson,a=o.images,c=n.paramsHashed,u=Object.keys(c),s=Object.keys(a),i&&s.push("data"),Mu(Wu,Lu,ns).call(Wu,u,s)){t.next=10;break}throw Mu(Wu,Tu,cs).call(Wu,{message:"Request data does not match token claims - ".concat(s," - ").concat(u),details:{hashedParamsOnTokenClaims:u,keysReceivedOnBody:s}});case 10:l=s.length,f=0;case 12:if(!(f<l)){t.next=22;break}if(h=s[f],p="data"===h?i:a[h].content,d=c[h],y=X.md5(p),d===y){t.next=19;break}throw Mu(Wu,Tu,cs).call(Wu,{message:'Hashed param "'.concat(h,'" does not match claims received on token'),details:{paramHashReceived:c,paramHashExpected:y,originalValue:p}});case 19:f++,t.next=12;break;case 22:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}())}},{key:"setSimulationStarted",value:function(t){t.locals.dentSimulationWasStarted=!0}},{key:"hasStartedSimulation",value:function(t){return!!t.locals.dentSimulationWasStarted}}])&&Gu(e.prototype,r),n&&Gu(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}());function Bu(t,e){return zu.apply(this,arguments)}function zu(){return(zu=Fu(Cu().mark((function t(e,r){return Cu().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.rawBodyJson){t.next=4;break}return t.abrupt("return",{fields:{data:e.rawBodyJson},files:{}});case 4:return t.abrupt("return",Mu(Wu,vu,Yu).call(Wu,e,r));case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Yu(t,e){return Hu.apply(this,arguments)}function Hu(){return(Hu=Fu(Cu().mark((function t(e,r){var n,o,i;return Cu().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,wt(Uu.any(),e,r);case 2:return n=e.body||{},o=e.files||[],i={},o.forEach((function(t){t.originalFilename=t.originalname,t.content=t.buffer,delete t.buffer,t.filenameExtension=a.a.extname(t.originalFilename),i[t.fieldname]=t;var e=r.locals.dentApiId;if(yc.addImageBytesMeasure({apiId:e,env:ft.name,bytes:t.size}),Gc.addTags(r,{"simulation:params:image:megabytes":(t.size/1024/1024).toFixed(3)}),t.size>=ft.quickApiMaxUploadSizeBytes)throw t.content="[HIDDEN]",Mu(Wu,_u,as).call(Wu,{subtype:"size-limit-exceeded",message:"".concat(t.fieldname," is too big"),details:{receivedFile:t}})})),Gc.addInfo(r,{multipartData:{files:i,fields:n}}),t.abrupt("return",{fields:n,files:i});case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Ku(t){return Ju.apply(this,arguments)}function Ju(){return(Ju=Fu(Cu().mark((function t(e){var r,n,o,i,a,c,u,s,l,f,h,p,d;return Cu().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=e.images,n=e.imgFields,o=e.res,i=0;case 2:if(!(i<n.length)){t.next=20;break}if(a=n[i],(c=r[a])&&c.content&&0!==c.size){t.next=7;break}throw Mu(Wu,_u,as).call(Wu,{subtype:"no-photo",message:"".concat(a," is mandatory"),details:{imgParamsReceived:Object.keys(r)}});case 7:return t.next=9,cu.getExtension(c.content);case 9:if((u=t.sent)&&Gc.addTags(o,{"simulation:params:image:extension":u}),u&&u.match(ft.supportedImagesFilepathRegex)){t.next=13;break}throw Mu(Wu,_u,as).call(Wu,{subtype:"unknown-format",message:"".concat(a," format is unknown"),details:{receivedPhotoType:u}});case 13:return t.next=15,cu.getDimensions(c.content);case 15:(s=t.sent)&&(l=s.width,f=s.height,h=l*f,p=Math.round(Math.sqrt(h)),Gc.addTags(o,{"simulation:params:image:width":String(l),"simulation:params:image:height":String(f),"simulation:params:image:area":String(h),"simulation:params:image:areaSqrt":String(p)}),d=o.locals.dentApiId,yc.addImageDimensionsMeasure({apiId:d,env:ft.name,dimensions:{width:l,height:f,area:h,areaSqrt:p}}));case 17:i++,t.next=2;break;case 20:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Qu(t){return t.includes(":")?Mu(Wu,bu,Vu).call(Wu,t):Mu(Wu,wu,$u).call(Wu,t)}function $u(t){var e=Mu(Wu,xu,Xu).call(Wu,t),r=e.claims,n=e.claimsJson;return{clientId:r.clientId,parsedToken:{claims:r,claimsJson:n}}}function Vu(t){var e=t.split(":");if(2!==e.length||!e[0]||!e[1])throw Mu(Wu,Tu,cs).call(Wu,{message:'Token invalid "'.concat(t,'"'),details:{receivedToken:t}});var r=e[0],n=e[1],o=Mu(Wu,xu,Xu).call(Wu,r),i=o.claims,a=o.claimsJson;return qu.forEach((function(e){if(!i[e])throw Mu(Wu,Tu,cs).call(Wu,{subtype:"missing-claim",message:"Missing '".concat(e,"' on claims - \"").concat(t),details:{receivedToken:t,receivedClaims:a,mandatoryClaims:qu}})})),{clientId:i.clientId,parsedToken:{claimsJson:a,claims:i,signature:n}}}function Xu(t){var e=X.base64Decode(t);if(!e)throw Mu(Wu,Tu,cs).call(Wu,{message:"Couldn't decode claims json \"".concat(t,'"'),details:{receivedToken:token,receivedClaimsInBase64:t}});var r=Mu(Wu,ku,rs).call(Wu,e);if(!r)throw Mu(Wu,Tu,cs).call(Wu,{message:"claims is not a valid json - ".concat(e),details:{receivedToken:token,receivedClaims:e}});return{claims:r,claimsJson:e}}function Zu(t,e){Gc.addTags(t,{"recaptcha:validation":e})}function ts(t){return es.apply(this,arguments)}function es(){return(es=Fu(Cu().mark((function t(e){var r,n,o,i,a;return Cu().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.secret,n=e.token,o=e.ip,t.next=3,_.a.post("https://www.google.com/recaptcha/api/siteverify?secret=".concat(r,"&response=").concat(n,"&remoteip=").concat(o));case 3:return i=t.sent,a=i.data,t.abrupt("return",a);case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function rs(t){try{return JSON.parse(t)}catch(t){return null}}function ns(t,e){var r=t.length;if(r!==e.length)return!1;t=Array.prototype.concat(t),e=Array.prototype.concat(e),t.sort(),e.sort();for(var n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}function os(t){var e=nt.normalizeParamValue(t.get("Authorization"));if(!e)return null;var r=e.match(/^Bearer\s+(.*)\s*$/);return r?r[1]:null}function is(t){var e=t.message,r=t.tags;return new De({httpCode:429,id:"too-many-requests",subtype:"rate-limit",subtypeIsPublic:!0,publicMessage:"Too Many Requests",debugMessage:e,logLevel:"debug",tags:r})}function as(t){var e=t.subtype,r=t.message,n=t.details;return new De({id:"bad-params",subtype:e,subtypeIsPublic:!0,httpCode:422,debugDetails:void 0===n?{}:n,publicMessage:r,logLevel:"debug"})}function cs(t){var e=t.subtype,r=void 0===e?"bad-token":e,n=t.message,o=t.details;return new De({id:"not-authorized",subtype:r,httpCode:403,debugMessage:n,debugDetails:void 0===o?{}:o,publicMessage:"Not Authorized",logLevel:"debug"})}var us=r(89),ss=r.n(us);function ls(t){return(ls="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function fs(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */fs=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var o=e&&e.prototype instanceof f?e:f,i=Object.create(o.prototype),a=new S(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return L()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=b(a,r);if(c){if(c===l)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=s(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(t,r,a),i}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var l={};function f(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(k([])));v&&v!==e&&r.call(v,o)&&(d=v);var m=p.prototype=f.prototype=Object.create(d);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){var n;this._invoke=function(o,i){function a(){return new e((function(n,a){!function n(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==ls(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,a,c)}),(function(t){n("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,c)}))}c(u.arg)}(o,i,n,a)}))}return n=n?n.then(a,a):a()}}function b(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=s(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function k(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:L}}function L(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},g(w.prototype),c(w.prototype,i,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(u(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=k,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),E(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:k(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function hs(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function ps(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){hs(i,n,o,a,c,"next",t)}function c(t){hs(i,n,o,a,c,"throw",t)}a(void 0)}))}}function ds(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ys(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function vs(t,e){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}function ms(t,e,r){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return r}var gs,ws,bs,xs=new WeakSet,Es=new WeakSet,Ss=new WeakSet,ks=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.onTimeout,n=e.onBlow;ds(this,t),vs(this,Ss),vs(this,Es),vs(this,xs),this.timedout=!1,this.expiredTimeout=null,this.timeouts={},this.onBlowCb=n||function(t){throw new Error("Timeout: Operation took too long timeoutId:".concat(t.id))},this.callbacks=[],this.onTimeout(r)}var e,r,n,o,i;return e=t,(r=[{key:"exec",value:function(){var t=ps(fs().mark((function t(e,r){var n,o,i,a,c,u,s=arguments;return fs().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=s.length>2&&void 0!==s[2]?s[2]:{},o=n.id,i=n.onTimeout,a=n.onBlow,c=n.extraData,!this.hasTimedout()){t.next=6;break}return ms(this,Ss,Ts).call(this,i),t.next=5,this.blowIfTimedout();case 5:return t.abrupt("return",t.sent);case 6:return o=this.start(e,{id:o,onTimeout:i,onBlow:a,extraData:c}),t.next=9,Promise.race([ms(this,Ss,Ts).call(this,r),ms(this,xs,Ls).call(this,{onBlow:a,extraData:c})]);case 9:return u=t.sent,this.clear(o),t.next=13,this.blowIfTimedout();case 13:return t.abrupt("return",u);case 14:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()},{key:"start",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.id,o=r.onTimeout,i=r.onBlow,a=r.extraData;if(!this.hasTimedout()){var c=Rt(),u={onBlowCb:i,extraData:a||{},startedAt:c,duration:t},s=setTimeout(ps(fs().mark((function t(){return fs().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e&&!e.timedout){t.next=2;break}return t.abrupt("return");case 2:return e.timedout=!0,e.expiredTimeout=u,e.clearAll(),t.next=7,Promise.all([ms(e,Ss,Ts).call(e,o),ms(e,Es,Os).call(e)]);case 7:case"end":return t.stop()}}),t)}))),1e3*t);return n||(n=s),Object.assign(u,{id:n,clearId:s}),this.timeouts[n]=u,n}ms(this,Ss,Ts).call(this,o)}},{key:"clear",value:function(t){var e=this.timeouts[t];e&&(clearTimeout(e.clearId),delete this.timeouts[t])}},{key:"clearAll",value:function(){var t=this;Object.keys(this.timeouts).forEach((function(){return t.clear()}))}},{key:"onTimeout",value:function(t){this.hasTimedout()?ms(this,Ss,Ts).call(this,t):t&&this.callbacks.push(t)}},{key:"missingSecondsToExpire",value:function(){var t=this.nextExpiresAtInSeconds(),e=Rt();return max(0,t-e)}},{key:"nextExpiresAtInSeconds",value:function(){var t=this;if(this.timedout)return 0;var e=Object.keys(this.timeouts);if(!e.length)return 0;var r=null;return e.forEach((function(e){var n=t.timeouts[e];if(n){var o=n.startedAt+n.duration;null!==r&&o<r&&(r=o)}})),r||0}},{key:"hasTimedout",value:function(){return this.timedout}},{key:"blowIfTimedout",value:(i=ps(fs().mark((function t(){return fs().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.blowIfTimedoutSync());case 1:case"end":return t.stop()}}),t,this)}))),function(){return i.apply(this,arguments)})},{key:"blowIfTimedoutSync",value:function(){if(this.hasTimedout()){var t=this.expiredTimeout;return this.clearAll(),(t.onBlowCb||this.onBlowCb)(t)}}},{key:"waitForTimeout",value:(o=ps(fs().mark((function t(){var e=this;return fs().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,r){e.onTimeout((function(){return t()}))})));case 1:case"end":return t.stop()}}),t)}))),function(){return o.apply(this,arguments)})}])&&ys(e.prototype,r),n&&ys(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Ls(){return js.apply(this,arguments)}function js(){return(js=ps(fs().mark((function t(){return fs().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.waitForTimeout();case 2:return t.next=4,this.blowIfTimedout();case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t,this)})))).apply(this,arguments)}function Os(){return _s.apply(this,arguments)}function _s(){return(_s=ps(fs().mark((function t(){var e=this;return fs().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Promise.all(this.callbacks.map((function(t){return ms(e,Ss,Ts).call(e,t)}))));case 1:case"end":return t.stop()}}),t,this)})))).apply(this,arguments)}function Ts(t){return Ps.apply(this,arguments)}function Ps(){return(Ps=ps(fs().mark((function t(e){var r;return fs().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return"function"==typeof e&&(r=function(){var t=ps(fs().mark((function t(){return fs().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e());case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),e=r()),t.abrupt("return",Promise.resolve(e));case 2:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Is(t){return(Is="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ns(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Ns=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var o=e&&e.prototype instanceof f?e:f,i=Object.create(o.prototype),a=new S(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return L()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=b(a,r);if(c){if(c===l)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=s(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(t,r,a),i}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var l={};function f(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(k([])));v&&v!==e&&r.call(v,o)&&(d=v);var m=p.prototype=f.prototype=Object.create(d);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){var n;this._invoke=function(o,i){function a(){return new e((function(n,a){!function n(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==Is(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,a,c)}),(function(t){n("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,c)}))}c(u.arg)}(o,i,n,a)}))}return n=n?n.then(a,a):a()}}function b(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=s(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function k(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:L}}function L(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},g(w.prototype),c(w.prototype,i,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(u(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=k,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),E(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:k(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function As(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Cs(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){As(i,n,o,a,c,"next",t)}function c(t){As(i,n,o,a,c,"throw",t)}a(void 0)}))}}function Rs(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Fs(t,e){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}function Gs(t,e,r){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return r}var Ds=new(gs=new WeakSet,ws=new WeakSet,bs=new WeakSet,function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Fs(this,bs),Fs(this,ws),Fs(this,gs)}var e,r,n;return e=t,(r=[{key:"getManager",value:function(t){var e=t.locals.dentTimeout;return e||(t.locals.dentTimeout=e=new ks({onBlow:function(t){var e=t.id,r=t.extraData.overrideHttpCode;throw new De({id:"timeout",httpCode:r||504,publicMessage:"Operation took too long",debugMessage:"Operation id:".concat(e," took too long."),logLevel:"debug",tags:{"error:timeout":e}})}}),Ye()(t,(function(){return e.clearAll()})),ss()(t,(function(){return e.clearAll()}))),e}},{key:"ensure",value:function(t){var e=t.id,r=t.timeoutSecs,n=t.overrideHttpCode,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return o?Gs(Ds,ws,qs).call(Ds,{id:e,timeoutSecs:r,overrideHttpCode:n},o):Gs(Ds,gs,Ms).call(Ds,{id:e,timeoutSecs:r,overrideHttpCode:n})}},{key:"blowIfTimedout",get:function(){return gt("timeout.blowIfTimedout",function(){var t=Cs(Ns().mark((function t(e,r){var n;return Ns().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Ds.getManager(r),t.next=3,n.blowIfTimedout();case 3:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}())}}])&&Rs(e.prototype,r),n&&Rs(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}());function Ms(t){var e=t.id,r=t.timeoutSecs,n=t.overrideHttpCode;return gt("timeout.#globalEnsure",function(){var t=Cs(Ns().mark((function t(o,i){var a;return Ns().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Ds.getManager(i),t.next=3,a.blowIfTimedout();case 3:a.start(r,{id:e,extraData:{overrideHttpCode:n}});case 4:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}())}function qs(t,e){var r=t.id,n=t.timeoutSecs,o=t.overrideHttpCode;return gt("timeout.#localEnsure",function(){var t=Cs(Ns().mark((function t(i,a){var c;return Ns().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=Ds.getManager(a),t.next=3,c.blowIfTimedout();case 3:return t.next=5,c.exec(n,Cs(Ns().mark((function t(){var r,n;return Ns().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=0;case 1:if(!(r<e.length)){t.next=8;break}return n=e[r],t.next=5,wt(n,i,a);case 5:r++,t.next=1;break;case 8:case"end":return t.stop()}}),t)}))),{id:r,extraData:{overrideHttpCode:o}});case 5:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}())}function Us(t){return(Us="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ws(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Ws=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var o=e&&e.prototype instanceof f?e:f,i=Object.create(o.prototype),a=new S(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return L()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=b(a,r);if(c){if(c===l)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=s(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(t,r,a),i}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var l={};function f(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(k([])));v&&v!==e&&r.call(v,o)&&(d=v);var m=p.prototype=f.prototype=Object.create(d);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){var n;this._invoke=function(o,i){function a(){return new e((function(n,a){!function n(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==Us(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,a,c)}),(function(t){n("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,c)}))}c(u.arg)}(o,i,n,a)}))}return n=n?n.then(a,a):a()}}function b(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=s(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function k(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:L}}function L(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},g(w.prototype),c(w.prototype,i,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(u(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=k,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),E(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:k(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function Bs(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function zs(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Bs(i,n,o,a,c,"next",t)}function c(t){Bs(i,n,o,a,c,"throw",t)}a(void 0)}))}}function Ys(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r,n;return e=t,(r=[{key:"stopwatch",value:function(t,e){return gt("metrics.".concat(t),function(){var r=zs(Ws().mark((function r(n,o){return Ws().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",yc.stopwatch(t,zs(Ws().mark((function t(){return Ws().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",xt(e,n,o));case 1:case"end":return t.stop()}}),t)})))));case 1:case"end":return r.stop()}}),r)})));return function(t,e){return r.apply(this,arguments)}}())}}])&&Ys(e.prototype,r),n&&Ys(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}()),r(140);function Hs(t){return function(t){if(Array.isArray(t))return Ks(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return Ks(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ks(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ks(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Js(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Qs(t,e){Vs(t,e),e.add(t)}function $s(t,e,r){Vs(t,e),e.set(t,r)}function Vs(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Xs(t,e,r){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return r}function Zs(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,function(t,e,r){if(!e.has(t))throw new TypeError("attempted to "+r+" private field on non-instance");return e.get(t)}(t,e,"get"))}var tl=new WeakMap,el=new WeakMap,rl=new WeakSet,nl=new WeakSet,ol=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Qs(this,nl),Qs(this,rl),function(t,e,r){e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r}(this,"name","Basic"),$s(this,tl,{writable:!0,value:[]}),$s(this,el,{writable:!0,value:"id"}),this.router=o.a.Router()}var e,r,n;return e=t,(r=[{key:"get",value:function(t,e){for(var r,n=arguments.length,o=new Array(n>2?n-2:0),i=2;i<n;i++)o[i-2]=arguments[i];return this.router.get(t,(r=Xs(this,nl,al)).call.apply(r,[this,e].concat(o))),this}},{key:"post",value:function(t,e){for(var r,n=arguments.length,o=new Array(n>2?n-2:0),i=2;i<n;i++)o[i-2]=arguments[i];return this.router.post(t,(r=Xs(this,nl,al)).call.apply(r,[this,e].concat(o))),this}},{key:"put",value:function(t,e){for(var r,n=arguments.length,o=new Array(n>2?n-2:0),i=2;i<n;i++)o[i-2]=arguments[i];return this.router.put(t,(r=Xs(this,nl,al)).call.apply(r,[this,e].concat(o))),this}},{key:"delete",value:function(t,e){for(var r,n=arguments.length,o=new Array(n>2?n-2:0),i=2;i<n;i++)o[i-2]=arguments[i];return this.router.delete(t,(r=Xs(this,nl,al)).call.apply(r,[this,e].concat(o))),this}},{key:"options",value:function(t,e){for(var r,n=arguments.length,o=new Array(n>2?n-2:0),i=2;i<n;i++)o[i-2]=arguments[i];return this.router.options(t,(r=Xs(this,nl,al)).call.apply(r,[this,e].concat(o))),this}}])&&Js(e.prototype,r),n&&Js(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function il(t){return t}function al(t){for(var e,r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];return[].concat(Hs(Zs(this,tl)),Hs((e=Xs(this,rl,il)).call.apply(e,[this,t].concat(n))))}function cl(t){return(cl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ul(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ul=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var o=e&&e.prototype instanceof f?e:f,i=Object.create(o.prototype),a=new S(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return L()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=b(a,r);if(c){if(c===l)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=s(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(t,r,a),i}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var l={};function f(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(k([])));v&&v!==e&&r.call(v,o)&&(d=v);var m=p.prototype=f.prototype=Object.create(d);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){var n;this._invoke=function(o,i){function a(){return new e((function(n,a){!function n(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==cl(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,a,c)}),(function(t){n("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,c)}))}c(u.arg)}(o,i,n,a)}))}return n=n?n.then(a,a):a()}}function b(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=s(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function k(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:L}}function L(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},g(w.prototype),c(w.prototype,i,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(u(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=k,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),E(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:k(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function sl(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function ll(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){sl(i,n,o,a,c,"next",t)}function c(t){sl(i,n,o,a,c,"throw",t)}a(void 0)}))}}function fl(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function hl(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function pl(){return(pl="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=dl(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}}).apply(this,arguments)}function dl(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=wl(t)););return t}function yl(t,e){return(yl=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function vl(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=wl(t);if(e){var o=wl(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return ml(this,r)}}function ml(t,e){if(e&&("object"===cl(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return gl(t)}function gl(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function wl(t){return(wl=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function bl(t,e){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}function xl(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function El(t,e,r){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return r}var Sl=new WeakSet,kl=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&yl(t,e)}(i,t);var e,r,n,o=vl(i);function i(){var t;fl(this,i);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return bl(gl(t=o.call.apply(o,[this].concat(r))),Sl),xl(gl(t),"name","Cors"),t}return e=i,(r=[{key:"get",value:function(t,e){for(var r,n,o=arguments.length,a=new Array(o>2?o-2:0),c=2;c<o;c++)a[c-2]=arguments[c];return(r=El(this,Sl,Ll)).call.apply(r,[this,t].concat(a)),(n=pl(wl(i.prototype),"get",this)).call.apply(n,[this,t,e].concat(a))}},{key:"post",value:function(t,e){for(var r,n,o=arguments.length,a=new Array(o>2?o-2:0),c=2;c<o;c++)a[c-2]=arguments[c];return(r=El(this,Sl,Ll)).call.apply(r,[this,t].concat(a)),(n=pl(wl(i.prototype),"post",this)).call.apply(n,[this,t,e].concat(a))}},{key:"put",value:function(t,e){for(var r,n,o=arguments.length,a=new Array(o>2?o-2:0),c=2;c<o;c++)a[c-2]=arguments[c];return(r=El(this,Sl,Ll)).call.apply(r,[this,t].concat(a)),(n=pl(wl(i.prototype),"put",this)).call.apply(n,[this,t,e].concat(a))}},{key:"delete",value:function(t,e){for(var r,n,o=arguments.length,a=new Array(o>2?o-2:0),c=2;c<o;c++)a[c-2]=arguments[c];return(r=El(this,Sl,Ll)).call.apply(r,[this,t].concat(a)),(n=pl(wl(i.prototype),"delete",this)).call.apply(n,[this,t,e].concat(a))}},{key:"options",value:function(t,e){for(var r,n,o=arguments.length,a=new Array(o>2?o-2:0),c=2;c<o;c++)a[c-2]=arguments[c];return(r=El(this,Sl,Ll)).call.apply(r,[this,t].concat(a)),(n=pl(wl(i.prototype),"options",this)).call.apply(n,[this,t,e].concat(a))}}])&&hl(e.prototype,r),n&&hl(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}(ol);function Ll(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];apiId=r[this.routeIdKey],this.router.options(t,Gc.setId(apiId),Ds.ensure({id:"full-route",timeoutSecs:1}),Wu.enforcePreflightCors,mt(function(){var t=ll(ul().mark((function t(e,r){return ul().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r.status(200).end();case 1:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}()))}function jl(t){return(jl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ol(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Tl(t,e){return(Tl=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Pl(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Al(t);if(e){var o=Al(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Il(this,r)}}function Il(t,e){if(e&&("object"===jl(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Nl(t)}function Nl(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Al(t){return(Al=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Cl(t,e){Fl(t,e),e.add(t)}function Rl(t,e,r){Fl(t,e),e.set(t,r)}function Fl(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Gl(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Dl=new WeakMap,Ml=new WeakSet;function ql(t){return(ql="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ul(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Wl(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Ul(Object(r),!0).forEach((function(e){Bl(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ul(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Bl(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function zl(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==r)return;var n,o,i=[],a=!0,c=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(i.push(n.value),!e||i.length!==e);a=!0);}catch(t){c=!0,o=t}finally{try{a||null==r.return||r.return()}finally{if(c)throw o}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return Yl(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Yl(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Yl(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Hl(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Hl=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var o=e&&e.prototype instanceof f?e:f,i=Object.create(o.prototype),a=new S(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return L()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=b(a,r);if(c){if(c===l)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=s(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(t,r,a),i}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var l={};function f(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(k([])));v&&v!==e&&r.call(v,o)&&(d=v);var m=p.prototype=f.prototype=Object.create(d);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){var n;this._invoke=function(o,i){function a(){return new e((function(n,a){!function n(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==ql(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,a,c)}),(function(t){n("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,c)}))}c(u.arg)}(o,i,n,a)}))}return n=n?n.then(a,a):a()}}function b(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=s(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function k(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:L}}function L(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},g(w.prototype),c(w.prototype,i,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(u(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=k,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),E(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:k(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function Kl(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Jl(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Kl(i,n,o,a,c,"next",t)}function c(t){Kl(i,n,o,a,c,"throw",t)}a(void 0)}))}}var Ql,$l,Vl;(function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Tl(t,e)}(i,t);var e,r,n,o=Pl(i);function i(){var t;_l(this,i);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return Cl(Nl(t=o.call.apply(o,[this].concat(r))),Ml),Gl(Nl(t),"name","Quick"),Rl(Nl(t),Dl,{writable:!0,value:[Wu.parseAuthToken,Ai.client,Wu.validateClient,Wu.validateApiVisibility,Wu.validateBodyData]}),t}return e=i,r&&Ol(e.prototype,r),n&&Ol(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e})(kl)().post("/cosmetic",handlers=[Wu.dataToQuickSimulation({force:{mode:"cosmetic",blend:"poisson"},customizable:["mixFactor","styleMode","whiten","brightness"]}),Xl()],id="cosmetic-simulations").post("/ortho",handlers=[Wu.dataToQuickSimulation({force:{mode:"ortho",blend:"poisson",styleMode:"mix_manual",mixFactor:0},customizable:[]}),Xl()],id="ortho-simulations").path(path="/:id",handlers=[mt(function(){var t=Jl(Hl().mark((function t(e,r){var n,o,i,a,c,u,s,l;return Hl().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.params.id,o=r.locals,i=o.dentClient,a=o.dentApiId,c=o.dentClientId,u=i.customGoogleProject({api:a})||"default",t.next=5,cc.get(n,{source:u});case 5:if((s=t.sent)&&s.clientId===c){t.next=8;break}throw Gc.newNotFoundError();case 8:return l=r.locals.dentParsedBody.data,s.addMetadata(l),t.next=12,s.save({attrs:["metadata"]});case 12:t.sent.errors,r.status(200).json({success:!0,simulation:Zl(s)});case 15:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}())],id="patch-simulation");function Xl(){return mt(function(){var t=Jl(Hl().mark((function t(e,r){var n,o,i,a,c,u,s,l,f,h,p,d,y;return Hl().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Ds.getManager(r),o=r.locals.dentQuickSimulation,i=r.locals.dentParsedBody.images.imgPhoto,a=r.locals,c=a.dentClient,u=a.dentApiId,s=c.customBucket({api:u})||ft.gcloudBucket,l=c.customGoogleProject({api:u})||"default",t.next=8,yc.stopwatch("api:quickSimulations:runSimulation",Jl(Hl().mark((function t(){return Hl().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.exec(ft.quickApiSimulationTimeout,Jl(Hl().mark((function t(){var e,a,c,u;return Hl().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=new Er,a=Math.round(1e3*n.nextExpiresAtInSeconds()),c=Math.round(Ft()+1e3*ft.quickApiSimulationQueueTimeout),u=Math.min(a,c),Wu.setSimulationStarted(r),t.next=7,e.requestSimulation({id:o.id,photo:i.content,options:o.buildJobOptions(),expiresAt:u,safe:!0});case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}}),t)}))),{id:"wait-simulation"});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)}))));case 8:if((f=t.sent).id){t.next=11;break}throw Gc.newServerError({debugMessage:"Simulation response should have id but got ".concat(f)});case 11:return t.next=13,yc.stopwatch("api:quickSimulations:uploadResults",Jl(Hl().mark((function t(){return Hl().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.exec(ft.quickApiResultsUploadTimeout,Jl(Hl().mark((function t(){return Hl().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,wa.upload({googleProjectKey:l,bucket:s,clientId:c.id,simulation:f,uploadsConfig:{original:{extensionPlaceholder:i.filenameExtension},before:{getUrl:!0,isPublic:!0},result:{getUrl:!0,isPublic:!0},morphed:{getUrl:!1}},info:{ip:e.ip,metadata:o.metadata}});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)}))),{id:"wait-firestorage-upload"});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)}))));case 13:return h=t.sent,Object.entries(h.results).forEach((function(t){var e=zl(t,2),r=e[0],n=e[1];n.filepath&&o.addStorageData(Bl({},"".concat(r,"Path"),n.filepath))})),o.addStorageData({bucket:s,directoryPath:h.folderpath}),t.next=18,o.save({source:l});case 18:if(!f.error){t.next=20;break}throw f.error;case 20:p=h.results,d=p.before.getUrlSigned,y=p.result.getUrlSigned,r.status(201).json({success:!0,simulation:Wl(Wl({},Zl(o)),{},{storage:{beforeUrl:d,resultUrl:y}})});case 22:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}())}function Zl(t){return{id:t.id,createdAt:t.createdAt.toDate(),metadata:t.metadata}}function tf(t){return(tf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ef(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==r)return;var n,o,i=[],a=!0,c=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(i.push(n.value),!e||i.length!==e);a=!0);}catch(t){c=!0,o=t}finally{try{a||null==r.return||r.return()}finally{if(c)throw o}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return rf(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return rf(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function rf(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function nf(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */nf=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var o=e&&e.prototype instanceof f?e:f,i=Object.create(o.prototype),a=new S(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return L()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=b(a,r);if(c){if(c===l)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=s(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(t,r,a),i}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var l={};function f(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(k([])));v&&v!==e&&r.call(v,o)&&(d=v);var m=p.prototype=f.prototype=Object.create(d);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){var n;this._invoke=function(o,i){function a(){return new e((function(n,a){!function n(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==tf(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,a,c)}),(function(t){n("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,c)}))}c(u.arg)}(o,i,n,a)}))}return n=n?n.then(a,a):a()}}function b(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=s(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function k(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:L}}function L(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},g(w.prototype),c(w.prototype,i,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(u(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=k,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),E(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:k(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function of(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function af(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){of(i,n,o,a,c,"next",t)}function c(t){of(i,n,o,a,c,"throw",t)}a(void 0)}))}}function cf(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function uf(t,e){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}function sf(t,e,r){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return r}var lf=new(Ql=new WeakSet,$l=new WeakSet,Vl=new WeakSet,function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),uf(this,Vl),uf(this,$l),uf(this,Ql)}var e,r,n,o,a,c,u;return e=t,(r=[{key:"renameReviewedImage",value:(u=af(nf().mark((function t(e){var r,n;return nf().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.filepathUploadedToReview(),n=e.filepathUploaded,t.next=4,sf(this,Vl,pf).call(this,r,n);case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t,this)}))),function(t){return u.apply(this,arguments)})},{key:"renameUploadedImageToForceRerun",value:(c=af(nf().mark((function t(e){var r,n;return nf().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.filepathUploadedToReview(),n=e.filepathUploaded,t.prev=2,t.next=5,sf(this,Vl,pf).call(this,n,r);case 5:t.next=9;break;case 7:t.prev=7,t.t0=t.catch(2);case 9:return t.next=11,sf(this,Vl,pf).call(this,r,n);case 11:return t.abrupt("return",t.sent);case 12:case"end":return t.stop()}}),t,this,[[2,7]])}))),function(t){return c.apply(this,arguments)})},{key:"listResultCandidates",value:(a=af(nf().mark((function t(e){var r,n,o,a,c=this;return nf().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Nr().bucket(ft.gcloudBucket).getFiles({prefix:e.resultsDirectory(),delimiter:"/"});case 2:return r=t.sent,n=ef(r,1),o=n[0],a=[],o.forEach((function(t){var e=t.name,r=i.basename(e),n=r.match(/_after(_.*\.)(jpe?g|png)/);if(n){var o=r.includes("_transformed"),u=n[1].match(/[_.]b(\d+\.\d+)[_.]/),s=n[1].match(/([_.]mf|[_.])(\d+\.\d+)[_.]/),l=n[1].match(/[_.]w(\d+\.\d+)[_.]/),f=n[1].match(/[_.]blend([^_]+)[_.]/),h=u?Math.round(100*parseFloat(u[1]))/100:1,p=s?Math.round(100*parseFloat(s[2]))/100:null,d=l?Math.round(100*parseFloat(l[1]))/100:0,y=f?f[1]:"replace";a.push({id:sf(c,Ql,ff).call(c,r),path:e,synthType:o?"transformed":"interpolated",brightness:h,luminance:p,mixFactor:p,whiten:d,blending:y})}})),a.sort((function(t,e){return t.mixFactor-e.mixFactor})),t.abrupt("return",a);case 9:case"end":return t.stop()}}),t)}))),function(t){return a.apply(this,arguments)})},{key:"renameChosenResult",value:(o=af(nf().mark((function t(e,r){var n,o,a;return nf().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=sf(this,$l,hf).call(this,r),o=i.join(e.resultsDirectory(),n),a=e.filepathResult,t.next=5,sf(this,Vl,pf).call(this,o,a);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t,this)}))),function(t,e){return o.apply(this,arguments)})}])&&cf(e.prototype,r),n&&cf(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}());function ff(t){return X.urlSafeBase64(t)}function hf(t){return X.urlSafeBase64Decode(t)}function pf(t,e){return df.apply(this,arguments)}function df(){return(df=af(nf().mark((function t(e,r){return nf().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(t,n){Nr().bucket(ft.gcloudBucket).file(e).move(r).then((function(){return t({exist:!0})})).catch((function(o){ht.warn("Couldn't rename ".concat(e," to ").concat(r,". ").concat(o)),404===o.code?t({exist:!1}):n({source:'smileTaskStorage.move("'.concat(e,'","').concat(r,'")'),error:o})}))}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function yf(t){return(yf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function vf(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */vf=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var o=e&&e.prototype instanceof f?e:f,i=Object.create(o.prototype),a=new S(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return L()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=b(a,r);if(c){if(c===l)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=s(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(t,r,a),i}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var l={};function f(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(k([])));v&&v!==e&&r.call(v,o)&&(d=v);var m=p.prototype=f.prototype=Object.create(d);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){var n;this._invoke=function(o,i){function a(){return new e((function(n,a){!function n(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==yf(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,a,c)}),(function(t){n("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,c)}))}c(u.arg)}(o,i,n,a)}))}return n=n?n.then(a,a):a()}}function b(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=s(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function k(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:L}}function L(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},g(w.prototype),c(w.prototype,i,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(u(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=k,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),E(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:k(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function mf(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function gf(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){mf(i,n,o,a,c,"next",t)}function c(t){mf(i,n,o,a,c,"throw",t)}a(void 0)}))}}var wf=o.a.Router();wf.put("/promote-uploaded",mt(function(){var t=gf(vf().mark((function t(e,r){var n,o;return vf().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=r.locals.dentSmileTask,t.next=3,lf.renameReviewedImage(n);case 3:if(o=t.sent,o.exist){t.next=7;break}return t.abrupt("return",nt.respondError(r,404,"Couldn't find the image to promote"));case 7:return t.abrupt("return",r.status(200).json({promoted:!0}));case 8:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}())),wf.put("/rerun",mt(function(){var t=gf(vf().mark((function t(e,r){var n,o;return vf().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=r.locals.dentSmileTask,t.next=3,lf.renameUploadedImageToForceRerun(n);case 3:if(o=t.sent,o.exist){t.next=7;break}return t.abrupt("return",nt.respondError(r,404,"Couldn't find the image to rerun"));case 7:return t.abrupt("return",r.status(200).json({success:!0}));case 8:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}())),wf.get("/result-candidates",mt(function(){var t=gf(vf().mark((function t(e,r){var n,o;return vf().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((n=r.locals.dentSmileTask).hasFinished()){t.next=3;break}return t.abrupt("return",nt.respondError(r,423,"The simulation haven't finished yet."));case 3:return t.next=5,lf.listResultCandidates(n);case 5:return o=t.sent,t.abrupt("return",r.status(200).json({candidates:o}));case 7:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}())),wf.put("/result-candidates/:resultId/promote",mt(function(){var t=gf(vf().mark((function t(e,r){var n,o,i;return vf().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((n=r.locals.dentSmileTask).hasFinished()){t.next=3;break}return t.abrupt("return",nt.respondError(r,423,"The simulation haven't finished yet."));case 3:return o=e.params.resultId,t.next=6,lf.renameChosenResult(n,o);case 6:if(i=t.sent,i.exist){t.next=10;break}return t.abrupt("return",nt.respondError(r,404,"Couldn't find the result candidate"));case 10:return t.abrupt("return",r.status(200).json({promoted:!0}));case 11:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}()));var bf=wf;function xf(t){return(xf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ef(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Ef=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var o=e&&e.prototype instanceof f?e:f,i=Object.create(o.prototype),a=new S(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return L()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=b(a,r);if(c){if(c===l)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=s(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(t,r,a),i}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var l={};function f(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(k([])));v&&v!==e&&r.call(v,o)&&(d=v);var m=p.prototype=f.prototype=Object.create(d);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){var n;this._invoke=function(o,i){function a(){return new e((function(n,a){!function n(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==xf(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,a,c)}),(function(t){n("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,c)}))}c(u.arg)}(o,i,n,a)}))}return n=n?n.then(a,a):a()}}function b(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=s(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function k(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:L}}function L(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},g(w.prototype),c(w.prototype,i,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(u(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=k,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),E(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:k(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function Sf(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}var kf=o.a.Router();function Lf(t){var e=t.event;return"processing_step"===e?t.step:"error"===e?"error":"finished"===e?"finished":void 0}kf.post("/status-update",function(){var t,e=(t=Ef().mark((function t(e,r){var n,o;return Ef().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.body,t.next=3,fo.get(n.smileTaskId);case 3:return(o=t.sent).status=Lf(n),t.next=7,o.save();case 7:return t.abrupt("return",r.status(200).send("SUCCESS"));case 8:case"end":return t.stop()}}),t)})),function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Sf(i,n,o,a,c,"next",t)}function c(t){Sf(i,n,o,a,c,"throw",t)}a(void 0)}))});return function(t,r){return e.apply(this,arguments)}}());var jf=kf;Gc.addCallback("tags.add",(function(t){for(var e=t.addedTags,r=0,n=Object.keys(e);r<n.length;r++){var o=n[r],i=e[o];yc.addTag({label:o,value:i})}})),v.a.registerHelper("i18n",(function(t){return F()(t)}));var Of,_f,Tf=ft.firestoreEmulatorDatabaseUrl;ft.isTest()&&!Tf&&(Tf="http://localhost:8080");for(var Pf=0,If=Object.values(ft.googleProjects);Pf<If.length;Pf++){var Nf=If[Pf],Af=Nf.projectKey,Cf=Nf.projectId,Rf=Nf.credentialCfg,Ff={projectId:Cf||"dentrino-local"};Tf&&Object.assign(Ff,{databaseURL:Tf}),Rf&&Object.assign(Ff,{credential:Nn.a.credential.cert(Rf)}),Of={app:Nn.a.initializeApp(Ff,Af),name:Af},_f=void 0,_f=zn.build(Of),zn.setInstance({database:_f})}var Gf=r(57),Df=r.n(Gf);function Mf(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"...";return t.length>e&&(t=t.slice(0,e-r.length)+r),t}Df.a.token("client_id",(function(t,e){return((Gc.getInfo(e)||{}).security||{})["client-id"]||""})),Df.a.token("params",(function(t,e){var r=e.locals.dentParsedBody||{},n=r.data||{},o=r.images||{},i=Object.keys(n).map((function(t){var e=N.a.inspect(n[t]);e=Mf(e,15);var r=Mf(t,15);return"".concat(r,":").concat(e)})),a=Object.keys(o).map((function(t){var e=o[t],r=e.size,n=e.mimetype,i=e.originalFilename,a=e.extension,c=(r/1024/1024).toFixed(2),u=function(t,e){if(t.length>e){var r=Math.floor(e/2),n=e-r;r-=1,n-=2,t=t.slice(0,r)+"..."+t.slice(-n-1,-1)}return t}(String(i),20),s=Mf(t,20);return"".concat(s,":{").concat(u," ").concat(n," ").concat(a||""," ").concat(c,"mb}")})),c=Mf(i.join(" "),250,"(...)"),u=Mf(a.join(" "),100,"(...)");return"".concat(c," ").concat(u)})),Df.a.token("ip",(function(t,e){return t.ip}));var qf=Df()(":date[iso] :method :url :status :response-time ms HTTP/:http-version :ip :client_id [:params]"),Uf=r(54),Wf=r(90),Bf=o()();if(ft.isNonLocal()&&Uf.init({dsn:ft.sentryDsn,env:ft.name,integrations:[new Uf.Integrations.Http({tracing:!0}),new Wf.Integrations.Express({app:Bf})]}),Bf.enable("trust proxy"),Bf.set("views",a.a.join(__dirname,"views")),Bf.set("view engine","hbs"),Bf.use((function(t,e,r){return ft.disableXForwardedForCheck||ft.isLocal()?r():2!==(t.header("x-forwarded-for")||"").split(",").length?r(new De({httpCode:400,id:"bad-request",subtype:"bad-x-forwarded-for",publicMessage:"Bad Request",debugMessage:"X-Forwarded-For has suspecious value.",logLevel:"debug"})):r()})),Bf.use(Uf.Handlers.requestHandler()),Bf.use(qf),Bf.use(o.a.urlencoded({extended:!1})),Bf.use(o.a.json({limit:"2mb",verify:function(t,e,r,n){t.rawBodyJson=r.toString(n||"utf8")}})),Bf.use(l()()),Bf.use(h()({contentSecurityPolicy:!1,crossOriginEmbedderPolicy:!1})),Bf.use(u()()),ft.instSimRouter){var zf=a.a.join(__dirname,"../public"),Yf=d()(zf);v.a.registerHelper("getVersionedPath",Yf.getVersionedPath),Bf.use(Yf.middleware),Bf.use((function(t,e,r){var n=t.header("host")||"";if(n.match(/^www\..*/i)){var o=n.replace(/^www\./i,""),i=t.protocol,c=a.a.join(o+t.url);return e.redirect(301,"".concat(i,"://").concat(c))}return r()})),Bf.use("/",Pn.router,Uf.Handlers.errorHandler(),Pn.errorHandler)}else Bf.use("/",E),Bf.use("/api/users/:userId/smile-tasks/",Ai.user,Zi),Bf.use("/public-api/simulations/",(void 0)({clientIsFrontend:!0})),Bf.use("/api/simulations/",(void 0)({clientIsFrontend:!1})),Bf.use("/api/67a4abe/smile-tasks/:smileTaskId/",Ai.smileTask,bf),Bf.use("/webhooks/828ffbc/smile-tasks/",jf),Bf.use(Uf.Handlers.errorHandler());Bf.use((function(t,e,r){return r(Gc.newNotFoundError())})),Bf.use(Gc.convertToRichError),Bf.use((function(t,e,r,n){var o=500,i=null;if(t instanceof De){var a=t.logLevel;a&&ht[a](t.logText()),o=t.httpCode,i=t.data({isDebug:!ft.isProduction(),allInfo:ft.isLocal()||ft.apiResponsesWithAllDebugData})}else{var c=t.message||t.error||"Unexpected Error: ".concat(JSON.stringify(t));o=t.status||500,ht.error(t),i=c}return r.locals.dentCorsOnError&&nt.setAllowingCors(e,r),r.status(o).json({success:!1,error:i})}));var Hf=Bf,Kf=r(91),Jf=r.n(Kf),Qf=r(92),$f=r.n(Qf),Vf=r(93),Xf=r(94),Zf=r.n(Xf),th=r(78),eh=r.n(th);function rh(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var nh=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.timeout=e,this.canceled=!1,this.onexpiration=null,this.restart()}var e,r,n;return e=t,(r=[{key:"restart",value:function(){this.canceled||(this.expired=!1,this.executed=!1,this.scheduleExpiration())}},{key:"onExpiration",value:function(t){this.canceled||(this.expired&&!this.executed&&(this.executed=!0,t()),this.expired||(this.onexpiration=t))}},{key:"scheduleExpiration",value:function(){var t=this;void 0!==this.timeoutid&&clearTimeout(this.timeoutid),this.timeoutid=setTimeout((function(){t.expires()}),this.timeout)}},{key:"expires",value:function(){this.canceled||(this.expired=!0,!this.executed&&this.onexpiration&&(this.executed=!0,this.onexpiration()),this.executed||this.scheduleExpiration())}},{key:"cancel",value:function(){this.canceled=!0,void 0!==this.timeoutid&&clearTimeout(this.timeoutid)}}])&&rh(e.prototype,r),n&&rh(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function oh(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var ih=function(){function t(e,r,n){var o=n.onTerminate,i=void 0===o?null:o,a=n.onReceive,c=void 0===a?null:a,u=n.inactiveTimeout,s=void 0===u?30:u;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.onTerminate=i,this.socket=e,this.key=r,this.onTerminate=i,this.onReceive=c,this.server=this.setupWebsocketServer(),this.redis=this.setupRedisPubSub(),this.timeout=this.setupInactiveTimeout(s)}var e,r,n;return e=t,(r=[{key:"upgradeRequestToWSConnection",value:function(t,e){var r=this;this.server.handleUpgrade(t,this.socket,e,(function(e){r.server.emit("connection",e,t)}))}},{key:"terminate",value:function(){this.onTerminate&&this.onTerminate(),this.redis.unsubscribe(),this.redis.quit(),this.server.close(),this.socket.destroy(),this.timeout.cancel()}},{key:"setupWebsocketServer",value:function(){return new eh.a.Server({noServer:!0})}},{key:"setupRedisPubSub",value:function(){var t=this,e=_t.newRedisPubsub();e.on("error",(function(){return t.terminate()}));var r="worker-progress:".concat(this.key);return e.subscribe(r),e.on("message",(function(e,r){ht.info("WebsocketServer ".concat(t.key," - Received message from redis ").concat(e," ").concat(r)),"#QUIT#"!==r?(t.onReceive&&t.onReceive(JSON.parse(r)),t.sendToClients(r),t.timeout.restart()):t.terminate()})),e}},{key:"setupInactiveTimeout",value:function(t){var e=this,r=new nh(1e3*t);return r.onExpiration((function(){ht.info("WebsocketServer ".concat(e.key," - Timed out (Too long without messages)"));var t=JSON.stringify({event:"error",code:"timeout",message:"Server are waiting too much for progress."});e.sendToClients(t),e.terminate()})),r}},{key:"sendToClients",value:function(t){this.server.clients.forEach((function(e){e.readyState===eh.a.OPEN&&e.send(t)}))}}])&&oh(e.prototype,r),n&&oh(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function ah(t){return(ah="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ch(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ch=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var o=e&&e.prototype instanceof f?e:f,i=Object.create(o.prototype),a=new S(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return L()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=b(a,r);if(c){if(c===l)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=s(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(t,r,a),i}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var l={};function f(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(k([])));v&&v!==e&&r.call(v,o)&&(d=v);var m=p.prototype=f.prototype=Object.create(d);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){var n;this._invoke=function(o,i){function a(){return new e((function(n,a){!function n(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==ah(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,a,c)}),(function(t){n("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,c)}))}c(u.arg)}(o,i,n,a)}))}return n=n?n.then(a,a):a()}}function b(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=s(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function k(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:L}}function L(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},g(w.prototype),c(w.prototype,i,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(u(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=k,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),E(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:k(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function uh(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function sh(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var lh=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.localServers={},this.generalRedis=_t.newRedisPubsub(),this.onReceive=null}var e,r,n,o,i;return e=t,r=[{key:"onUpgrade",value:(o=ch().mark((function t(e,r,n){var o,i,a,c,u;return ch().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=Zf.a.parse(e.url).pathname,null!==(i=o.match(/^\/ws\/smile-tasks\/(.*)$/))){t.next=5;break}return r.destroy(),t.abrupt("return");case 5:return a=i[1],ht.info("taskId: ".concat(a)),t.next=9,fo.get(a);case 9:if(c=t.sent){t.next=14;break}return ht.warn("WebSocket [DENIED] ".concat(o," - SmileTask ").concat(a," not found")),r.destroy(),t.abrupt("return");case 14:if(u=c.filepathUploaded,ht.info("SmileTask ".concat(a," found")),ht.info("key: ".concat(u)),this.generalRedis.isOnline){t.next=21;break}return ht.warn("WebSocket [DENIED] ".concat(o," - Redis is offline")),r.destroy(),t.abrupt("return");case 21:this.findOrCreateLocalServer(r,u,c).upgradeRequestToWSConnection(e,n),ht.info("WebSocket [SUCCESS] ".concat(o));case 24:case"end":return t.stop()}}),t,this)})),i=function(){var t=this,e=arguments;return new Promise((function(r,n){var i=o.apply(t,e);function a(t){uh(i,r,n,a,c,"next",t)}function c(t){uh(i,r,n,a,c,"throw",t)}a(void 0)}))},function(t,e,r){return i.apply(this,arguments)})},{key:"findOrCreateLocalServer",value:function(t,e,r){var n=this,o=this.localServers[e];return void 0!==o||(o=new ih(t,e,{onTerminate:function(){delete n.localServers[e]},onReceive:function(t){n.onReceive&&n.onReceive(t,r)}}),this.localServers[e]=o),o}}],n=[{key:"instance",value:function(){return void 0===this.singleton&&(this.singleton=new t),this.singleton}},{key:"upgradeRequestsOn",value:function(e){e.on("upgrade",(function(e,r,n){t.instance().onUpgrade(e,r,n)}))}}],r&&sh(e.prototype,r),n&&sh(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function fh(t){return(fh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function hh(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */hh=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var o=e&&e.prototype instanceof f?e:f,i=Object.create(o.prototype),a=new S(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return L()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=b(a,r);if(c){if(c===l)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=s(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(t,r,a),i}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var l={};function f(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(k([])));v&&v!==e&&r.call(v,o)&&(d=v);var m=p.prototype=f.prototype=Object.create(d);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){var n;this._invoke=function(o,i){function a(){return new e((function(n,a){!function n(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==fh(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,a,c)}),(function(t){n("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,c)}))}c(u.arg)}(o,i,n,a)}))}return n=n?n.then(a,a):a()}}function b(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=s(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function k(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:L}}function L(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},g(w.prototype),c(w.prototype,i,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(u(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=k,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),E(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:k(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function ph(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}Jf()("dentrino-web:server");Hf.set("port",ft.port),Hf.set("host",ft.host);var dh,yh,vh=$f.a.createServer(Hf);Object(Vf.createTerminus)(vh,{healthChecks:{"/healthz":(dh=hh().mark((function t(){return hh().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",void 0);case 1:case"end":return t.stop()}}),t)})),yh=function(){var t=this,e=arguments;return new Promise((function(r,n){var o=dh.apply(t,e);function i(t){ph(o,r,n,i,a,"next",t)}function a(t){ph(o,r,n,i,a,"throw",t)}i(void 0)}))},function(){return yh.apply(this,arguments)})}}),vh.listen(ft.port,ft.host),vh.on("error",(function(t){if("listen"!==t.syscall)throw t;var e="string"==typeof ft.port?"Pipe "+ft.port:"Port "+ft.port;switch(t.code){case"EACCES":console.error(e+" requires elevated privileges"),process.exit(1);break;case"EADDRINUSE":console.error(e+" is already in use"),process.exit(1);break;default:throw t}})),vh.on("listening",(function(){var t=vh.address(),e="string"==typeof t?"pipe "+t:t.address+":"+t.port;console.log("Listening on "+e)})),lh.upgradeRequestsOn(vh)}]);
//# sourceMappingURL=start.js.map