# Simulations API Documentation - Ortho
## API Overview ##
This document describes how Simulations API's Ortho feature works.

To execute a ortho simulation the client will need to do a single request `POST /api/simulations/ortho` sending the photo binary as `multipart/form-data`. The response will be in JSON format as detailed along this document.

This request is meant to be done via back-end, not directly by the front-end.

### Request Structure
- POST /api/simulations/ortho
- Headers
  - `Authorization: Bearer $SIGNATURE`
  - `Content-Type: multipart/form-data`
- Body _(format: multipart/form-data)_
  - `img_photo: $PHOTO_IMAGE`


#### Illustrating with cURL
```
curl -XPOST \
  -H "Authorization: Bearer $SIGNATURE" \
  -H "Content-Type: multipart/form-data" \
	-F "img_photo=@$PHOTO_PATH" \
	"https://api.e91efc7.dentrino.ai/api/simulations/ortho"
```

### Response Structure
#### Success

```
// Status Code: 2xx
{
  "success": true,
  "beforeUrl": "https://.../before.jpg?...",
  "resultUrl": "https://.../result.jpg?..."
}
```

#### Error

```
// Status Code: 4xx / 5xx
{
  "success": false,
  "error": {
    "id": "PUBLIC ID",
    "message": "PUBLIC MESSAGE",
    "debug": {
      "__ALERT__": "THIS DEBUG OBJECT WILL NOT EXIST IN PRODUCTION",
      "debugId": "INTERNAL ID FOR DEBUGGING",
      "message": "PUBLIC MESSAGE FOR DEBBUGGING",
      "details": {...},
      "tags": {...}
    }
  }
}
```



## Script
The script called `ortho.py` can be used to send test requests to the API.

### Credentials
By default it'll use the following credentials (for testing purposes only):
```
CLIENT_ID=ODMzNjkxOTc4NTE5Mk9tZT4rYVJ2_testext
CLIENT_SECRET=7016d6ee59847abb24a56cb735335b10aa915f50755dfdcd41d926bb34808899
```



### Install Dependencies
To run the script first install the dependencies by running:
```
# Install Dependencies
pip install -r requirements.txt
```

### Sending Requests
```
# Sample Call
python ortho.py ./face.jpg \
	--client_id ODMzNjkxOTc4NTE5Mk9tZT4rYVJ2_testext \
	--client_secret 7016d6ee59847abb24a56cb735335b10aa915f50755dfdcd41d926bb34808899
# Or...
python ortho.py ./face.jpg

# See All Params
python ortho.py --help
```



## Signature ##
### Overview
The signature informs which client is using the API and prevents data from being tampered. It needs to be generated before each request and sent in the `Authorization` header.


To generate a signature the client will need a `CLIENT_ID` and `CLIENT_SECRET` that will be generated by TastyTech to each client. The `Client Secret` is used to hash the claims preventing them from being tampered.

The signature is composed by two parts joined by an `:`.
```
// Illustrative pseudo-code
CLAIMS_JSON = "{...}"
PART1 = base64($CLAIMS_JSON)
PART2 = hmac.sha256($CLAIMS_JSON, $CLIENT_SECRET)
SIGNATURE = "$PART1:$PART2"
```

### Signature Claims
The claims are represented as a JSON and have the following information:
```
{
  "client_id": "...",
  "params_hashed": { ... }
}

// Recaptcha Token isn't mandatory for mobile clients.
```

#### Claim: `client_id`
The plain `CLIENT_ID`.

#### Claim: `params_hashed`
All the parameters sent in the body as `multipart/form-data` must be hashed as MD5 and added to the `claims.params_hashed` JSON.

```
// Sample of "params_hashed when sending "img_photo: $PHOTO_BINARY" in the body
{
  ...
  "params_hashed": {
    "img_photo": md5($PHOTO_BINARY)
  }
}
```
